(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t=("undefined"!=typeof window?window:e.g).MathJax._.components.global,r=(t.GLOBAL,t.isObject,t.combineConfig,t.combineDefaults),n=(t.combineWithMathJax,t.MathJax);r(n._,"output",{common:{Wrapper:{}},chtml:{Wrapper:{},Wrappers_ts:{}},svg:{Wrapper:{},Wrappers_ts:{}}}),r(n.config.options,"menuOptions",{settings:{enrich:!1}});const a=MathJax._.input.tex.base.BaseMethods,i=(a.splitAlignArray,a.default),o=MathJax._.input.tex.Configuration,s=o.Configuration,h=(o.ConfigurationHandler,o.ParserConfiguration,MathJax._.input.tex.ParseMethods.default),u=MathJax._.input.tex.TexParser.default,c=MathJax._.input.tex.TokenMap,m=(c.parseResult,c.AbstractTokenMap,c.RegExpMap,c.AbstractParseMap,c.CharacterMap,c.DelimiterMap,c.MacroMap,c.CommandMap),p=c.EnvironmentMap,l=MathJax._.input.tex.TexError.default;function d(e,t){return console.error(e,t),new l(e,t)}class x{}class g extends x{constructor(e){super(),this.get=e}get isEmpty(){return!1}get isDefined(){return!0}getOrElse(e){return this.get}flatMap(e){return e(this.get)}map(e){return new g(e(this.get))}foreach(e){e(this.get)}toString(){return"Some("+this.get+")"}static unapply(e){return new g(e.get)}}class f extends x{constructor(){super()}get isEmpty(){return!0}get isDefined(){return!1}getOrElse(e){return e}flatMap(e){return this}foreach(e){}map(e){return this}toString(){return"None"}static unapply(e){return new g(e)}}x.Some=g,x.None=f,x.empty=new f;class w{}class v extends w{constructor(e,t){super(),this.head=e,this.tail=t}get isEmpty(){return!1}at(e){if(e<0||e>=this.length())throw Error("no such element at "+e+". index must be lower than "+this.length()+".");for(var t=this,r=0;r<e;r++)t=t.tail;return t.head}length(){for(var e=this,t=0;!e.isEmpty;)t++,e=e.tail;return t}prepend(e){return new v(e,this)}append(e){var t=new v(e,w.empty);return this.reverse().foreach(function(e){t=new v(e,t)}),t}concat(e){var t=e;return this.reverse().foreach(function(e){t=new v(e,t)}),t}foldLeft(e,t){var r,n;for(r=t(e,this.head),n=this.tail;!n.isEmpty;)r=t(r,n.head),n=n.tail;return r}foldRight(e,t){return this.tail.isEmpty?t(this.head,e):t(this.head,this.tail.foldRight(e,t))}map(e){return new v(e(this.head),this.tail.map(e))}flatMap(e){return e(this.head).concat(this.tail.flatMap(e))}foreach(e){for(var t=this;!t.isEmpty;)e(t.head),t=t.tail}reverse(){var e=w.empty;return this.foreach(function(t){e=new v(t,e)}),e}mkString(){var e,t,r,n,a;switch(arguments.length){case 0:e=t=r="";break;case 1:t=arguments[0],e=r="";break;case 2:e=arguments[0],t=arguments[1],r="";break;default:e=arguments[0],t=arguments[1],r=arguments[2]}for(n=e+this.head.toString(),a=this.tail;a instanceof v;)n+=t+a.head.toString(),a=a.tail;return n+=r}toString(){return this.mkString("[",", ","]")}static unapply(e){return new x.Some([e.head,e.tail])}}w.Cons=v;class S extends w{constructor(){super()}get isEmpty(){return!0}at(e){throw new Error("cannot get element from an empty list.")}length(){return 0}prepend(e){return new v(e,w.empty)}append(e){return new v(e,w.empty)}concat(e){return e}foldLeft(e,t){return e}foldRight(e,t){return e}flatMap(e){return this}map(e){return this}foreach(e){}reverse(){return this}mkString(){switch(arguments.length){case 0:case 1:return"";case 2:return arguments[0];default:return arguments[0]+arguments[2]}}toString(){return"[]"}static unapply(e){return new x.Some(e)}}w.Nil=S,w.empty=new S,w.fromArray=function(e){var t,r;for(t=w.empty,r=e.length-1;r>=0;)t=new v(e[r],t),r-=1;return t};class y{constructor(){this.cases=[]}Case(e,t){return this.cases.push([e,t]),this}match(e){var t,r,n,a;for(t=0,r=this.cases.length;t<r;){if(e instanceof(n=this.cases[t][0])&&(a=n.unapply(e)).isDefined)return this.cases[t][1](a.get);t+=1}throw new C(e)}}class C{constructor(e){this.obj=e}toString(){return"MatchError("+this.obj+")"}}class b{constructor(e,t){this.head=e,this.tail=t}toString(){return"("+this.head+"~"+this.tail+")"}static unapply(e){return new Option.Some([e.head,e.tail])}}class M{constructor(e,t){this.source=e,this.offset=void 0===t?0:t,this._index=null,this._line=null}index(){if(null!==this._index)return this._index;this._index=[],this._index.push(0);for(var e=0;e<this.source.length;)"\n"===this.source.charAt(e)&&this._index.push(e+1),e+=1;return this._index.push(this.source.length),this._index}line(){var e,t,r;if(null!==this._line)return this._line;for(e=0,t=this.index().length-1;e+1<t;)r=t+e>>1,this.offset<this.index()[r]?t=r:e=r;return this._line=e+1,this._line}column(){return this.offset-this.index()[this.line()-1]+1}lineContents(){var e,t;return e=this.index(),t=this.line(),this.source.substring(e[t-1],e[t])}toString(){return this.line().toString()+"."+this.column()}longString(){var e,t;for(e=this.lineContents()+"\n",t=0;t<this.column();)"\t"===this.lineContents().charAt(t)?e+="\t":e+=" ",t+=1;return e+="^"}isLessThan(e){return e instanceof M?this.offset<e.offset:this.line()<e.line()||this.line()===e.line()&&this.column()<e.column()}}class P{constructor(e,t,r){this.source=e,this.offset=t,this.context=r}first(){return this.offset<this.source.length?this.source.charAt(this.offset):P.EofCh}rest(){return this.offset<this.source.length?new P(this.source,this.offset+1,this.context):this}pos(){return new M(this.source,this.offset)}atEnd(){return this.offset>=this.source.length}drop(e){var t,r;for(t=this,r=e;r>0;)t=t.rest(),r-=1;return t}}P.EofCh="\x03";class B{static parse(e,t){return e.apply(t)}static parseAll(e,t){return e.andl(function(){return B.eos()}).apply(t)}static parseString(e,t){var r=new P(t,0,{lastNoSuccess:void 0});return B.parse(e,r)}static parseAllString(e,t){var r=new P(t,0,{lastNoSuccess:void 0});return B.parseAll(e,r)}static _handleWhiteSpace(e){var t=e.context.whiteSpaceRegex,r=e.source,n=e.offset,a=t.exec(r.substring(n,r.length));return null!==a?n+a[0].length:n}static literal(e){return new D(function(t){var r,n,a,i,o,s;for(r=t.source,n=t.offset,i=0,o=a=B._handleWhiteSpace(t);i<e.length&&o<r.length&&e.charAt(i)===r.charAt(o);)i+=1,o+=1;return i===e.length?new L(e,t.drop(o-n)):(s=a===r.length?"end of source":"`"+r.charAt(a)+"'",new O("`"+e+"' expected but "+s+" found",t.drop(a-n)))})}static regex(e){if("/^"!==e.toString().substring(0,2))throw"regex must start with `^' but "+e;return new D(function(t){var r,n,a,i;return r=t.source,n=t.offset,null!==(a=e.exec(r.substring(n,r.length)))?new L(a[0],t.drop(a[0].length)):(i=n===r.length?"end of source":"`"+r.charAt(n)+"'",new O("string matching regex "+e+" expected but "+i+" found",t))})}static regexLiteral(e){if("/^"!==e.toString().substring(0,2))throw"regex must start with `^' but "+e;return new D(function(t){var r,n,a,i,o;return r=t.source,n=t.offset,a=B._handleWhiteSpace(t),null!==(i=e.exec(r.substring(a,r.length)))?new L(i[0],t.drop(a+i[0].length-n)):(o=a===r.length?"end of source":"`"+r.charAt(a)+"'",new O("string matching regex "+e+" expected but "+o+" found",t.drop(a-n)))})}static eos(){return new D(function(e){var t,r;return t=e.source,e.offset,r=B._handleWhiteSpace(e),t.length===r?new L("",e):new O("end of source expected but `"+t.charAt(r)+"' found",e)})}static commit(e){return new D(function(t){var r=e()(t);return(new y).Case(L,function(e){return r}).Case(k,function(e){return r}).Case(O,function(e){return new k(e[0],e[1])}).match(r)})}static elem(e){return B.accept(e).named('"'+e+'"')}static accept(e){return B.acceptIf(function(t){return t===e},function(t){return"`"+e+"' expected but `"+t+"' found"})}static acceptIf(e,t){return new D(function(r){return e(r.first())?new L(r.first(),r.rest()):new O(t(r.first()),r)})}static failure(e){return new D(function(t){return new O(e,t)})}static err(e){return new D(function(t){return new k(e,t)})}static success(e){return new D(function(t){return new L(e,t)})}static log(e,t){return new D(function(r){console.log("trying "+t+" at "+r);var n=e().apply(r);return console.log(t+" --\x3e "+n),n})}static rep(e){var t=B.success(w.empty);return B.rep1(e).or(function(){return t})}static rep1(e){return new D(function(t){var r,n,a,i;if(r=[],n=t,(i=(a=e()).apply(t))instanceof L){for(;i instanceof L;)r.push(i.result),n=i.next,i=a.apply(n);return new L(w.fromArray(r),n)}return i})}static repN(e,t){return 0===e?B.success(w.empty):new D(function(r){var n,a,i,o;for(n=[],a=r,o=(i=t()).apply(a);o instanceof L;){if(n.push(o.result),a=o.next,e===n.length)return new L(w.fromArray(n),a);o=i.apply(a)}return o})}static repsep(e,t){var r=B.success(w.empty);return B.rep1sep(e,t).or(function(){return r})}static rep1sep(e,t){return e().and(B.rep(t().andr(e))).to(function(e){return new w.Cons(e.head,e.tail)})}static chainl1(e,t,r){return e().and(B.rep(r().and(t))).to(function(e){return e.tail.foldLeft(e.head,function(e,t){return t.head(e,t.tail)})})}static chainr1(e,t,r,n){return e().and(this.rep(t().and(e))).to(function(e){return new w.Cons(new b(r,e.head),e.tail).foldRight(n,function(e,t){return e.head(e.tail,t)})})}static opt(e){return e().to(function(e){return new x.Some(e)}).or(function(){return B.success(x.empty)})}static not(e){return new D(function(t){return e().apply(t).successful?new O("Expected failure",t):new L(x.empty,t)})}static guard(e){return new D(function(t){var r=e().apply(t);return r.successful?new L(r.result,t):r})}static mkList(e){return new w.Cons(e.head,e.tail)}static fun(e){return function(){return e}}static lazyParser(e){var t,r;return e instanceof String||"string"==typeof e?(t=B.literal(e),function(){return t}):e instanceof Function?e:e instanceof Object?e instanceof D?function(){return e}:e instanceof RegExp?(r=B.regexLiteral(e),function(){return r}):B.err("unhandlable type"):B.err("unhandlable type")}static seq(){var e,t,r;if(0===(e=arguments.length))return B.err("at least one element must be specified");for(t=B.lazyParser(arguments[0])(),r=1;r<e;)t=t.and(B.lazyParser(arguments[r])),r+=1;return t}static or(){var e,t,r;if(0===(e=arguments.length))return B.err("at least one element must be specified");for(t=B.lazyParser(arguments[0])(),r=1;r<e;)t=t.or(B.lazyParser(arguments[r])),r+=1;return t}}class A{constructor(){}isEmpty(){return!this.successful}getOrElse(e){return this.isEmpty?e():this.get()}}B.ParseResult=A;class L extends A{constructor(e,t){super(),this.result=e,this.next=t}get successful(){return!0}map(e){return new L(e(this.result),this.next)}mapPartial(e,t){try{return new L(e(this.result),this.next)}catch(e){if(e instanceof C)return new O(t(this.result),this.next);throw e}}flatMapWithNext(e){return e(this.result).apply(this.next)}append(e){return this}get(){return this.result}toString(){return"["+this.next.pos()+"] parsed: "+this.result}static unapply(e){return new x.Some([e.result,e.next])}}B.Success=L;class E extends A{constructor(){super()}get successful(){return!1}_setLastNoSuccess(){var e=this.next.context;void 0!==e.lastNoSuccess&&this.next.pos().isLessThan(e.lastNoSuccess.next.pos())||(e.lastNoSuccess=this)}map(e){return this}mapPartial(e,t){return this}flatMapWithNext(e){return this}get(){return B.error("No result when parsing failed")}}B.NoSuccess=E;class O extends E{constructor(e,t){super(),this.msg=e,this.next=t,this._setLastNoSuccess()}append(e){var t=e();if(t instanceof L)return t;if(t instanceof E)return t.next.pos().isLessThan(this.next.pos())?this:t;throw new C(t)}toString(){return"["+this.next.pos()+"] failure: "+this.msg+"\n\n"+this.next.pos().longString()}static unapply(e){return new x.Some([e.msg,e.next])}}B.Failure=O;class k extends E{constructor(e,t){super(),this.msg=e,this.next=t,this._setLastNoSuccess()}append(e){return this}toString(){return"["+this.next.pos()+"] error: "+this.msg+"\n\n"+this.next.pos().longString()}static unapply(e){return new x.Some([e.msg,e.next])}}B.ParseError=k;class D{constructor(e){this.apply=e,this.name=""}named(e){return this.name=e,this}toString(){return"Parser ("+this.name+")"}flatMap(e){var t=this;return new D(function(r){return t.apply(r).flatMapWithNext(e)})}map(e){var t=this;return new D(function(r){return t.apply(r).map(e)})}append(e){var t=this;return new D(function(r){return t.apply(r).append(function(){return e().apply(r)})})}and(e){return this.flatMap(function(t){return e().map(function(e){return new b(t,e)})}).named("~")}andr(e){return this.flatMap(function(t){return e().map(function(e){return e})}).named("~>")}andl(e){return this.flatMap(function(t){return e().map(function(e){return t})}).named("<~")}or(e){return this.append(e).named("|")}andOnce(e){var t=this;return new j(function(){return t.flatMap(function(t){return B.commit(e).map(function(e){return new b(t,e)})}).named("~!")})}longestOr(e){var t=this;return new D(function(r){var n,a;return n=t.apply(r),a=e()(r),n.successful?a.successful?a.next.pos().isLessThan(n.next.pos())?n:a:n:a.successful?a:n instanceof k||a.next.pos().isLessThan(n.next.pos())?n:a}).named("|||")}to(e){return this.map(e).named(this.toString()+"^^")}ret(e){var t=this;return new D(function(r){return t.apply(r).map(function(t){return e()})}).named(this.toString()+"^^^")}toIfPossible(e,t){void 0===t&&(t=function(e){return"Constructor function not defined at "+e});var r=this;return new D(function(n){return r.apply(n).mapPartial(e,t)}).named(this.toString()+"^?")}into(e){return this.flatMap(e)}rep(){var e=this;return B.rep(function(){return e})}chain(e){var t,r;return t=this,r=function(){return t},B.chainl1(r,r,e)}rep1(){var e=this;return B.rep1(function(){return e})}opt(){var e=this;return B.opt(function(){return e})}}B.Parser=D;class j extends D{constructor(e){super(e)}and(e){var t=this;return new j(function(){return t.flatMap(function(t){return B.commit(e).map(function(e){return b(t,e)})})}).named("~")}}B.OnceParser=j;const T=MathJax._.core.MmlTree.MML.MML,R=MathJax._.core.MmlTree.MmlNode,F=R.TEXCLASS,I=(R.TEXCLASSNAMES,R.MATHVARIANTS,R.indentAttributes,R.AbstractMmlNode);R.AbstractMmlTokenNode,R.AbstractMmlLayoutNode,R.AbstractMmlBaseNode,R.AbstractMmlEmptyNode,R.TextNode,R.XMLNode;class z{constructor(){this.userModifierMap={}}get(e){var t=z.embeddedModifierMap[e];return void 0!==t?t:this.userModifierMap[e]}put(e,t){void 0===z.embeddedModifierMap[e]&&(this.userModifierMap[e]=t)}}const Q={repositories:{modifierRepository:new z,dirRepository:new class{constructor(){this.userDirMap={}}get(e){return this.userDirMap[e]}put(e,t){this.userDirMap[e]=t}}},xypicCommandIdCounter:0,xypicCommandMap:{},textObjectIdCounter:0,wrapperOfTextObjectMap:{}};class W{}class N extends I{constructor(e,t,r){super(e,t,r),this.textMmls=r,this.texClass=F.ORD;const n=t["data-cmd-id"],a=Q.xypicCommandMap[n];this.cmd=a;const i=JSON.parse(t["data-text-mml-ids"]);for(let e=0,t=i.length;e<t;e++)r[e].xypicTextObjectId=i[e]}}N.defaults=I.defaults,W.xypic=class extends N{constructor(e,t,r){super(e,t,r)}get kind(){return"xypic"}toString(){return this.kind+"("+this.cmd+")"}},W.xypic.defaults=N.defaults,T[W.xypic.prototype.kind]=W.xypic,W.xypic.newdir=class extends N{constructor(e,t,r){super(e,t,r)}get kind(){return"xypic-newdir"}toString(){return this.kind+"("+this.cmd+")"}},W.xypic.newdir.defaults=N.defaults,T[W.xypic.newdir.prototype.kind]=W.xypic.newdir,W.xypic.includegraphics=class extends N{constructor(e,t,r){super(e,t,r)}get kind(){return"xypic-includegraphics"}toString(){return this.kind+"("+this.cmd+")"}},W.xypic.includegraphics.defaults=N.defaults,T[W.xypic.includegraphics.prototype.kind]=W.xypic.includegraphics,W.PosDecor=class{constructor(e,t){this.pos=e,this.decor=t}toString(){return this.pos.toString()+" "+this.decor}},W.Pos=class{},W.Pos.Coord=class{constructor(e,t){this.coord=e,this.pos2s=t}toString(){return this.coord.toString()+" "+this.pos2s.mkString(" ")}},W.Pos.Plus=class{constructor(e){this.coord=e}toString(){return"+("+this.coord+")"}},W.Pos.Minus=class{constructor(e){this.coord=e}toString(){return"-("+this.coord+")"}},W.Pos.Skew=class{constructor(e){this.coord=e}toString(){return"!("+this.coord+")"}},W.Pos.Cover=class{constructor(e){this.coord=e}toString(){return".("+this.coord+")"}},W.Pos.Then=class{constructor(e){this.coord=e}toString(){return",("+this.coord+")"}},W.Pos.SwapPAndC=class{constructor(e){this.coord=e}toString(){return";("+this.coord+")"}},W.Pos.SetBase=class{constructor(e){this.coord=e}toString(){return":("+this.coord+")"}},W.Pos.SetYBase=class{constructor(e){this.coord=e}toString(){return"::("+this.coord+")"}},W.Pos.ConnectObject=class{constructor(e){this.object=e}toString(){return"**("+this.object+")"}},W.Pos.DropObject=class{constructor(e){this.object=e}toString(){return"*("+this.object+")"}},W.Pos.Place=class{constructor(e){this.place=e}toString(){return"?("+this.place+")"}},W.Pos.PushCoord=class{constructor(e){this.coord=e}toString(){return"@+("+this.coord+")"}},W.Pos.EvalCoordThenPop=class{constructor(e){this.coord=e}toString(){return"@-("+this.coord+")"}},W.Pos.LoadStack=class{constructor(e){this.coord=e}toString(){return"@=("+this.coord+")"}},W.Pos.DoCoord=class{constructor(e){this.coord=e}toString(){return"@@("+this.coord+")"}},W.Pos.InitStack=class{constructor(){}toString(){return"@i"}},W.Pos.EnterFrame=class{constructor(){}toString(){return"@("}},W.Pos.LeaveFrame=class{constructor(){}toString(){return"@)"}},W.Pos.SavePos=class{constructor(e){this.id=e}toString(){return'="'+this.id+'"'}},W.Pos.SaveMacro=class{constructor(e,t){this.macro=e,this.id=t}toString(){return"=("+this.macro+' "'+this.id+'")'}},W.Pos.SaveBase=class{constructor(e){this.id=e}toString(){return'=:"'+this.id+'"'}},W.Pos.SaveStack=class{constructor(e){this.id=e}toString(){return'=@"'+this.id+'"'}},W.Coord=class{},W.Coord.Vector=class{constructor(e){this.vector=e}toString(){return this.vector.toString()}},W.Coord.C=class{toString(){return"c"}},W.Coord.P=class{toString(){return"p"}},W.Coord.X=class{toString(){return"x"}},W.Coord.Y=class{toString(){return"y"}},W.Coord.Id=class{constructor(e){this.id=e}toString(){return'"'+this.id+'"'}},W.Coord.Group=class{constructor(e){this.posDecor=e}toString(){return"{"+this.posDecor+"}"}},W.Coord.StackPosition=class{constructor(e){this.number=e}toString(){return"s{"+this.number+"}"}},W.Coord.DeltaRowColumn=class{constructor(e,t,r){this.prefix=e,this.dr=t,this.dc=r}toString(){return"["+(""===this.prefix?"":'"'+this.prefix+'"')+this.dr+","+this.dc+"]"}},W.Coord.Hops=class{constructor(e,t){this.prefix=e,this.hops=t}toString(){return"["+(""===this.prefix?"":'"'+this.prefix+'"')+this.hops.mkString("")+"]"}},W.Coord.HopsWithPlace=class{constructor(e,t,r){this.prefix=e,this.hops=t,this.place=r}toString(){return"["+(""===this.prefix?"":'"'+this.prefix+'"')+this.hops.mkString("")+this.place+"]"}},W.Vector=class{},W.Vector.InCurBase=class{constructor(e,t){this.x=e,this.y=t}toString(){return"("+this.x+", "+this.y+")"}},W.Vector.Abs=class{constructor(e,t){this.x=e,this.y=t}toString(){return"<"+this.x+", "+this.y+">"}},W.Vector.Angle=class{constructor(e){this.degree=e}toString(){return"a("+this.degree+")"}},W.Vector.Dir=class{constructor(e,t){this.dir=e,this.dimen=t}toString(){return"/"+this.dir+" "+this.dimen+"/"}},W.Vector.Corner=class{constructor(e,t){this.corner=e,this.factor=t}toString(){return this.corner.toString()+"("+this.factor+")"}},W.Corner=class{},W.Corner.L=class{toString(){return"L"}},W.Corner.R=class{toString(){return"R"}},W.Corner.D=class{toString(){return"D"}},W.Corner.U=class{toString(){return"U"}},W.Corner.CL=class{toString(){return"CL"}},W.Corner.CR=class{toString(){return"CR"}},W.Corner.CD=class{toString(){return"CD"}},W.Corner.CU=class{toString(){return"CU"}},W.Corner.LD=class{toString(){return"LD"}},W.Corner.RD=class{toString(){return"RD"}},W.Corner.LU=class{toString(){return"LU"}},W.Corner.RU=class{toString(){return"RU"}},W.Corner.NearestEdgePoint=class{toString(){return"E"}},W.Corner.PropEdgePoint=class{toString(){return"P"}},W.Corner.Axis=class{toString(){return"A"}},W.Place=class{constructor(e,t,r,n){this.shaveP=e,this.shaveC=t,this.factor=r,this.slide=n}compound(e){return new W.Place(this.shaveP+e.shaveP,this.shaveC+e.shaveC,void 0===e.factor?this.factor:e.factor,e.slide)}toString(){for(var e="",t=0;t<this.shaveP;t++)e+="<";for(var r=0;r<this.shaveC;r++)e+=">";return void 0!==this.factor&&(e+="("+this.factor+")"),this.slide.dimen.foreach(function(t){e+="/"+t+"/"}),e}},W.Place.Factor=class{constructor(e){this.factor=e}get isIntercept(){return!1}toString(){return this.factor.toString()}},W.Place.Intercept=class{constructor(e){this.pos=e}get isIntercept(){return!0}toString(){return"!{"+this.pos+"}"}},W.Slide=class{constructor(e){this.dimen=e}toString(){return this.dimen.getOrElse("")}},W.Object=class{constructor(e,t){this.modifiers=e,this.object=t}dirVariant(){return this.object.dirVariant()}dirMain(){return this.object.dirMain()}isDir(){return this.object.isDir()}toString(){return this.modifiers.mkString()+this.object.toString()}},W.ObjectBox=class{constructor(){}get isEmpty(){return!1}dirVariant(){}dirMain(){}isDir(){return!1}},W.ObjectBox.Text=class extends W.ObjectBox{constructor(e){super(),this.math=e}toString(){return"{"+this.math.toString()+"}"}},W.ObjectBox.Empty=class extends W.ObjectBox{constructor(){super()}get isEmpty(){return!0}toString(){return"{}"}},W.ObjectBox.Xymatrix=class extends W.ObjectBox{constructor(e){super(),this.xymatrix=e}toString(){return this.xymatrix.toString()}},W.ObjectBox.Txt=class extends W.ObjectBox{constructor(e,t){super(),this.width=e,this.textObject=t}toString(){return"\\txt"+this.width+"{"+this.textObject.toString()+"}"}},W.ObjectBox.Txt.Width=class extends W.ObjectBox{constructor(){super()}},W.ObjectBox.Txt.Width.Vector=class extends W.ObjectBox{constructor(e){super(),this.vector=e}toString(){return this.vector.toString()}},W.ObjectBox.Txt.Width.Default=class extends W.ObjectBox{constructor(){super()}toString(){return""}},W.ObjectBox.WrapUpObject=class extends W.ObjectBox{constructor(e){super(),this.object=e}toString(){return"\\object"+this.object.toString()}},W.ObjectBox.CompositeObject=class extends W.ObjectBox{constructor(e){super(),this.objects=e}toString(){return"\\composite{"+this.objects.mkString(" * ")+"}"}},W.ObjectBox.Xybox=class extends W.ObjectBox{constructor(e){super(),this.posDecor=e}toString(){return"\\xybox{"+this.posDecor.toString()+"}"}},W.ObjectBox.Cir=class extends W.ObjectBox{constructor(e,t){super(),this.radius=e,this.cir=t}toString(){return"\\cir"+this.radius+"{"+this.cir+"}"}},W.ObjectBox.Cir.Radius=class{},W.ObjectBox.Cir.Radius.Vector=class{constructor(e){this.vector=e}toString(){return this.vector.toString()}},W.ObjectBox.Cir.Radius.Default=class{toString(){return""}},W.ObjectBox.Cir.Cir=class{},W.ObjectBox.Cir.Cir.Segment=class{constructor(e,t,r){this.startDiag=e,this.orient=t,this.endDiag=r}toString(){return this.startDiag.toString()+this.orient+this.endDiag}},W.ObjectBox.Cir.Cir.Full=class{toString(){return""}},W.ObjectBox.Dir=class extends W.ObjectBox{constructor(e,t){super(),this.variant=e,this.main=t}dirVariant(){return this.variant}dirMain(){return this.main}isDir(){return!0}toString(){return"\\dir"+this.variant+"{"+this.main+"}"}},W.ObjectBox.Curve=class extends W.ObjectBox{constructor(e,t,r){super(),this.modifiers=e,this.objects=t,this.poslist=r}dirVariant(){return""}dirMain(){return"-"}isDir(){return!1}toString(){return"\\curve"+this.modifiers.mkString("")+"{"+this.objects.mkString(" ")+" "+this.poslist.mkString("&")+"}"}},W.ObjectBox.Curve.Modifier=class{},W.ObjectBox.Curve.Modifier.p=class{toString(){return"~p"}},W.ObjectBox.Curve.Modifier.P=class{toString(){return"~P"}},W.ObjectBox.Curve.Modifier.l=class{toString(){return"~l"}},W.ObjectBox.Curve.Modifier.L=class{toString(){return"~L"}},W.ObjectBox.Curve.Modifier.c=class{toString(){return"~c"}},W.ObjectBox.Curve.Modifier.C=class{toString(){return"~C"}},W.ObjectBox.Curve.Modifier.pc=class{toString(){return"~pc"}},W.ObjectBox.Curve.Modifier.pC=class{toString(){return"~pC"}},W.ObjectBox.Curve.Modifier.Pc=class{toString(){return"~Pc"}},W.ObjectBox.Curve.Modifier.PC=class{toString(){return"~PC"}},W.ObjectBox.Curve.Modifier.lc=class{toString(){return"~lc"}},W.ObjectBox.Curve.Modifier.lC=class{toString(){return"~lC"}},W.ObjectBox.Curve.Modifier.Lc=class{toString(){return"~Lc"}},W.ObjectBox.Curve.Modifier.LC=class{toString(){return"~LC"}},W.ObjectBox.Curve.Modifier.cC=class{toString(){return"~cC"}},W.ObjectBox.Curve.Object=class{},W.ObjectBox.Curve.Object.Drop=class{constructor(e){this.object=e}toString(){return"~*"+this.object}},W.ObjectBox.Curve.Object.Connect=class{constructor(e){this.object=e}toString(){return"~**"+this.object}},W.ObjectBox.Curve.PosList=class{},W.ObjectBox.Curve.PosList.CurPos=class{toString(){return""}},W.ObjectBox.Curve.PosList.Pos=class{constructor(e){this.pos=e}toString(){return this.pos.toString()}},W.ObjectBox.Curve.PosList.AddStack=class{toString(){return"~@"}},W.Modifier=class{},W.Modifier.Vector=class extends W.Modifier{constructor(e){super(),this.vector=e}toString(){return"!"+this.vector}},W.Modifier.RestoreOriginalRefPoint=class extends W.Modifier{constructor(){super()}toString(){return"!"}},W.Modifier.AddOp=class extends W.Modifier{constructor(e,t){super(),this.op=e,this.size=t}toString(){return this.op.toString()+" "+this.size}},W.Modifier.AddOp.Grow=class{toString(){return"+"}},W.Modifier.AddOp.Shrink=class{toString(){return"-"}},W.Modifier.AddOp.Set=class{toString(){return"="}},W.Modifier.AddOp.GrowTo=class{toString(){return"+="}},W.Modifier.AddOp.ShrinkTo=class{toString(){return"-="}},W.Modifier.AddOp.VactorSize=class{constructor(e){this.vector=e}get isDefault(){return!1}toString(){return this.vector.toString()}},W.Modifier.AddOp.DefaultSize=class{constructor(){}get isDefault(){return!0}toString(){return""}},W.Modifier.Shape=class{},W.Modifier.Shape.Point=class extends W.Modifier{constructor(){super()}toString(){return"[.]"}},W.Modifier.Shape.Rect=class extends W.Modifier{constructor(){super()}toString(){return"[]"}},W.Modifier.Shape.Alphabets=class extends W.Modifier{constructor(e){super(),this.alphabets=e}toString(){return"["+this.alphabets+"]"}},W.Modifier.Shape.DefineShape=class extends W.Modifier{constructor(e){super(),this.shape=e}toString(){return"["+this.shape+"]"}},W.Modifier.Shape.Circle=class extends W.Modifier{constructor(){super()}toString(){return"[o]"}},W.Modifier.Shape.L=class extends W.Modifier{constructor(){super()}toString(){return"[l]"}},W.Modifier.Shape.R=class extends W.Modifier{constructor(){super()}toString(){return"[r]"}},W.Modifier.Shape.U=class extends W.Modifier{constructor(){super()}toString(){return"[u]"}},W.Modifier.Shape.D=class extends W.Modifier{constructor(){super()}toString(){return"[d]"}},W.Modifier.Shape.C=class extends W.Modifier{constructor(){super()}toString(){return"[c]"}},W.Modifier.Shape.ChangeColor=class extends W.Modifier{constructor(e){super(),this.colorName=e}toString(){return"["+this.colorName+"]"}},W.Modifier.Shape.CompositeModifiers=class extends W.Modifier{constructor(e){super(),this.modifiers=e}toString(){return this.modifiers.mkString("")}},W.Modifier.Shape.Frame=class extends W.Modifier{constructor(e,t){super(),this.main=e,this.options=t}toString(){return"[F"+this.main+this.options.mkString("")+"]"}},W.Modifier.Shape.Frame.Radius=class{constructor(e){this.vector=e}toString(){return":"+this.vector}},W.Modifier.Shape.Frame.Color=class{constructor(e){this.colorName=e}toString(){return":"+this.colorName}},W.Modifier.Invisible=class extends W.Modifier{constructor(){super()}toString(){return"i"}},W.Modifier.Hidden=class extends W.Modifier{constructor(){super()}toString(){return"h"}},W.Modifier.Direction=class extends W.Modifier{constructor(e){super(),this.direction=e}toString(){return this.direction.toString()}},W.Direction=class{},W.Direction.Compound=class{constructor(e,t){this.dir=e,this.rots=t}toString(){return this.dir.toString()+this.rots.mkString()}},W.Direction.Diag=class{constructor(e){this.diag=e}toString(){return this.diag.toString()}},W.Direction.Vector=class{constructor(e){this.vector=e}toString(){return"v"+this.vector.toString()}},W.Direction.ConstructVector=class{constructor(e){this.posDecor=e}toString(){return"q{"+this.posDecor.toString()+"}"}},W.Direction.RotVector=class{constructor(e){this.vector=e}toString(){return":"+this.vector.toString()}},W.Direction.RotAntiCW=class{toString(){return"_"}},W.Direction.RotCW=class{toString(){return"^"}},W.Diag=class{},W.Diag.Default=class{toString(){return""}},W.Diag.Angle=class{toString(){return this.symbol}},W.Diag.LD=class extends W.Diag.Angle{constructor(){super()}get symbol(){return"ld"}get ang(){return-3*Math.PI/4}turn(e){return"^"===e?new W.Diag.RD:new W.Diag.LU}},W.Diag.RD=class extends W.Diag.Angle{constructor(){super()}get symbol(){return"rd"}get ang(){return-Math.PI/4}turn(e){return"^"===e?new W.Diag.RU:new W.Diag.LD}},W.Diag.LU=class extends W.Diag.Angle{constructor(){super()}get symbol(){return"lu"}get ang(){return 3*Math.PI/4}turn(e){return"^"===e?new W.Diag.LD:new W.Diag.RU}},W.Diag.RU=class extends W.Diag.Angle{constructor(){super()}get symbol(){return"ru"}get ang(){return Math.PI/4}turn(e){return"^"===e?new W.Diag.LU:new W.Diag.RD}},W.Diag.L=class extends W.Diag.Angle{constructor(){super()}get symbol(){return"l"}get ang(){return Math.PI}turn(e){return"^"===e?new W.Diag.D:new W.Diag.U}},W.Diag.R=class extends W.Diag.Angle{constructor(){super()}get symbol(){return"r"}get ang(){return 0}turn(e){return"^"===e?new W.Diag.U:new W.Diag.D}},W.Diag.D=class extends W.Diag.Angle{constructor(){super()}get symbol(){return"d"}get ang(){return-Math.PI/2}turn(e){return"^"===e?new W.Diag.R:new W.Diag.L}},W.Diag.U=class extends W.Diag.Angle{constructor(){super()}get symbol(){return"u"}get ang(){return Math.PI/2}turn(e){return"^"===e?new W.Diag.L:new W.Diag.R}},W.ObjectBox.Frame=class extends W.ObjectBox{constructor(e,t){super(),this.radius=e,this.main=t}toString(){return"\\frm"+this.radius+"{"+this.main+"}"}},W.ObjectBox.Frame.Radius=class{},W.ObjectBox.Frame.Radius.Vector=class{constructor(e){this.vector=e}toString(){return this.vector.toString()}},W.ObjectBox.Frame.Radius.Default=class{toString(){return""}},W.Decor=class{constructor(e){this.commands=e}toString(){return this.commands.mkString(" ")}},W.Command=class{},W.Command.Save=class{constructor(e){this.pos=e}toString(){return"\\save "+this.pos}},W.Command.Restore=class{toString(){return"\\restore"}},W.Command.Pos=class{constructor(e){this.pos=e}toString(){return"\\POS "+this.pos}},W.Command.AfterPos=class{constructor(e,t){this.decor=e,this.pos=t}toString(){return"\\afterPOS{"+this.decor+"} "+this.pos}},W.Command.Drop=class{constructor(e){this.object=e}toString(){return"\\drop "+this.object}},W.Command.Connect=class{constructor(e){this.object=e}toString(){return"\\connect "+this.object}},W.Command.Relax=class{toString(){return"\\relax"}},W.Command.Ignore=class{constructor(e,t){this.pos=e,this.decor=t}toString(){return"\\ignore{"+this.pos+" "+this.decor+"}"}},W.Command.ShowAST=class{constructor(e,t){this.pos=e,this.decor=t}toString(){return"\\xyshowAST{"+this.pos+" "+this.decor+"}"}},W.Command.Path=class{constructor(e){this.path=e}toString(){return"\\PATH "+this.path}},W.Command.AfterPath=class{constructor(e,t){this.decor=e,this.path=t}toString(){return"\\afterPATH{"+this.decor+"} "+this.path}},W.Command.Path.Path=class{constructor(e){this.pathElements=e}toString(){return this.pathElements.mkString("[",", ","]")}},W.Command.Path.SetBeforeAction=class{constructor(e){this.posDecor=e}toString(){return"~={"+this.posDecor+"}"}},W.Command.Path.SetAfterAction=class{constructor(e){this.posDecor=e}toString(){return"~/{"+this.posDecor+"}"}},W.Command.Path.AddLabelNextSegmentOnly=class{constructor(e){this.labels=e}toString(){return"~<{"+this.labels+"}"}},W.Command.Path.AddLabelLastSegmentOnly=class{constructor(e){this.labels=e}toString(){return"~>{"+this.labels+"}"}},W.Command.Path.AddLabelEverySegment=class{constructor(e){this.labels=e}toString(){return"~+{"+this.labels+"}"}},W.Command.Path.StraightSegment=class{constructor(e){this.segment=e}toString(){return"'"+this.segment}},W.Command.Path.TurningSegment=class{constructor(e,t){this.turn=e,this.segment=t}toString(){return"`"+this.turn+" "+this.segment}},W.Command.Path.LastSegment=class{constructor(e){this.segment=e}toString(){return this.segment.toString()}},W.Command.Path.Turn=class{},W.Command.Path.Turn.Diag=class{constructor(e,t){this.diag=e,this.radius=t}toString(){return this.diag.toString()+" "+this.radius}},W.Command.Path.Turn.Cir=class{constructor(e,t){this.cir=e,this.radius=t}toString(){return this.cir.toString()+" "+this.radius}},W.Command.Path.TurnRadius=class{},W.Command.Path.TurnRadius.Default=class{toString(){return""}},W.Command.Path.TurnRadius.Dimen=class{constructor(e){this.dimen=e}toString(){return"/"+this.dimen}},W.Command.Path.Segment=class{constructor(e,t,r){this.pos=e,this.slide=t,this.labels=r}toString(){return this.pos.toString()+" "+this.slide+" "+this.labels}},W.Command.Path.Labels=class{constructor(e){this.labels=e}toString(){return this.labels.mkString(" ")}},W.Command.Path.Label=class{constructor(e,t,r){this.anchor=e,this.it=t,this.aliasOption=r}},W.Command.Path.Label.Above=class extends W.Command.Path.Label{constructor(e,t,r){super(e,t,r)}toString(){return"^("+this.anchor+" "+this.it+" "+this.aliasOption+")"}},W.Command.Path.Label.Below=class extends W.Command.Path.Label{constructor(e,t,r){super(e,t,r)}toString(){return"_("+this.anchor+" "+this.it+" "+this.aliasOption+")"}},W.Command.Path.Label.At=class extends W.Command.Path.Label{constructor(e,t,r){super(e,t,r)}toString(){return"|("+this.anchor+" "+this.it+" "+this.aliasOption+")"}},W.Command.Ar=class{constructor(e,t){this.forms=e,this.path=t}toString(){return"\\ar "+this.forms.mkString(" ")+" "+this.path}},W.Command.Ar.Form=class{},W.Command.Ar.Form.BuildArrow=class extends W.Command.Ar.Form{constructor(e,t,r,n){super(),this.variant=e,this.tailTip=t,this.stemConn=r,this.headTip=n}toString(){return"@"+this.variant+"{"+this.tailTip.toString()+", "+this.stemConn.toString()+", "+this.headTip.toString()+"}"}},W.Command.Ar.Form.ChangeVariant=class extends W.Command.Ar.Form{constructor(e){super(),this.variant=e}toString(){return"@"+this.variant}},W.Command.Ar.Form.Tip=class{},W.Command.Ar.Form.Tip.Tipchars=class{constructor(e){this.tipchars=e}toString(){return this.tipchars}},W.Command.Ar.Form.Tip.Object=class{constructor(e){this.object=e}toString(){return"*"+this.object}},W.Command.Ar.Form.Tip.Dir=class{constructor(e){this.dir=e}toString(){return this.dir}},W.Command.Ar.Form.Conn=class{},W.Command.Ar.Form.Conn.Connchars=class{constructor(e){this.connchars=e}toString(){return this.connchars}},W.Command.Ar.Form.Conn.Object=class{constructor(e){this.object=e}toString(){return"*"+this.object}},W.Command.Ar.Form.Conn.Dir=class{constructor(e){this.dir=e}toString(){return this.dir}},W.Command.Ar.Form.ChangeStem=class{constructor(e){this.connchar=e}toString(){return"@"+this.connchar}},W.Command.Ar.Form.DashArrowStem=class{toString(){return"@!"}},W.Command.Ar.Form.CurveArrow=class{constructor(e,t){this.direction=e,this.dist=t}toString(){return"@/"+this.direction+" "+this.dist+"/"}},W.Command.Ar.Form.CurveFitToDirection=class{constructor(e,t){this.outDirection=e,this.inDirection=t}toString(){return"@("+this.outDirection+","+this.inDirection+")"}},W.Command.Ar.Form.CurveWithControlPoints=class{constructor(e){this.coord=e}toString(){return"@`{"+this.coord+"}"}},W.Command.Ar.Form.AddShape=class{constructor(e){this.shape=e}toString(){return"@["+this.shape+"]"}},W.Command.Ar.Form.AddModifiers=class{constructor(e){this.modifiers=e}toString(){return"@*{"+this.modifiers.mkString(" ")+"}"}},W.Command.Ar.Form.Slide=class{constructor(e){this.slideDimen=e}toString(){return"@<"+this.slideDimen+">"}},W.Command.Ar.Form.LabelAt=class{constructor(e,t){this.anchor=e,this.it=t}toString(){return"|"+this.anchor+" "+this.it}},W.Command.Ar.Form.LabelAbove=class{constructor(e,t){this.anchor=e,this.it=t}toString(){return"^"+this.anchor+" "+this.it}},W.Command.Ar.Form.LabelBelow=class{constructor(e,t){this.anchor=e,this.it=t}toString(){return"_"+this.anchor+" "+this.it}},W.Command.Ar.Form.ReverseAboveAndBelow=class{toString(){return"@?"}},W.Command.Xymatrix=class{constructor(e,t){this.setup=e,this.rows=t}toString(){return"\\xymatrix"+this.setup+"{\n"+this.rows.mkString("","\\\\\n","")+"\n}"}},W.Command.Xymatrix.Setup=class{},W.Command.Xymatrix.Setup.Prefix=class{constructor(e){this.prefix=e}toString(){return'"'+this.prefix+'"'}},W.Command.Xymatrix.Setup.ChangeSpacing=class{constructor(e,t){this.addop=e,this.dimen=t}},W.Command.Xymatrix.Setup.ChangeSpacing.Row=class extends W.Command.Xymatrix.Setup.ChangeSpacing{constructor(e,t){super(e,t)}toString(){return"@R"+this.addop+this.dimen}},W.Command.Xymatrix.Setup.ChangeSpacing.Column=class extends W.Command.Xymatrix.Setup.ChangeSpacing{constructor(e,t){super(e,t)}toString(){return"@C"+this.addop+this.dimen}},W.Command.Xymatrix.Setup.ChangeSpacing.RowAndColumn=class extends W.Command.Xymatrix.Setup.ChangeSpacing{constructor(e,t){super(e,t)}toString(){return"@"+this.addop+this.dimen}},W.Command.Xymatrix.Setup.PretendEntrySize=class{constructor(e){this.dimen=e}},W.Command.Xymatrix.Setup.PretendEntrySize.Height=class extends W.Command.Xymatrix.Setup.PretendEntrySize{constructor(e){super(e)}toString(){return"@!R="+this.dimen}},W.Command.Xymatrix.Setup.PretendEntrySize.Width=class extends W.Command.Xymatrix.Setup.PretendEntrySize{constructor(e){super(e)}toString(){return"@!C="+this.dimen}},W.Command.Xymatrix.Setup.PretendEntrySize.HeightAndWidth=class extends W.Command.Xymatrix.Setup.PretendEntrySize{constructor(e){super(e)}toString(){return"@!="+this.dimen}},W.Command.Xymatrix.Setup.FixGrid=class{},W.Command.Xymatrix.Setup.FixGrid.Row=class extends W.Command.Xymatrix.Setup.FixGrid{constructor(){super()}toString(){return"@!R"}},W.Command.Xymatrix.Setup.FixGrid.Column=class extends W.Command.Xymatrix.Setup.FixGrid{constructor(){super()}toString(){return"@!C"}},W.Command.Xymatrix.Setup.FixGrid.RowAndColumn=class extends W.Command.Xymatrix.Setup.FixGrid{constructor(){super()}toString(){return"@!"}},W.Command.Xymatrix.Setup.AdjustEntrySize=class{constructor(e,t){this.addop=e,this.dimen=t}},W.Command.Xymatrix.Setup.AdjustEntrySize.Margin=class extends W.Command.Xymatrix.Setup.AdjustEntrySize{constructor(e,t){super(e,t)}toString(){return"@M"+this.addop+this.dimen}},W.Command.Xymatrix.Setup.AdjustEntrySize.Width=class extends W.Command.Xymatrix.Setup.AdjustEntrySize{constructor(e,t){super(e,t)}toString(){return"@W"+this.addop+this.dimen}},W.Command.Xymatrix.Setup.AdjustEntrySize.Height=class extends W.Command.Xymatrix.Setup.AdjustEntrySize{constructor(e,t){super(e,t)}toString(){return"@H"+this.addop+this.dimen}},W.Command.Xymatrix.Setup.AdjustLabelSep=class{constructor(e,t){this.addop=e,this.dimen=t}toString(){return"@L"+this.addop+this.dimen}},W.Command.Xymatrix.Setup.SetOrientation=class{constructor(e){this.direction=e}toString(){return"@"+this.direction}},W.Command.Xymatrix.Setup.AddModifier=class{constructor(e){this.modifier=e}toString(){return"@*"+this.modifier}},W.Command.Xymatrix.Row=class{constructor(e){this.entries=e}toString(){return this.entries.mkString(" & ")}},W.Command.Xymatrix.Entry=class{},W.Command.Xymatrix.Entry.SimpleEntry=class extends W.Command.Xymatrix.Entry{constructor(e,t,r){super(),this.modifiers=e,this.objectbox=t,this.decor=r}get isEmpty(){return!1}toString(){return this.modifiers.mkString("**{","","}")+" "+this.objectbox+" "+this.decor}},W.Command.Xymatrix.Entry.ObjectEntry=class extends W.Command.Xymatrix.Entry{constructor(e,t,r){super(),this.object=e,this.pos=t,this.decor=r}get isEmpty(){return!1}toString(){return"*"+this.object+" "+this.pos+" "+this.decor}},W.Command.Xymatrix.Entry.EmptyEntry=class extends W.Command.Xymatrix.Entry{constructor(e){super(),this.decor=e}get isEmpty(){return!0}toString(){return""+this.decor}},W.Command.Twocell=class{constructor(e,t,r){this.twocell=e,this.switches=t,this.arrow=r}toString(){return this.twocell.toString()+this.switches.mkString("")+this.arrow}},W.Command.Twocell.Hops2cell=class{constructor(e,t){this.hops=e,this.maybeDisplace=t}},W.Command.Twocell.Twocell=class extends W.Command.Twocell.Hops2cell{constructor(e,t){super(e,t)}toString(){return"\\xtwocell["+this.hops+"]"+this.maybeDisplace.getOrElse("{}")}},W.Command.Twocell.UpperTwocell=class extends W.Command.Twocell.Hops2cell{constructor(e,t){super(e,t)}toString(){return"\\xuppertwocell["+this.hops+"]"+this.maybeDisplace.getOrElse("{}")}},W.Command.Twocell.LowerTwocell=class extends W.Command.Twocell.Hops2cell{constructor(e,t){super(e,t)}toString(){return"\\xlowertwocell["+this.hops+"]"+this.maybeDisplace.getOrElse("{}")}},W.Command.Twocell.CompositeMap=class extends W.Command.Twocell.Hops2cell{constructor(e,t){super(e,t)}toString(){return"\\xcompositemap["+this.hops+"]"+this.maybeDisplace.getOrElse("{}")}},W.Command.Twocell.Switch=class{},W.Command.Twocell.Switch.UpperLabel=class{constructor(e){this.label=e}toString(){return"^"+this.label}},W.Command.Twocell.Switch.LowerLabel=class{constructor(e){this.label=e}toString(){return"_"+this.label}},W.Command.Twocell.Switch.SetCurvature=class{constructor(e){this.nudge=e}toString(){return this.nudge.toString()}},W.Command.Twocell.Switch.DoNotSetCurvedArrows=class{toString(){return"\\omit"}},W.Command.Twocell.Switch.PlaceModMapObject=class{toString(){return"~!"}},W.Command.Twocell.Switch.ChangeHeadTailObject=class{constructor(e,t){this.what=e,this.object=t}toString(){return"~"+this.what+"{"+this.object+"}"}},W.Command.Twocell.Switch.ChangeCurveObject=class{constructor(e,t,r){this.what=e,this.spacer=t,this.maybeObject=r}toString(){return"~"+this.what+"{"+this.spacer+(this.maybeObject.isDefined?"~**"+this.maybeObject.get:"")+"}"}},W.Command.Twocell.Label=class{constructor(e,t){this.maybeNudge=e,this.labelObject=t}toString(){return this.maybeNudge.toString()+this.labelObject}},W.Command.Twocell.Nudge=class{},W.Command.Twocell.Nudge.Number=class extends W.Command.Twocell.Nudge{constructor(e){super(),this.number=e}toString(){return"<"+this.number+">"}},W.Command.Twocell.Nudge.Omit=class extends W.Command.Twocell.Nudge{constructor(){super()}toString(){return"<\\omit>"}},W.Command.Twocell.Arrow=class{},W.Command.Twocell.Arrow.WithOrientation=class extends W.Command.Twocell.Arrow{constructor(e,t){super(),this.tok=e,this.labelObject=t}toString(){return"{["+this.tok+"] "+this.labelObject+"}"}},W.Command.Twocell.Arrow.WithPosition=class extends W.Command.Twocell.Arrow{constructor(e,t){super(),this.nudge=e,this.labelObject=t}toString(){return"{["+this.nudge+"] "+this.labelObject+"}"}},W.Command.Newdir=class{constructor(e,t){this.dirMain=e,this.compositeObject=t}toString(){return"\\newdir{"+this.dirMain+"}{"+this.compositeObject+"}"}},W.Pos.Xyimport=class{},W.Pos.Xyimport.TeXCommand=class extends W.Pos.Xyimport{constructor(e,t,r,n,a){super(),this.width=e,this.height=t,this.xOffset=r,this.yOffset=n,this.graphics=a}toString(){return"\\xyimport("+this.width+", "+this.height+")("+this.xOffset+", "+this.yOffset+"){"+this.graphics+"}"}},W.Pos.Xyimport.Graphics=class extends W.Pos.Xyimport{constructor(e,t,r,n,a){super(),this.width=e,this.height=t,this.xOffset=r,this.yOffset=n,this.graphics=a}toString(){return"\\xyimport("+this.width+", "+this.height+")("+this.xOffset+", "+this.yOffset+"){"+this.graphics+"}"}},W.Command.Includegraphics=class{constructor(e,t,r){this.isClipped=e,this.attributeList=t,this.filepath=r}get isIncludegraphics(){return!0}toString(){return"\\includegraphics"+(this.isClipped?"*":"")+this.attributeList.mkString("[",",","]")+"{"+this.filepath+"}"}},W.Command.Includegraphics.Attr=class{},W.Command.Includegraphics.Attr.Width=class extends W.Command.Includegraphics.Attr{constructor(e){super(),this.dimen=e}toString(){return"width="+this.dimen}},W.Command.Includegraphics.Attr.Height=class extends W.Command.Includegraphics.Attr{constructor(e){super(),this.dimen=e}toString(){return"height="+this.dimen}};var _=B.fun,U=B.elem,G=function(e){return _(B.elem(e))},X=B.literal,V=B.regex,H=B.regexLiteral,q=function(e){return _(B.literal(e))},J=B.seq,Z=B.or,Y=function(e){return B.lazyParser(e)().rep()},$=function(e){return B.lazyParser(e)().rep1()},K=function(e){return B.lazyParser(e)().opt()},ee=B.success,te=function(e){return function(){var t=e.memo;return void 0===t&&(t=e.memo=e()),t}},re=new B,ne={xy:te(function(){return re.posDecor().to(function(e){return e})}),xybox:te(function(){return X("{").andr(re.posDecor).andl(q("}")).to(function(e){return e})}),xymatrixbox:te(function(){return re.xymatrix().to(function(e){return new W.PosDecor(new W.Pos.Coord(new W.Coord.C,w.empty),new W.Decor(w.empty.append(e)))})}),posDecor:te(function(){return J(re.pos,re.decor).to(function(e){return new W.PosDecor(e.head,e.tail)})}),pos:te(function(){return J(re.coord,Y(re.pos2)).to(function(e){return new W.Pos.Coord(e.head,e.tail)})}),nonemptyPos:te(function(){return Z(J(re.nonemptyCoord,Y(re.pos2)),J(re.coord,$(re.pos2))).to(function(e){return new W.Pos.Coord(e.head,e.tail)})}),pos2:te(function(){return Z(X("+").andr(re.coord).to(function(e){return new W.Pos.Plus(e)}),X("-").andr(re.coord).to(function(e){return new W.Pos.Minus(e)}),X("!").andr(re.coord).to(function(e){return new W.Pos.Skew(e)}),X(".").andr(re.coord).to(function(e){return new W.Pos.Cover(e)}),X(",").andr(re.coord).to(function(e){return new W.Pos.Then(e)}),X(";").andr(re.coord).to(function(e){return new W.Pos.SwapPAndC(e)}),X("::").andr(re.coord).to(function(e){return new W.Pos.SetYBase(e)}),X(":").andr(re.coord).to(function(e){return new W.Pos.SetBase(e)}),X("**").andr(re.object).to(function(e){return new W.Pos.ConnectObject(e)}),X("*").andr(re.object).to(function(e){return new W.Pos.DropObject(e)}),X("?").andr(re.place).to(function(e){return new W.Pos.Place(e)}),X("@+").andr(re.coord).to(function(e){return new W.Pos.PushCoord(e)}),X("@-").andr(re.coord).to(function(e){return new W.Pos.EvalCoordThenPop(e)}),X("@=").andr(re.coord).to(function(e){return new W.Pos.LoadStack(e)}),X("@@").andr(re.coord).to(function(e){return new W.Pos.DoCoord(e)}),X("@i").to(function(){return new W.Pos.InitStack}),X("@(").to(function(){return new W.Pos.EnterFrame}),X("@)").to(function(){return new W.Pos.LeaveFrame}),X("=:").andr(q('"')).andr(re.id).andl(G('"')).to(function(e){return new W.Pos.SaveBase(e)}),X("=@").andr(q('"')).andr(re.id).andl(G('"')).to(function(e){return new W.Pos.SaveStack(e)}),X("=").andr(q('"')).andr(re.id).andl(G('"')).to(function(e){return new W.Pos.SavePos(e)}),X("=").andr(re.nonemptyCoord).andl(q('"')).and(re.id).andl(G('"')).to(function(e){return new W.Pos.SaveMacro(e.head,e.tail)}),re.xyimport)}),coord:te(function(){return Z(re.nonemptyCoord,ee("empty").to(function(){return new W.Coord.C}))}),nonemptyCoord:te(function(){return Z(X("c").to(function(){return new W.Coord.C}),X("p").to(function(){return new W.Coord.P}),X("x").to(function(){return new W.Coord.X}),X("y").to(function(){return new W.Coord.Y}),re.vector().to(function(e){return new W.Coord.Vector(e)}),X('"').andr(re.id).andl(G('"')).to(function(e){return new W.Coord.Id(e)}),X("{").andr(re.posDecor).andl(q("}")).to(function(e){return new W.Coord.Group(e)}),X("s").andr(_(H(/^\d/))).to(function(e){return new W.Coord.StackPosition(parseInt(e))}),X("s").andr(q("{")).and(re.nonnegativeNumber).andl(q("}")).to(function(e){return new W.Coord.StackPosition(e)}),X("[").andr(_(K(X('"').andr(re.id).andl(G('"'))).to(function(e){return e.getOrElse("")}))).and(re.number).andl(q(",")).and(re.number).andl(q("]")).to(function(e){return new W.Coord.DeltaRowColumn(e.head.head,e.head.tail,e.tail)}),X("[").andr(_(K(X('"').andr(re.id).andl(G('"'))).to(function(e){return e.getOrElse("")}))).and(_(Y(V(/^[lrud]/)))).andl(q("]")).to(function(e){return new W.Coord.Hops(e.head,e.tail)}),X("[").andr(_(K(X('"').andr(re.id).andl(G('"'))).to(function(e){return e.getOrElse("")}))).and(_($(V(/^[lrud]/)))).and(re.place).andl(q("]")).to(function(e){return new W.Coord.DeltaRowColumn(e.head.head,e.head.tail,new W.Pos.Place(e.tail))}))}),vector:te(function(){return Z(X("(").andr(re.factor).andl(q(",")).and(re.factor).andl(q(")")).to(function(e){return new W.Vector.InCurBase(e.head,e.tail)}),X("<").andr(re.dimen).andl(q(",")).and(re.dimen).andl(q(">")).to(function(e){return new W.Vector.Abs(e.head,e.tail)}),X("<").andr(re.dimen).andl(q(">")).to(function(e){return new W.Vector.Abs(e,e)}),X("a").andr(q("(")).andr(re.number).andl(q(")")).to(function(e){return new W.Vector.Angle(e)}),X("/").andr(re.direction).and(re.looseDimen).andl(q("/")).to(function(e){return new W.Vector.Dir(e.head,e.tail)}),X("0").to(function(e){return new W.Vector.Abs("0mm","0mm")}),function(){return re.corner().and(_(B.opt(_(X("(").andr(re.factor).andl(q(")")))).to(function(e){return e.getOrElse(1)}))).to(function(e){return new W.Vector.Corner(e.head,e.tail)})})}),corner:te(function(){return Z(H(/^(CL|LC)/).to(function(){return new W.Corner.CL}),H(/^(CR|RC)/).to(function(){return new W.Corner.CR}),H(/^(CD|DC)/).to(function(){return new W.Corner.CD}),H(/^(CU|UC)/).to(function(){return new W.Corner.CU}),H(/^(LD|DL)/).to(function(){return new W.Corner.LD}),H(/^(RD|DR)/).to(function(){return new W.Corner.RD}),H(/^(LU|UL)/).to(function(){return new W.Corner.LU}),H(/^(RU|UR)/).to(function(){return new W.Corner.RU}),X("L").to(function(){return new W.Corner.L}),X("R").to(function(){return new W.Corner.R}),X("D").to(function(){return new W.Corner.D}),X("U").to(function(){return new W.Corner.U}),X("E").to(function(){return new W.Corner.NearestEdgePoint}),X("P").to(function(){return new W.Corner.PropEdgePoint}),X("A").to(function(){return new W.Corner.Axis}))}),place:te(function(){return Z(X("<").andr(re.place).to(function(e){return new W.Place(1,0,void 0,void 0).compound(e)}),X(">").andr(re.place).to(function(e){return new W.Place(0,1,void 0,void 0).compound(e)}),X("(").andr(re.factor).andl(q(")")).and(re.place).to(function(e){return new W.Place(0,0,new W.Place.Factor(e.head),void 0).compound(e.tail)}),X("!").andr(q("{")).andr(re.pos).andl(q("}")).and(re.slide).to(function(e){return new W.Place(0,0,new W.Place.Intercept(e.head),e.tail)}),function(){return re.slide().to(function(e){return new W.Place(0,0,void 0,e)})})}),slide:te(function(){return Z(X("/").andr(re.dimen).andl(q("/")).to(function(e){return new W.Slide(new x.Some(e))}),ee("no slide").to(function(){return new W.Slide(x.empty)}))}),factor:te(_(H(/^[+\-]?(\d+(\.\d*)?|\d*\.\d+)/).to(function(e){return parseFloat(e)}))),number:te(_(H(/^[+\-]?\d+/).to(function(e){return parseInt(e)}))),nonnegativeNumber:te(_(H(/^\d+/).to(function(e){return parseInt(e)}))),unit:te(_(H(/^(em|ex|px|pt|pc|in|cm|mm|mu)/).to(function(e){return e}))),dimen:te(function(){return re.factor().and(re.unit).to(function(e){return e.head.toString()+e.tail})}),looseDimen:te(function(){return re.looseFactor().and(re.unit).to(function(e){return e.head.toString()+e.tail})}),looseFactor:te(_(Z(H(/^(\d \d*(\.\d*))/).to(function(e){return parseFloat(e.replace(/ /,""))}),H(/^[+\-]?(\d+(\.\d*)?|\d*\.\d+)/).to(function(e){return parseFloat(e)})))),id:te(_(V(/^[^"]+/))),object:te(function(){return Z(Y(re.modifier).and(re.objectbox).to(function(e){return new W.Object(e.head,e.tail)}))}),objectbox:te(function(){return Z(re.mathText,X("@").andr(re.dir),X("\\dir").andr(re.dir),X("\\cir").andr(re.cirRadius).andl(q("{")).and(re.cir).andl(q("}")).to(function(e){return new W.ObjectBox.Cir(e.head,e.tail)}),X("\\frm").andr(re.frameRadius).andl(q("{")).and(re.frameMain).andl(q("}")).to(function(e){return new W.ObjectBox.Frame(e.head,e.tail)}),X("\\object").andr(re.object).to(function(e){return new W.ObjectBox.WrapUpObject(e)}),X("\\composite").and(q("{")).andr(re.compositeObject).andl(q("}")).to(function(e){return new W.ObjectBox.CompositeObject(e)}),X("\\xybox").and(q("{")).andr(re.posDecor).andl(q("}")).to(function(e){return new W.ObjectBox.Xybox(e)}),X("\\xymatrix").andr(re.xymatrix).to(function(e){return new W.ObjectBox.Xymatrix(e)}),re.txt,re.curve,V(/^(\\[a-zA-Z@][a-zA-Z0-9@]+)/).andl(q("{")).and(re.text).andl(q("}")).and(re.textNodeCreator).to(function(e){var t=e.head,r=e.tail;return re.toMath(t.head+"{"+t.tail+"}",r)}))}),compositeObject:te(function(){return re.object().and(_(Y(X("*").andr(re.object)))).to(function(e){return e.tail.prepend(e.head)})}),mathText:te(function(){return X("{").andr(re.text).andl(G("}")).and(re.textNodeCreator).to(function(e){var t=e.head,r=e.tail;return re.toMath("\\hbox{$\\objectstyle{"+t+"}$}",r)})}),toMath:function(e,t){var r=t(e);return new W.ObjectBox.Text(r)},textNodeCreator:te(function(){return new B.Parser(function(e){return new B.Success(e.context.createTextNode,e)})}),text:te(function(){return V(/^[^{}\\%]*/).and(function(){return Z(V(/^(\\\{|\\\}|\\%|\\)/).to(function(e){return e}),U("{").andr(re.text).andl(G("}")).to(function(e){return"{"+e+"}"}),V(/^%[^\r\n]*(\r\n|\r|\n)?/).to(function(e){return" "})).and(_(V(/^[^{}\\%]*/))).rep().to(function(e){var t="";return e.foreach(function(e){t+=e.head+e.tail}),t})}).to(function(e){return e.head+e.tail})}),txt:te(function(){return X("\\txt").andr(re.txtWidth).and(_(V(/^(\\[a-zA-Z@][a-zA-Z0-9@]+)?/))).andl(q("{")).and(re.text).andl(q("}")).and(re.textNodeCreator).to(function(e){var t,r=e.head,n=e.tail,a=r.head.head,i=r.head.tail,o=r.tail,s=o.split("\\\\");if(s.length<=1)t=i+"{\\hbox{"+o+"}}";else{t="\\hbox{$\\begin{array}{c}\n";for(var h=0;h<s.length;h++)t+=i+"{\\hbox{"+s[h].replace(/(^[\r\n\s]+)|([\r\n\s]+$)/g,"")+"}}",h!=s.length-1&&(t+="\\\\\n");t+="\\end{array}$}"}return new W.ObjectBox.Txt(a,re.toMath(t,n))})}),txtWidth:te(function(){return Z(X("<").andr(re.dimen).andl(q(">")).to(function(e){return new W.Vector.Abs(e,e)}).to(function(e){return new W.ObjectBox.Txt.Width.Vector(e)}),ee("default").to(function(){return new W.ObjectBox.Txt.Width.Default}))}),dir:te(function(){return H(/^[\^_0123]/).opt().andl(q("{")).and(re.dirMain).andl(q("}")).to(function(e){return new W.ObjectBox.Dir(e.head.getOrElse(""),e.tail)})}),dirMain:te(function(){return V(/^(-|\.|~|>|<|\(|\)|`|'|\||\*|\+|x|\/|o|=|:|[a-zA-Z@ ])+/).opt().to(function(e){return e.getOrElse("")})}),cirRadius:te(function(){return Z(re.vector().to(function(e){return new W.ObjectBox.Cir.Radius.Vector(e)}),ee("default").to(function(){return new W.ObjectBox.Cir.Radius.Default}))}),frameRadius:te(function(){return Z(re.frameRadiusVector().to(function(e){return new W.ObjectBox.Frame.Radius.Vector(e)}),ee("default").to(function(){return new W.ObjectBox.Frame.Radius.Default}))}),frameRadiusVector:te(function(){return Z(X("<").andr(re.dimen).andl(q(",")).and(re.dimen).andl(q(">")).to(function(e){return new W.Vector.Abs(e.head,e.tail)}),X("<").andr(re.dimen).andl(q(">")).to(function(e){return new W.Vector.Abs(e,e)}))}),frameMain:te(function(){return V(/^(((_|\^)?(\\\{|\\\}|\(|\)))|[\-=oe,\.\*]*)/)}),cir:te(function(){return Z(re.nonemptyCir,ee("full").to(function(){return new W.ObjectBox.Cir.Cir.Full}))}),nonemptyCir:te(function(){return re.diag().and(_(H(/^[_\^]/))).and(re.diag).to(function(e){return new W.ObjectBox.Cir.Cir.Segment(e.head.head,e.head.tail,e.tail)})}),curve:te(function(){return X("\\crv").andr(re.curveModifier).andl(q("{")).and(re.curveObject).and(re.curvePoslist).andl(q("}")).to(function(e){return new W.ObjectBox.Curve(e.head.head,e.head.tail,e.tail)})}),curveModifier:te(function(){return Y(_(X("~").andr(re.curveOption)))}),curveOption:te(function(){return Z(X("p").to(function(){return new W.ObjectBox.Curve.Modifier.p}),X("P").to(function(){return new W.ObjectBox.Curve.Modifier.P}),X("l").to(function(){return new W.ObjectBox.Curve.Modifier.l}),X("L").to(function(){return new W.ObjectBox.Curve.Modifier.L}),X("c").to(function(){return new W.ObjectBox.Curve.Modifier.c}),X("C").to(function(){return new W.ObjectBox.Curve.Modifier.C}),X("pc").to(function(){return new W.ObjectBox.Curve.Modifier.pc}),X("pC").to(function(){return new W.ObjectBox.Curve.Modifier.pC}),X("Pc").to(function(){return new W.ObjectBox.Curve.Modifier.Pc}),X("PC").to(function(){return new W.ObjectBox.Curve.Modifier.PC}),X("lc").to(function(){return new W.ObjectBox.Curve.Modifier.lc}),X("lC").to(function(){return new W.ObjectBox.Curve.Modifier.lC}),X("Lc").to(function(){return new W.ObjectBox.Curve.Modifier.Lc}),X("LC").to(function(){return new W.ObjectBox.Curve.Modifier.LC}),X("cC").to(function(){return new W.ObjectBox.Curve.Modifier.cC}))}),curveObject:te(function(){return Y(Z(X("~*").andr(re.object).to(function(e){return new W.ObjectBox.Curve.Object.Drop(e)}),X("~**").andr(re.object).to(function(e){return new W.ObjectBox.Curve.Object.Connect(e)})))}),curvePoslist:te(function(){return Z(X("&").andr(re.curvePoslist2).to(function(e){return e.prepend(new W.ObjectBox.Curve.PosList.CurPos)}),X("~@").andr(q("&")).andr(re.curvePoslist2).to(function(e){return e.prepend(new W.ObjectBox.Curve.PosList.AddStack)}),X("~@").to(function(){return w.empty.prepend(new W.ObjectBox.Curve.PosList.AddStack)}),re.pos().andl(q("&")).and(re.curvePoslist2).to(function(e){return e.tail.prepend(new W.ObjectBox.Curve.PosList.Pos(e.head))}),re.nonemptyPos().to(function(e){return w.empty.prepend(new W.ObjectBox.Curve.PosList.Pos(e))}),ee("empty").to(function(){return w.empty}))}),curvePoslist2:te(function(){return Z(X("&").andr(re.curvePoslist2).to(function(e){return e.prepend(new W.ObjectBox.Curve.PosList.CurPos)}),X("~@").andr(q("&")).andr(re.curvePoslist2).to(function(e){return e.prepend(new W.ObjectBox.Curve.PosList.AddStack)}),X("~@").to(function(){return w.empty.prepend(new W.ObjectBox.Curve.PosList.AddStack)}),re.nonemptyPos().andl(q("&")).and(re.curvePoslist2).to(function(e){return e.tail.prepend(new W.ObjectBox.Curve.PosList.Pos(e.head))}),re.nonemptyPos().to(function(e){return w.empty.prepend(new W.ObjectBox.Curve.PosList.Pos(e))}),ee("empty").to(function(){return w.empty.prepend(new W.ObjectBox.Curve.PosList.CurPos)}))}),modifier:te(function(){return Z(X("!").andr(re.vector).to(function(e){return new W.Modifier.Vector(e)}),X("!").to(function(e){return new W.Modifier.RestoreOriginalRefPoint}),X("[").andr(re.shape).andl(q("]")).to(function(e){return e}),X("i").to(function(e){return new W.Modifier.Invisible}),X("h").to(function(e){return new W.Modifier.Hidden}),re.addOp().and(re.size).to(function(e){return new W.Modifier.AddOp(e.head,e.tail)}),re.nonemptyDirection().to(function(e){return new W.Modifier.Direction(e)}))}),addOp:te(function(){return Z(X("+=").to(function(){return new W.Modifier.AddOp.GrowTo}),X("-=").to(function(){return new W.Modifier.AddOp.ShrinkTo}),X("+").to(function(){return new W.Modifier.AddOp.Grow}),X("-").to(function(){return new W.Modifier.AddOp.Shrink}),X("=").to(function(){return new W.Modifier.AddOp.Set}))}),size:te(function(){return Z(function(){return re.vector().to(function(e){return new W.Modifier.AddOp.VactorSize(e)})},ee("default size").to(function(){return new W.Modifier.AddOp.DefaultSize}))}),shape:te(function(){return Z(X(".").to(function(){return new W.Modifier.Shape.Point}),re.frameShape,re.alphabets().to(function(e){return new W.Modifier.Shape.Alphabets(e)}),X("=").andr(re.alphabets).to(function(e){return new W.Modifier.Shape.DefineShape(e)}),ee("rect").to(function(){return new W.Modifier.Shape.Rect}))}),frameShape:te(function(){return X("F").andr(re.frameMain).and(_(Y(X(":").andr(_(Z(re.frameRadiusVector().to(function(e){return new W.Modifier.Shape.Frame.Radius(e)}),re.colorName().to(function(e){return new W.Modifier.Shape.Frame.Color(e)}))))))).to(function(e){var t=e.head;return""===t&&(t="-"),new W.Modifier.Shape.Frame(t,e.tail)})}),alphabets:te(function(){return V(/^([a-zA-Z]+)/)}),colorName:te(function(){return V(/^([a-zA-Z][a-zA-Z0-9]*)/)}),direction:te(function(){return J(re.direction0,Y(re.direction1)).to(function(e){return new W.Direction.Compound(e.head,e.tail)})}),direction0:te(function(){return Z(re.direction2,re.diag().to(function(e){return new W.Direction.Diag(e)}))}),direction1:te(function(){return Z(X(":").andr(re.vector).to(function(e){return new W.Direction.RotVector(e)}),X("_").to(function(e){return new W.Direction.RotAntiCW}),X("^").to(function(e){return new W.Direction.RotCW}))}),direction2:te(function(){return Z(X("v").andr(re.vector).to(function(e){return new W.Direction.Vector(e)}),X("q").andr(q("{")).andr(re.posDecor).andl(q("}")).to(function(e){return new W.Direction.ConstructVector(e)}))}),nonemptyDirection:te(function(){return Z(J(re.nonemptyDirection0,Y(re.direction1)),J(re.direction0,$(re.direction1))).to(function(e){return new W.Direction.Compound(e.head,e.tail)})}),nonemptyDirection0:te(function(){return Z(re.direction2,re.nonemptyDiag().to(function(e){return new W.Direction.Diag(e)}))}),diag:te(function(){return Z(re.nonemptyDiag,ee("empty").to(function(e){return new W.Diag.Default}))}),nonemptyDiag:te(function(){return Z(H(/^(ld|dl)/).to(function(e){return new W.Diag.LD}),H(/^(rd|dr)/).to(function(e){return new W.Diag.RD}),H(/^(lu|ul)/).to(function(e){return new W.Diag.LU}),H(/^(ru|ur)/).to(function(e){return new W.Diag.RU}),X("l").to(function(e){return new W.Diag.L}),X("r").to(function(e){return new W.Diag.R}),X("d").to(function(e){return new W.Diag.D}),X("u").to(function(e){return new W.Diag.U}))}),decor:te(function(){return re.command().rep().to(function(e){return new W.Decor(e)})}),command:te(function(){return Z(X("\\ar").andr(_(Y(re.arrowForm))).and(re.path).to(function(e){return new W.Command.Ar(e.head,e.tail)}),X("\\xymatrix").andr(re.xymatrix),X("\\PATH").andr(re.path).to(function(e){return new W.Command.Path(e)}),X("\\afterPATH").andr(q("{")).andr(re.decor).andl(q("}")).and(re.path).to(function(e){return new W.Command.AfterPath(e.head,e.tail)}),X("\\save").andr(re.pos).to(function(e){return new W.Command.Save(e)}),X("\\restore").to(function(){return new W.Command.Restore}),X("\\POS").andr(re.pos).to(function(e){return new W.Command.Pos(e)}),X("\\afterPOS").andr(q("{")).andr(re.decor).andl(q("}")).and(re.pos).to(function(e){return new W.Command.AfterPos(e.head,e.tail)}),X("\\drop").andr(re.object).to(function(e){return new W.Command.Drop(e)}),X("\\connect").andr(re.object).to(function(e){return new W.Command.Connect(e)}),X("\\relax").to(function(){return new W.Command.Relax}),X("\\xyignore").andr(q("{")).andr(re.pos).and(re.decor).andl(q("}")).to(function(e){return new W.Command.Ignore(e.head,e.tail)}),X("\\xyshowAST").andr(q("{")).andr(re.pos).and(re.decor).andl(q("}")).to(function(e){return new W.Command.ShowAST(e.head,e.tail)}),re.twocellCommand)}),arrowForm:te(function(){return Z(X("@").andr(_(V(/^([\-\.~=:])/))).to(function(e){return new W.Command.Ar.Form.ChangeStem(e)}),X("@").andr(q("!")).to(function(e){return new W.Command.Ar.Form.DashArrowStem}),X("@").andr(q("/")).andr(re.direction).and(_(K(re.looseDimen))).andl(q("/")).to(function(e){return new W.Command.Ar.Form.CurveArrow(e.head,e.tail.getOrElse(".5pc"))}),X("@").andr(q("(")).andr(re.direction).andl(q(",")).and(re.direction).andl(q(")")).to(function(e){return new W.Command.Ar.Form.CurveFitToDirection(e.head,e.tail)}),X("@").andr(q("`")).andr(re.coord).to(function(e){return new W.Command.Ar.Form.CurveWithControlPoints(e)}),X("@").andr(q("[")).andr(re.shape).andl(q("]")).to(function(e){return new W.Command.Ar.Form.AddShape(e)}),X("@").andr(q("*")).andr(q("{")).andr(_(Y(re.modifier))).andl(q("}")).to(function(e){return new W.Command.Ar.Form.AddModifiers(e)}),X("@").andr(q("<")).andr(re.dimen).andl(q(">")).to(function(e){return new W.Command.Ar.Form.Slide(e)}),X("|").andr(re.anchor).and(re.it).to(function(e){return new W.Command.Ar.Form.LabelAt(e.head,e.tail)}),X("^").andr(re.anchor).and(re.it).to(function(e){return new W.Command.Ar.Form.LabelAbove(e.head,e.tail)}),X("_").andr(re.anchor).and(re.it).to(function(e){return new W.Command.Ar.Form.LabelBelow(e.head,e.tail)}),X("@").andr(q("?")).to(function(){return new W.Command.Ar.Form.ReverseAboveAndBelow}),X("@").andr(_(V(/^([\^_0123])/).opt())).and(_(K(re.tipConnTip))).to(function(e){var t=e.head.getOrElse("");if(e.tail.isDefined){var r=e.tail.get;return new W.Command.Ar.Form.BuildArrow(t,r.tail,r.stem,r.head)}return new W.Command.Ar.Form.ChangeVariant(t)}))}),tipConnTip:te(function(){return X("{").andr(_(K(re.nonemptyTip))).and(_(K(re.nonemptyConn))).and(_(K(re.nonemptyTip))).andl(q("}")).to(function(e){var t,r,n,a=e.head.head,i=e.head.tail,o=e.tail,s=new W.Command.Ar.Form.Tip.Tipchars("");return i.isDefined||o.isDefined?(t=a.getOrElse(s),r=i.getOrElse(new W.Command.Ar.Form.Conn.Connchars("")),n=o.getOrElse(s)):a.isDefined?(t=s,r=new W.Command.Ar.Form.Conn.Connchars("-"),n=a.getOrElse(s)):(t=s,r=new W.Command.Ar.Form.Conn.Connchars(""),n=s),{tail:t,stem:r,head:n}})}),nonemptyTip:te(function(){return Z(V(/^([<>()|'`+\/a-zA-Z ]+)/).to(function(e){return new W.Command.Ar.Form.Tip.Tipchars(e)}),X("*").andr(re.object).to(function(e){return new W.Command.Ar.Form.Tip.Object(e)}),re.dir().to(function(e){return new W.Command.Ar.Form.Tip.Dir(e)}))}),nonemptyConn:te(function(){return Z(V(/^([\-\.~=:]+)/).to(function(e){return new W.Command.Ar.Form.Conn.Connchars(e)}),X("*").andr(re.object).to(function(e){return new W.Command.Ar.Form.Conn.Object(e)}),re.dir().to(function(e){return new W.Command.Ar.Form.Conn.Dir(e)}))}),path:te(function(){return re.path2(w.empty).to(function(e){return new W.Command.Path.Path(e)})}),path2:function(e){var t=te(function(){return re.path2(e)});return Z(re.path3().and(t).to(function(e){return e.tail.prepend(e.head)}),J("~","{",t,"}").to(function(e){return e.head.tail}).into(function(e){return re.path2(e)}),re.segment().to(function(e){return w.empty.prepend(new W.Command.Path.LastSegment(e))}),ee(e).to(function(e){return e}))},path3:te(function(){return Z(J("~","=","{",re.posDecor,"}").to(function(e){return new W.Command.Path.SetBeforeAction(e.head.tail)}),J("~","/","{",re.posDecor,"}").to(function(e){return new W.Command.Path.SetAfterAction(e.head.tail)}),J("~","<","{",re.labels,"}").to(function(e){return new W.Command.Path.AddLabelNextSegmentOnly(e.head.tail)}),J("~",">","{",re.labels,"}").to(function(e){return new W.Command.Path.AddLabelLastSegmentOnly(e.head.tail)}),J("~","+","{",re.labels,"}").to(function(e){return new W.Command.Path.AddLabelEverySegment(e.head.tail)}),J("'",re.segment).to(function(e){return new W.Command.Path.StraightSegment(e.tail)}),J("`",re.turn,re.segment).to(function(e){return new W.Command.Path.TurningSegment(e.head.tail,e.tail)}))}),turn:te(function(){return Z(re.nonemptyCir().and(re.turnRadius).to(function(e){return new W.Command.Path.Turn.Cir(e.head,e.tail)}),re.diag().and(re.turnRadius).to(function(e){return new W.Command.Path.Turn.Diag(e.head,e.tail)}))}),turnRadius:te(function(){return Z(X("/").andr(re.dimen).to(function(e){return new W.Command.Path.TurnRadius.Dimen(e)}),ee("default").to(function(){return new W.Command.Path.TurnRadius.Default}))}),segment:te(function(){return re.nonemptyPos().and(re.pathSlide).and(re.labels).to(function(e){return new W.Command.Path.Segment(e.head.head,e.head.tail,e.tail)})}),pathSlide:te(function(){return Z(X("<").andr(re.dimen).andl(q(">")).to(function(e){return new W.Slide(new x.Some(e))}),ee("no slide").to(function(){return new W.Slide(x.empty)}))}),labels:te(function(){return re.label().rep().to(function(e){return new W.Command.Path.Labels(e)})}),label:te(function(){return Z(J("^",re.anchor,re.it,re.alias).to(function(e){return new W.Command.Path.Label.Above(new W.Pos.Place(e.head.head.tail),e.head.tail,e.tail)}),J("_",re.anchor,re.it,re.alias).to(function(e){return new W.Command.Path.Label.Below(new W.Pos.Place(e.head.head.tail),e.head.tail,e.tail)}),J("|",re.anchor,re.it,re.alias).to(function(e){return new W.Command.Path.Label.At(new W.Pos.Place(e.head.head.tail),e.head.tail,e.tail)}))}),anchor:te(function(){return Z(X("-").andr(re.anchor).to(function(e){return new W.Place(1,1,new W.Place.Factor(.5),void 0).compound(e)}),re.place)}),it:te(function(){return Y(X("[").andr(re.shape).andl(q("]")).to(function(e){return e})).and(re.it2).to(function(e){return new W.Object(e.head.concat(e.tail.modifiers),e.tail.object)})}),it2:te(function(){return Z(H(/^[0-9a-zA-Z]/).and(re.textNodeCreator).to(function(e){var t=e.head,r=e.tail;return new W.Object(w.empty,re.toMath("\\labelstyle "+t,r))}),H(/^(\\[a-zA-Z][a-zA-Z0-9]*)/).and(re.textNodeCreator).to(function(e){var t=e.head,r=e.tail;return new W.Object(w.empty,re.toMath("\\labelstyle "+t,r))}),X("{").andr(re.text).andl(G("}")).and(re.textNodeCreator).to(function(e){var t=e.head,r=e.tail;return new W.Object(w.empty,re.toMath("\\labelstyle "+t,r))}),X("*").andr(re.object),X("@").andr(re.dir).to(function(e){return new W.Object(w.empty,e)}))}),alias:te(function(){return J("=",'"',re.id,'"').opt().to(function(e){return e.map(function(e){return e.head.tail})})}),xymatrix:te(function(){return re.setup().andl(q("{")).and(re.rows).andl(q("}")).to(function(e){return new W.Command.Xymatrix(e.head,e.tail)})}),setup:te(function(){return Y(_(Z(X('"').andr(_(V(/^[^"]+/))).andl(G('"')).to(function(e){return new W.Command.Xymatrix.Setup.Prefix(e)}),X("@!").andr(_(V(/^[RC]/).opt().to(function(e){return e.getOrElse("")}))).and(_(Z(U("0").to(function(){return"0em"}),U("=").andr(re.dimen)))).to(function(e){var t=e.tail;switch(e.head){case"R":return new W.Command.Xymatrix.Setup.PretendEntrySize.Height(t);case"C":return new W.Command.Xymatrix.Setup.PretendEntrySize.Width(t);default:return new W.Command.Xymatrix.Setup.PretendEntrySize.HeightAndWidth(t)}}),X("@!").andr(_(Z(U("R").to(function(){return new W.Command.Xymatrix.Setup.FixGrid.Row}),U("C").to(function(){return new W.Command.Xymatrix.Setup.FixGrid.Column})).opt().to(function(e){return e.getOrElse(new W.Command.Xymatrix.Setup.FixGrid.RowAndColumn)}))),X("@").andr(_(V(/^[MWHL]/))).and(re.addOp).and(re.dimen).to(function(e){var t=e.head.tail,r=e.tail;switch(e.head.head){case"M":return new W.Command.Xymatrix.Setup.AdjustEntrySize.Margin(t,r);case"W":return new W.Command.Xymatrix.Setup.AdjustEntrySize.Width(t,r);case"H":return new W.Command.Xymatrix.Setup.AdjustEntrySize.Height(t,r);case"L":return new W.Command.Xymatrix.Setup.AdjustLabelSep(t,r)}}),X("@").andr(re.nonemptyDirection).to(function(e){return new W.Command.Xymatrix.Setup.SetOrientation(e)}),X("@*[").andr(re.shape).andl(q("]")).to(function(e){return new W.Command.Xymatrix.Setup.AddModifier(e)}),X("@*").andr(re.addOp).and(re.size).to(function(e){return new W.Command.Xymatrix.Setup.AddModifier(new W.Modifier.AddOp(e.head,e.tail))}),X("@").andr(_(V(/^[RC]/).opt().to(function(e){return e.getOrElse("")}))).and(re.addOp).and(re.dimen).to(function(e){var t=e.head.tail,r=e.tail;switch(e.head.head){case"R":return new W.Command.Xymatrix.Setup.ChangeSpacing.Row(t,r);case"C":return new W.Command.Xymatrix.Setup.ChangeSpacing.Column(t,r);default:return new W.Command.Xymatrix.Setup.ChangeSpacing.RowAndColumn(t,r)}}),X("@1").to(function(){return new W.Command.Xymatrix.Setup.AdjustEntrySize.Margin(new W.Modifier.AddOp.Set,"1pc")}))))}),rows:te(function(){return re.row().and(_(Y(X("\\\\").andr(re.row)))).to(function(e){var t=e.tail.prepend(e.head);if(!t.isEmpty){var r=t.at(t.length()-1);1===r.entries.length()&&r.entries.at(0).isEmpty&&(t=t.reverse().tail.reverse())}return t})}),row:te(function(){return re.entry().and(_(Y(X("&").andr(re.entry)))).to(function(e){return new W.Command.Xymatrix.Row(e.tail.prepend(e.head))})}),entry:te(function(){return Z(X("*").andr(re.object).and(re.pos).and(re.decor).to(function(e){var t=e.head.head,r=e.head.tail,n=e.tail;return new W.Command.Xymatrix.Entry.ObjectEntry(t,r,n)}),re.entryModifier().rep().and(re.looseObjectbox).and(re.decor).to(function(e){var t=e.head.head.foldLeft(w.empty,function(e,t){return t.concat(e)}),r=e.head.tail.isEmpty,n=e.head.tail.object,a=e.tail;return r&&t.isEmpty?new W.Command.Xymatrix.Entry.EmptyEntry(a):new W.Command.Xymatrix.Entry.SimpleEntry(t,n,a)}))}),entryModifier:te(function(){return Z(X("**").andr(q("[")).andr(re.shape).andl(q("]")).to(function(e){return w.empty.append(e)}),X("**").andr(q("{")).andr(_(Y(re.modifier))).andl(q("}")))}),looseObjectbox:te(function(){return Z(re.objectbox().to(function(e){return{isEmpty:!1,object:e}}),V(/^[^\\{}%&]+/).opt().to(function(e){return e.getOrElse("")}).and(_(Y(Z(U("{").andr(re.text).andl(G("}")).to(function(e){return"{"+e+"}"}),U("\\").andr(_((e=V(/^(\\|ar|xymatrix|PATH|afterPATH|save|restore|POS|afterPOS|drop|connect|xyignore|([lrud]+(twocell|uppertwocell|lowertwocell|compositemap))|xtwocell|xuppertwocell|xlowertwocell|xcompositemap)/),B.not(B.lazyParser(e))))).andr(_(V(/^[{}%&]/).opt().to(function(e){return e.getOrElse("")}))).to(function(e){return"\\"+e}),V(/^%[^\r\n]*(\r\n|\r|\n)?/).to(function(e){return" "})).and(_(V(/^[^\\{}%&]+/).opt().to(function(e){return e.getOrElse("")}))).to(function(e){return e.head+e.tail})).to(function(e){return e.mkString("")}))).and(re.textNodeCreator).to(function(e){var t=e.head,r=e.tail,n=t.head+t.tail;return{isEmpty:0===n.trim().length,object:re.toMath("\\hbox{$\\objectstyle{"+n+"}$}",r)}}));var e}),twocellCommand:te(function(){return re.twocell().and(_(Y(re.twocellSwitch))).and(re.twocellArrow).to(function(e){return new W.Command.Twocell(e.head.head,e.head.tail,e.tail)})}),twocell:te(function(){return Z(H(/^\\[lrud]+twocell/).to(function(e){var t=e.substring(1,e.length-7);return new W.Command.Twocell.Twocell(t,x.empty)}),H(/^\\[lrud]+uppertwocell/).to(function(e){var t=e.substring(1,e.length-12);return new W.Command.Twocell.UpperTwocell(t,x.empty)}),H(/^\\[lrud]+lowertwocell/).to(function(e){var t=e.substring(1,e.length-12);return new W.Command.Twocell.LowerTwocell(t,x.empty)}),H(/^\\[lrud]+compositemap/).to(function(e){var t=e.substring(1,e.length-12);return new W.Command.Twocell.CompositeMap(t,x.empty)}),Z(X("\\xtwocell").to(function(){return W.Command.Twocell.Twocell}),X("\\xuppertwocell").to(function(){return W.Command.Twocell.UpperTwocell}),X("\\xlowertwocell").to(function(){return W.Command.Twocell.LowerTwocell}),X("\\xcompositemap").to(function(){return W.Command.Twocell.CompositeMap})).andl(q("[")).and(_(V(/^[lrud]+/))).andl(q("]")).andl(q("{")).and(re.text).andl(q("}")).and(re.textNodeCreator).to(function(e){var t=e.head,r=e.tail,n=new W.Object(w.empty,re.toMath("\\labelstyle "+t.tail,r));return new t.head.head(t.head.tail,new x.Some(n))}))}),twocellSwitch:te(function(){return Z(X("^").andr(re.twocellLabel).to(function(e){return new W.Command.Twocell.Switch.UpperLabel(e)}),X("_").andr(re.twocellLabel).to(function(e){return new W.Command.Twocell.Switch.LowerLabel(e)}),X("\\omit").to(function(){return new W.Command.Twocell.Switch.DoNotSetCurvedArrows}),X("~!").to(function(){return new W.Command.Twocell.Switch.PlaceModMapObject}),H(/^(~[`'])/).andl(q("{")).and(re.object).andl(q("}")).to(function(e){var t=e.head.substring(1);return new W.Command.Twocell.Switch.ChangeHeadTailObject(t,e.tail)}),H(/^(~[\^_]?)/).andl(q("{")).and(re.object).and(_(K(X("~**").andr(re.object)))).andl(q("}")).to(function(e){var t=e.head.head.substring(1),r=e.head.tail,n=e.tail;return new W.Command.Twocell.Switch.ChangeCurveObject(t,r,n)}),re.nudge().to(function(e){return new W.Command.Twocell.Switch.SetCurvature(e)}))}),twocellLabel:te(function(){return Z(H(/^[0-9a-zA-Z]/).and(re.textNodeCreator).to(function(e){var t=e.head,r=e.tail,n=new W.Object(w.empty,re.toMath("\\twocellstyle "+t,r));return new W.Command.Twocell.Label(x.empty,n)}),H(/^(\\[a-zA-Z][a-zA-Z0-9]*)/).and(re.textNodeCreator).to(function(e){var t=e.head,r=e.tail,n=new W.Object(w.empty,re.toMath("\\twocellstyle "+t,r));return new W.Command.Twocell.Label(x.empty,n)}),X("{").andr(_(K(re.nudge))).andl(q("*")).and(re.object).andl(q("}")).to(function(e){return new W.Command.Twocell.Label(e.head,e.tail)}),X("{").andr(_(K(re.nudge))).and(re.text).andl(G("}")).and(re.textNodeCreator).to(function(e){var t=e.head,r=e.tail,n=new W.Object(w.empty,re.toMath("\\twocellstyle "+t.tail,r));return new W.Command.Twocell.Label(t.head,n)}))}),nudge:te(function(){return Z(X("<\\omit>").to(function(){return new W.Command.Twocell.Nudge.Omit}),X("<").andr(re.factor).andl(q(">")).to(function(e){return new W.Command.Twocell.Nudge.Number(e)}))}),twocellArrow:te(function(){return Z(X("{").andr(_(H(/^([\^_=`'"!]|\\omit)/))).and(re.twocellLabelEntry).andl(q("}")).to(function(e){return new W.Command.Twocell.Arrow.WithOrientation(e.head,e.tail)}),X("{").andr(re.nudge).and(re.twocellLabelEntry).andl(q("}")).to(function(e){return new W.Command.Twocell.Arrow.WithPosition(e.head,e.tail)}),X("{").andr(re.twocellLabelEntry).andl(q("}")).to(function(e){return new W.Command.Twocell.Arrow.WithOrientation("",e)}),ee("no arrow label").andr(re.textNodeCreator).to(function(e){return new W.Command.Twocell.Arrow.WithOrientation("",new W.Object(w.empty,re.toMath("\\twocellstyle{}",e)))}))}),twocellLabelEntry:te(function(){return Z(X("*").andr(re.object),re.text().and(re.textNodeCreator).to(function(e){var t=e.head,r=e.tail;return new W.Object(w.empty,re.toMath("\\twocellstyle "+t,r))}))}),newdir:te(function(){return X("{").andr(re.dirMain).andl(G("}")).andl(q("{")).and(re.compositeObject).andl(q("}")).to(function(e){return new W.Command.Newdir(e.head,new W.ObjectBox.CompositeObject(e.tail))})}),xyimport:te(function(){return X("\\xyimport").andr(q("(")).andr(re.factor).andl(q(",")).and(re.factor).andl(q(")")).and(_(K(X("(").andr(re.factor).andl(q(",")).and(re.factor).andl(q(")"))))).andl(q("{")).and(_(Z(X("\\includegraphics").andr(re.includegraphics),re.text().and(re.textNodeCreator).to(function(e){var t=e.head,r=e.tail;return re.toMath("\\hbox{$\\objectstyle{"+t+"}$}",r)})))).andl(q("}")).to(function(e){var t,r,n=e.head.head.head,a=e.head.head.tail;e.head.tail.isDefined?(t=e.head.tail.get.head,r=e.head.tail.get.tail):(t=0,r=0);var i=e.tail;return void 0!==i.isIncludegraphics?new W.Pos.Xyimport.Graphics(n,a,t,r,i):new W.Pos.Xyimport.TeXCommand(n,a,t,r,i)})}),includegraphics:te(function(){return X("[").andr(_(K(re.includegraphicsAttrList))).andl(q("]")).andl(q("{")).and(_(H(/^[^\s{}]+/))).andl(q("}")).to(function(e){var t=e.head.getOrElse(w.empty),r=e.tail;return new W.Command.Includegraphics(!1,t,r)})}),includegraphicsAttrList:te(function(){return re.includegraphicsAttr().and(_(Y(X(",").andr(re.includegraphicsAttr)))).to(function(e){return e.tail.prepend(e.head)})}),includegraphicsAttr:te(function(){return Z(X("width").andr(q("=")).andr(re.dimen).to(function(e){return new W.Command.Includegraphics.Attr.Width(e)}),X("height").andr(q("=")).andr(re.dimen).to(function(e){return new W.Command.Includegraphics.Attr.Height(e)}))})};for(var ae in ne)re[ae]=ne[ae];const ie=re,oe={whiteSpaceRegex:/^(\s+|%[^\r\n]*(\r\n|\r|\n)?)+/,lengthResolution:128,interpolationResolution:5,machinePrecision:1e-12},se=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},he=function(e){return e<0?-1:e>0?1:0},ue=function(e){return Math.abs(e)<oe.machinePrecision?0:e},ce=function(e,t){var r=e[t],n=function(){var n=r.call(this),i=function(){return n};return i.reset=a,e[t]=i,n},a=function(){e[t]=n};n.reset=a,a()},me=function(e){return Math.round(100*e)/100};class pe{constructor(e,t){e>t?(this.start=t,this.end=e):(this.start=e,this.end=t)}difference(e){var t=w.empty,r=this.start,n=this.end,a=e.start,i=e.end;return n<=a||i<=r?t=t.prepend(this):r<a?t=n<=i?t.prepend(new pe(r,a)):(t=t.prepend(new pe(r,a))).prepend(new pe(i,n)):i<n&&(t=t.prepend(new pe(i,n))),t}differenceRanges(e){var t=w.empty.prepend(this);return e.foreach(function(e){t=t.flatMap(function(t){return t.difference(e)})}),t}toString(){return"["+this.start+", "+this.end+"]"}}class le{constructor(){}toRect(e){return new le.Rect(this.x,this.y,e)}toPoint(){return new le.Point(this.x,this.y)}combineRect(e){return le.combineRect(this,e)}static combineRect(e,t){if(void 0===e)return t;if(void 0===t)return e;var r=-(Math.min(e.x-e.l,t.x-t.l)-e.x),n=Math.max(e.x+e.r,t.x+t.r)-e.x,a=-(Math.min(e.y-e.d,t.y-t.d)-e.y),i=Math.max(e.y+e.u,t.y+t.u)-e.y;return e.toRect({l:r,r:n,d:a,u:i})}}le.Point=class extends le{constructor(e,t){super(),this.x=e,this.y=t}get l(){return 0}get r(){return 0}get u(){return 0}get d(){return 0}isPoint(){return!0}isRect(){return!1}isCircle(){return!1}edgePoint(e,t){return this}proportionalEdgePoint(e,t){return this}grow(e,t){var r=Math.max(0,e),n=Math.max(0,t);return this.toRect({l:r,r,u:n,d:n})}toSize(e,t){return this.toRect({l:e/2,r:e/2,u:t/2,d:t/2})}growTo(e,t){var r=Math.max(0,e),n=Math.max(0,t);return this.toRect({l:r/2,r:r/2,u:n/2,d:n/2})}shrinkTo(e,t){return this}move(e,t){return new le.Point(e,t)}shiftFrame(e,t){return this}rotate(e){return this}contains(e){return!1}toString(){return"{x:"+this.x+", y:"+this.y+"}"}},le.Rect=class extends le{constructor(e,t,r){super(),this.x=e,this.y=t,this.l=r.l||0,this.r=r.r||0,this.u=r.u||0,this.d=r.d||0}isPoint(){return 0===this.l&&0===this.r&&0===this.u&&0===this.d}isRect(){return!this.isPoint()}isCircle(){return!1}edgePoint(e,t){if(this.isPoint())return this;var r,n=e-this.x,a=t-this.y;return n>0?(r=a*this.r/n)>this.u?new le.Point(this.x+this.u*n/a,this.y+this.u):r<-this.d?new le.Point(this.x-this.d*n/a,this.y-this.d):new le.Point(this.x+this.r,this.y+r):n<0?(r=-a*this.l/n)>this.u?new le.Point(this.x+this.u*n/a,this.y+this.u):r<-this.d?new le.Point(this.x-this.d*n/a,this.y-this.d):new le.Point(this.x-this.l,this.y+r):a>0?new le.Point(this.x,this.y+this.u):new le.Point(this.x,this.y-this.d)}proportionalEdgePoint(e,t){if(this.isPoint())return this;var r=e-this.x,n=t-this.y;if(Math.abs(r)<oe.machinePrecision&&Math.abs(n)<oe.machinePrecision)return new le.Point(this.x-this.l,this.y+this.u);var a,i=this.l+this.r,o=this.u+this.d,s=Math.PI,h=Math.atan2(n,r);return-3*s/4<h&&h<=-s/4?(a=(h+3*s/4)/(s/2),new le.Point(this.x+this.r-a*i,this.y+this.u)):-s/4<h&&h<=s/4?(a=(h+s/4)/(s/2),new le.Point(this.x-this.l,this.y+this.u-a*o)):s/4<h&&h<=3*s/4?(a=(h-s/4)/(s/2),new le.Point(this.x-this.l+a*i,this.y-this.d)):(a=(h-(h>0?3*s/4:-5*s/4))/(s/2),new le.Point(this.x+this.r,this.y-this.d+a*o))}grow(e,t){return this.toRect({l:Math.max(0,this.l+e),r:Math.max(0,this.r+e),u:Math.max(0,this.u+t),d:Math.max(0,this.d+t)})}toSize(e,t){var r,n,a,i,o=this.l+this.r,s=this.u+this.d;return 0===o?(i=e/2,a=e/2):(i=e*this.l/o,a=e*this.r/o),0===s?(r=t/2,n=t/2):(r=t*this.u/s,n=t*this.d/s),this.toRect({l:i,r:a,u:r,d:n})}growTo(e,t){var r=this.u,n=this.d,a=this.r,i=this.l,o=i+a,s=r+n;return e>o&&(0===o?(i=e/2,a=e/2):(i=e*this.l/o,a=e*this.r/o)),t>s&&(0===s?(r=t/2,n=t/2):(r=t*this.u/s,n=t*this.d/s)),this.toRect({l:i,r:a,u:r,d:n})}shrinkTo(e,t){var r=this.u,n=this.d,a=this.r,i=this.l,o=i+a,s=r+n;return e<o&&(0===o?(i=e/2,a=e/2):(i=e*this.l/o,a=e*this.r/o)),t<s&&(0===s?(r=t/2,n=t/2):(r=t*this.u/s,n=t*this.d/s)),this.toRect({l:i,r:a,u:r,d:n})}move(e,t){return new le.Rect(e,t,{l:this.l,r:this.r,u:this.u,d:this.d})}shiftFrame(e,t){return new le.Rect(this.x,this.y,{l:Math.max(0,this.l-e),r:Math.max(0,this.r+e),u:Math.max(0,this.u+t),d:Math.max(0,this.d-t)})}rotate(e){var t=Math.cos(e),r=Math.sin(e),n=-this.l,a=this.r,i=this.u,o=-this.d,s={x:n*t-i*r,y:n*r+i*t},h={x:n*t-o*r,y:n*r+o*t},u={x:a*t-i*r,y:a*r+i*t},c={x:a*t-o*r,y:a*r+o*t};return this.toRect({l:-Math.min(s.x,h.x,u.x,c.x),r:Math.max(s.x,h.x,u.x,c.x),u:Math.max(s.y,h.y,u.y,c.y),d:-Math.min(s.y,h.y,u.y,c.y)})}contains(e){var t=e.x,r=e.y;return t>=this.x-this.l&&t<=this.x+this.r&&r>=this.y-this.d&&r<=this.y+this.u}toString(){return"{x:"+this.x+", y:"+this.y+", l:"+this.l+", r:"+this.r+", u:"+this.u+", d:"+this.d+"}"}},le.Ellipse=class extends le{constructor(e,t,r,n,a,i){super(),this.x=e,this.y=t,this.l=r,this.r=n,this.u=a,this.d=i}isPoint(){return 0===this.r&&0===this.l||0===this.u&&0===this.d}isRect(){return!1}isCircle(){return!this.isPoint()}isPerfectCircle(){return this.l===this.r&&this.l===this.u&&this.l===this.d}edgePoint(e,t){if(this.isPoint())return this;if(this.isPerfectCircle()){var r,n=e-this.x,a=t-this.y;return r=Math.abs(n)<oe.machinePrecision&&Math.abs(a)<oe.machinePrecision?-Math.PI/2:Math.atan2(a,n),new le.Point(this.x+this.r*Math.cos(r),this.y+this.r*Math.sin(r))}Math.PI;var i=this.l,o=this.r,s=this.u,h=this.d,u=this.x,c=this.y,m=u+(o-i)/2,p=c+(s-h)/2,l=(i+o)/2,d=(s+h)/2,x=-(n=e-u),g=(a=t-c)*l,f=x*d,w=g*g+f*f,v=-(h=g*m+f*p+((n*c-a*u)*l+(l-d)*x*p))/w,S=w*l*l-h*h;if(S<0)return new le.Point(this.x,this.y-this.d);var y=Math.sqrt(S)/w,C=d/l,b=g*v+f*y+m,M=C*(f*v-g*y+p-p)+p,P=g*v-f*y+m,B=C*(f*v+g*y+p-p)+p,A=he;return A(b-m)===A(e-m)&&A(M-p)===A(t-p)?new le.Point(b,M):new le.Point(P,B)}proportionalEdgePoint(e,t){if(this.isPoint())return this;if(this.isPerfectCircle()){var r,n=e-this.x,a=t-this.y;return r=Math.abs(n)<oe.machinePrecision&&Math.abs(a)<oe.machinePrecision?-Math.PI/2:Math.atan2(a,n),new le.Point(this.x-this.r*Math.cos(r),this.y-this.r*Math.sin(r))}Math.PI;var i=this.l,o=this.r,s=this.u,h=this.d,u=this.x,c=this.y,m=u+(o-i)/2,p=c+(s-h)/2,l=(i+o)/2,d=(s+h)/2,x=-(n=e-u),g=(a=t-c)*l,f=x*d,w=g*g+f*f,v=-(h=g*m+f*p+((n*c-a*u)*l+(l-d)*x*p))/w,S=w*l*l-h*h;if(S<0)return new le.Point(this.x,this.y-this.d);var y=Math.sqrt(S)/w,C=d/l,b=g*v+f*y+m,M=C*(f*v-g*y+p-p)+p,P=g*v-f*y+m,B=C*(f*v+g*y+p-p)+p,A=he;return A(b-m)===A(e-m)&&A(M-p)===A(t-p)?new le.Point(P,B):new le.Point(b,M)}grow(e,t){return new le.Ellipse(this.x,this.y,Math.max(0,this.l+e),Math.max(0,this.r+e),Math.max(0,this.u+t),Math.max(0,this.d+t))}toSize(e,t){var r,n,a,i,o=this.l+this.r,s=this.u+this.d;return 0===o?(i=e/2,a=e/2):(i=e*this.l/o,a=e*this.r/o),0===s?(r=t/2,n=t/2):(r=t*this.u/s,n=t*this.d/s),new le.Ellipse(this.x,this.y,i,a,r,n)}growTo(e,t){var r=this.u,n=this.d,a=this.r,i=this.l,o=i+a,s=r+n;return e>o&&(0===o?(i=e/2,a=e/2):(i=e*this.l/o,a=e*this.r/o)),t>s&&(0===s?(r=t/2,n=t/2):(r=t*this.u/s,n=t*this.d/s)),new le.Ellipse(this.x,this.y,i,a,r,n)}shrinkTo(e,t){var r=this.u,n=this.d,a=this.r,i=this.l,o=i+a,s=r+n;return e<o&&(0===o?(i=e/2,a=e/2):(i=e*this.l/o,a=e*this.r/o)),t<s&&(0===s?(r=t/2,n=t/2):(r=t*this.u/s,n=t*this.d/s)),new le.Ellipse(this.x,this.y,i,a,r,n)}move(e,t){return new le.Ellipse(e,t,this.l,this.r,this.u,this.d)}shiftFrame(e,t){return new le.Ellipse(this.x,this.y,Math.max(0,this.l-e),Math.max(0,this.r+e),Math.max(0,this.u+t),Math.max(0,this.d-t))}rotate(e){return this}contains(e){var t=e.x,r=e.y;if(this.isPoint())return!1;var n=this.l,a=this.r,i=this.u,o=this.d,s=(n+a)/2,h=t-(this.x+(a-n)/2),u=(r-(this.y+(i-o)/2))/((i+o)/2/s);return h*h+u*u<=s*s}toString(){return"{x:"+this.x+", y:"+this.y+", l:"+this.l+", r:"+this.r+", u:"+this.u+", d:"+this.d+"}"}};class de{get isNone(){return!1}}de.NoneShape=class extends de{constructor(){super()}draw(e){}getBoundingBox(){}toString(){return"NoneShape"}get isNone(){return!0}},de.none=new de.NoneShape,de.InvisibleBoxShape=class extends de{constructor(e){super(),this.bbox=e}draw(e){}getBoundingBox(){return this.bbox}toString(){return"InvisibleBoxShape[bbox:"+this.bbox.toString()+"]"}},de.TranslateShape=class extends de{constructor(e,t,r){super(),this.dx=e,this.dy=t,this.shape=r,ce(this,"getBoundingBox")}draw(e){var t=e.createGroup(e.transformBuilder().translate(this.dx,this.dy));this.shape.draw(t)}getBoundingBox(){var e=this.shape.getBoundingBox();if(void 0!==e)return new le.Rect(e.x+this.dx,e.y+this.dy,e)}toString(){return"TranslateShape[dx:"+this.dx+", dy:"+this.dy+", shape:"+this.shape.toString()+"]"}},de.CompositeShape=class extends de{constructor(e,t){super(),this.foregroundShape=e,this.backgroundShape=t,ce(this,"getBoundingBox")}draw(e){this.backgroundShape.draw(e),this.foregroundShape.draw(e)}getBoundingBox(){return le.combineRect(this.foregroundShape.getBoundingBox(),this.backgroundShape.getBoundingBox())}toString(){return"("+this.foregroundShape.toString()+", "+this.backgroundShape.toString()+")"}},de.ChangeColorShape=class extends de{constructor(e,t){super(),this.color=e,this.shape=t,ce(this,"getBoundingBox")}draw(e){var t=e.createChangeColorGroup(this.color);this.shape.draw(t)}getBoundingBox(){return this.shape.getBoundingBox()}toString(){return this.shape+", color:"+this.color}},de.CircleSegmentShape=class extends de{constructor(e,t,r,n,a,i,o,s,h){super(),this.x=e,this.y=t,this.sx=r,this.sy=n,this.r=a,this.large=i,this.flip=o,this.ex=s,this.ey=h,ce(this,"getBoundingBox")}draw(e){e.createSvgElement("path",{d:"M"+Q.measure.em2px(this.sx)+","+Q.measure.em2px(-this.sy)+" A"+Q.measure.em2px(this.r)+","+Q.measure.em2px(this.r)+" 0 "+this.large+","+this.flip+" "+Q.measure.em2px(this.ex)+","+Q.measure.em2px(-this.ey)})}getBoundingBox(){return new le.Ellipse(this.x,this.y,this.r,this.r,this.r,this.r)}toString(){return"CircleSegmentShape[x:"+this.x+", y:"+this.y+", sx:"+this.sx+", sy:"+this.sy+", r:"+this.r+", large:"+this.large+", flip:"+this.flip+", ex:"+this.ex+", ey:"+this.ey+"]"}},de.FullCircleShape=class extends de{constructor(e,t,r){super(),this.x=e,this.y=t,this.r=r,ce(this,"getBoundingBox")}draw(e){e.createSvgElement("circle",{cx:Q.measure.em2px(this.x),cy:Q.measure.em2px(-this.y),r:Q.measure.em2px(this.r)})}getBoundingBox(){return new le.Ellipse(this.x,this.y,this.r,this.r,this.r,this.r)}toString(){return"FullCircleShape[x:"+this.x+", y:"+this.y+", r:"+this.r+"]"}},de.RectangleShape=class extends de{constructor(e,t,r,n,a,i,o,s,h,u,c,m){super(),this.x=e,this.y=t,this.left=r,this.right=n,this.up=a,this.down=i,this.r=o,this.isDoubled=s,this.color=h,this.dasharray=u,this.fillColor=c,this.hideLine=m||!1,ce(this,"getBoundingBox")}draw(e){var t;t={x:Q.measure.em2px(this.x-this.left),y:-Q.measure.em2px(this.y+this.up),width:Q.measure.em2px(this.left+this.right),height:Q.measure.em2px(this.up+this.down),rx:Q.measure.em2px(this.r)},void 0!==this.dasharray&&(t["stroke-dasharray"]=this.dasharray),this.hideLine?t.stroke="none":void 0!==this.color&&(t.stroke=this.color),void 0!==this.fillColor&&(t.fill=this.fillColor),e.createSvgElement("rect",t),this.isDoubled&&(t={x:Q.measure.em2px(this.x-this.left+Q.measure.thickness),y:-Q.measure.em2px(this.y+this.up-Q.measure.thickness),width:Q.measure.em2px(this.left+this.right-2*Q.measure.thickness),height:Q.measure.em2px(this.up+this.down-2*Q.measure.thickness),rx:Q.measure.em2px(Math.max(this.r-Q.measure.thickness,0))},void 0!==this.dasharray&&(t["stroke-dasharray"]=this.dasharray),this.hideLine?t.stroke="none":void 0!==this.color&&(t.stroke=this.color),void 0!==this.fillColor&&(t.fill=this.fillColor),e.createSvgElement("rect",t))}getBoundingBox(){return new le.Rect(this.x,this.y,{l:this.left,r:this.right,u:this.up,d:this.down})}toString(){return"RectangleShape[x:"+this.x+", y:"+this.y+", left:"+this.left+", right:"+this.right+", up:"+this.up+", down:"+this.down+", r:"+this.r+", isDouble:"+this.isDouble+", dasharray:"+this.dasharray+"]"}},de.EllipseShape=class extends de{constructor(e,t,r,n,a,i,o,s,h){super(),this.x=e,this.y=t,this.rx=r,this.ry=n,this.isDoubled=a,this.color=i,this.dasharray=o,this.fillColor=s,this.hideLine=h||!1,ce(this,"getBoundingBox")}draw(e){var t;t={cx:Q.measure.em2px(this.x),cy:-Q.measure.em2px(this.y),rx:Q.measure.em2px(this.rx),ry:Q.measure.em2px(this.ry)},void 0!==this.dasharray&&(t["stroke-dasharray"]=this.dasharray),this.hideLine?t.stroke="none":void 0!==this.color&&(t.stroke=this.color),void 0!==this.fillColor&&(t.fill=this.fillColor),e.createSvgElement("ellipse",t),this.isDoubled&&(t={cx:Q.measure.em2px(this.x),cy:-Q.measure.em2px(this.y),rx:Q.measure.em2px(Math.max(this.rx-Q.measure.thickness)),ry:Q.measure.em2px(Math.max(this.ry-Q.measure.thickness))},void 0!==this.dasharray&&(t["stroke-dasharray"]=this.dasharray),this.hideLine?t.stroke="none":void 0!==this.color&&(t.stroke=this.color),void 0!==this.fillColor&&(t.fill=this.fillColor),e.createSvgElement("ellipse",t))}getBoundingBox(){return new le.Rect(this.x,this.y,{l:this.rx,r:this.rx,u:this.ry,d:this.ry})}toString(){return"EllipseShape[x:"+this.x+", y:"+this.y+", rx:"+this.rx+", ry:"+this.ry+", isDoubled:"+this.isDoubled+", dasharray:"+this.dasharray+"]"}},de.BoxShadeShape=class extends de{constructor(e,t,r,n,a,i,o,s){super(),this.x=e,this.y=t,this.left=r,this.right=n,this.up=a,this.down=i,this.depth=o,this.color=s||"currentColor",ce(this,"getBoundingBox")}draw(e){var t=Q.measure.em2px(this.x),r=Q.measure.em2px(this.y),n=Q.measure.em2px(this.left),a=Q.measure.em2px(this.right),i=Q.measure.em2px(this.up),o=Q.measure.em2px(this.down),s=Q.measure.em2px(this.depth);e.createSvgElement("path",{d:"M"+(t-n+s)+","+(-r+o)+"L"+(t+a)+","+(-r+o)+"L"+(t+a)+","+(-r-i+s)+"L"+(t+a+s)+","+(-r-i+s)+"L"+(t+a+s)+","+(-r+o+s)+"L"+(t-n+s)+","+(-r+o+s)+"Z",stroke:this.color,fill:this.color})}getBoundingBox(){return new le.Rect(this.x,this.y,{l:this.left,r:this.right+this.depth,u:this.up,d:this.down+this.depth})}toString(){return"RectangleShape[x:"+this.x+", y:"+this.y+", left:"+this.left+", right:"+this.right+", up:"+this.up+", down:"+this.down+", depth:"+this.depth+"]"}},de.LeftBrace=class extends de{constructor(e,t,r,n,a,i){super(),this.x=e,this.y=t,this.up=r,this.down=n,this.degree=a,this.color=i||"currentColor",ce(this,"getBoundingBox")}draw(e){var t,r=Q.measure.oneem,n=Math.max(1.41975,this.down/r*1.125)-.660375,a=.660375-Math.max(1.41975,this.up/r*1.125);t="M"+Q.measure.em2px(-.0675)+" "+Q.measure.em2px(n)+"T"+Q.measure.em2px(-.068625)+" "+Q.measure.em2px(.07875+n)+"Q"+Q.measure.em2px(-.068625)+" "+Q.measure.em2px(.190125+n)+" "+Q.measure.em2px(-.0585)+" "+Q.measure.em2px(.250875+n)+"T"+Q.measure.em2px(-.01125)+" "+Q.measure.em2px(.387+n)+"Q"+Q.measure.em2px(.07425)+" "+Q.measure.em2px(.55575+n)+" "+Q.measure.em2px(.2475)+" "+Q.measure.em2px(.6525+n)+"L"+Q.measure.em2px(.262125)+" "+Q.measure.em2px(.660375+n)+"L"+Q.measure.em2px(.3015)+" "+Q.measure.em2px(.660375+n)+"L"+Q.measure.em2px(.30825)+" "+Q.measure.em2px(.653625+n)+"V"+Q.measure.em2px(.622125+n)+"Q"+Q.measure.em2px(.30825)+" "+Q.measure.em2px(.60975+n)+" "+Q.measure.em2px(.2925)+" "+Q.measure.em2px(.60075+n)+"Q"+Q.measure.em2px(.205875)+" "+Q.measure.em2px(.541125+n)+" "+Q.measure.em2px(.149625)+" "+Q.measure.em2px(.44775+n)+"T"+Q.measure.em2px(.07425)+" "+Q.measure.em2px(.239625+n)+"Q"+Q.measure.em2px(.07425)+" "+Q.measure.em2px(.2385+n)+" "+Q.measure.em2px(.073125)+" "+Q.measure.em2px(.235125+n)+"Q"+Q.measure.em2px(.068625)+" "+Q.measure.em2px(.203625+n)+" "+Q.measure.em2px(.0675)+" "+Q.measure.em2px(.041625+n)+"L"+Q.measure.em2px(.0675)+" "+Q.measure.em2px(.75825)+"Q"+Q.measure.em2px(.0675)+" "+Q.measure.em2px(.496125)+" "+Q.measure.em2px(.066375)+" "+Q.measure.em2px(.486)+"Q"+Q.measure.em2px(.05625)+" "+Q.measure.em2px(.336375)+" "+Q.measure.em2px(-.021375)+" "+Q.measure.em2px(.212625)+"T"+Q.measure.em2px(-.226125)+" "+Q.measure.em2px(.010125)+"L"+Q.measure.em2px(-.241875)+" 0L"+Q.measure.em2px(-.226125)+" "+Q.measure.em2px(-.010125)+"Q"+Q.measure.em2px(-.106875)+" "+Q.measure.em2px(-.084375)+" "+Q.measure.em2px(-.025875)+" "+Q.measure.em2px(-.207)+"T"+Q.measure.em2px(.066375)+" "+Q.measure.em2px(-.486)+"Q"+Q.measure.em2px(.0675)+" "+Q.measure.em2px(-.496125)+" "+Q.measure.em2px(.0675)+" "+Q.measure.em2px(-.75825)+"L"+Q.measure.em2px(.0675)+" "+Q.measure.em2px(-.041625+a)+"Q"+Q.measure.em2px(.068625)+" "+Q.measure.em2px(-.203625+a)+" "+Q.measure.em2px(.073125)+" "+Q.measure.em2px(-.235125+a)+"Q"+Q.measure.em2px(.07425)+" "+Q.measure.em2px(-.2385+a)+" "+Q.measure.em2px(.07425)+" "+Q.measure.em2px(-.239625+a)+"Q"+Q.measure.em2px(.093375)+" "+Q.measure.em2px(-.354375+a)+" "+Q.measure.em2px(.149625)+" "+Q.measure.em2px(-.44775+a)+"T"+Q.measure.em2px(.2925)+" "+Q.measure.em2px(-.60075+a)+"Q"+Q.measure.em2px(.30825)+" "+Q.measure.em2px(-.60975+a)+" "+Q.measure.em2px(.30825)+" "+Q.measure.em2px(-.622125+a)+"L"+Q.measure.em2px(.30825)+" "+Q.measure.em2px(-.653625+a)+"L"+Q.measure.em2px(.3015)+" "+Q.measure.em2px(-.660375+a)+"L"+Q.measure.em2px(.262125)+" "+Q.measure.em2px(-.660375+a)+"L"+Q.measure.em2px(.2475)+" "+Q.measure.em2px(-.6525+a)+"Q"+Q.measure.em2px(.07425)+" "+Q.measure.em2px(-.55575+a)+" "+Q.measure.em2px(-.01125)+" "+Q.measure.em2px(-.387+a)+"Q"+Q.measure.em2px(-.048375)+" "+Q.measure.em2px(-.311625+a)+" "+Q.measure.em2px(-.0585)+" "+Q.measure.em2px(-.250875+a)+"T"+Q.measure.em2px(-.068625)+" "+Q.measure.em2px(-.07875+a)+"Q"+Q.measure.em2px(-.0675)+" "+Q.measure.em2px(a)+" "+Q.measure.em2px(-.0675)+" "+Q.measure.em2px(a)+"L"+Q.measure.em2px(-.0675)+" "+Q.measure.em2px(-.759375)+"V"+Q.measure.em2px(-.5985)+"Q"+Q.measure.em2px(-.0675)+" "+Q.measure.em2px(-.47925)+" "+Q.measure.em2px(-.075375)+" "+Q.measure.em2px(-.41175)+"T"+Q.measure.em2px(-.11475)+" "+Q.measure.em2px(-.27)+"Q"+Q.measure.em2px(-.133875)+" "+Q.measure.em2px(-.2205)+" "+Q.measure.em2px(-.160875)+" "+Q.measure.em2px(-.17775)+"T"+Q.measure.em2px(-.212625)+" "+Q.measure.em2px(-.106875)+"T"+Q.measure.em2px(-.25875)+" "+Q.measure.em2px(-.06075)+"T"+Q.measure.em2px(-.293625)+" "+Q.measure.em2px(-.0315)+"T"+Q.measure.em2px(-.307125)+" "+Q.measure.em2px(-.02025)+"Q"+Q.measure.em2px(-.30825)+" "+Q.measure.em2px(-.019125)+" "+Q.measure.em2px(-.30825)+" 0T"+Q.measure.em2px(-.307125)+" "+Q.measure.em2px(.02025)+"Q"+Q.measure.em2px(-.307125)+" "+Q.measure.em2px(.021375)+" "+Q.measure.em2px(-.284625)+" "+Q.measure.em2px(.03825)+"T"+Q.measure.em2px(-.2295)+" "+Q.measure.em2px(.091125)+"T"+Q.measure.em2px(-.162)+" "+Q.measure.em2px(.176625)+"T"+Q.measure.em2px(-.10125)+" "+Q.measure.em2px(.30825)+"T"+Q.measure.em2px(-.068625)+" "+Q.measure.em2px(.482625)+"Q"+Q.measure.em2px(-.0675)+" "+Q.measure.em2px(.496125)+" "+Q.measure.em2px(-.0675)+" "+Q.measure.em2px(.759375)+"Z",e.createSvgElement("path",{d:t,fill:this.color,stroke:this.color,"stroke-width":"0pt",transform:"translate("+Q.measure.em2px(this.x)+","+Q.measure.em2px(-this.y)+") rotate("+-this.degree+") scale("+r/1.125+")"})}getBoundingBox(){var e=Q.measure.oneem;return new le.Rect(this.x,this.y,{l:.274*e,r:.274*e,u:Math.max(1.41975*e/1.125,this.up),d:Math.max(1.41975*e/1.125,this.down)}).rotate(this.degree*Math.PI/180)}toString(){return"LeftBrace[x:"+this.x+", y:"+this.y+", up:"+this.up+", down:"+this.down+"]"}},de.LeftParenthesis=class extends de{constructor(e,t,r,n,a){super(),this.x=e,this.y=t,this.height=r,this.degree=n,this.color=a||"currentColor",ce(this,"getBoundingBox")}draw(e){var t,r=Q.measure.oneem,n=Math.max(.660375,this.height/2/r*1.125)-.660375,a=-n;t="M"+Q.measure.em2px(-.0675)+" "+Q.measure.em2px(n)+"T"+Q.measure.em2px(-.068625)+" "+Q.measure.em2px(.07875+n)+"Q"+Q.measure.em2px(-.068625)+" "+Q.measure.em2px(.190125+n)+" "+Q.measure.em2px(-.0585)+" "+Q.measure.em2px(.250875+n)+"T"+Q.measure.em2px(-.01125)+" "+Q.measure.em2px(.387+n)+"Q"+Q.measure.em2px(.07425)+" "+Q.measure.em2px(.55575+n)+" "+Q.measure.em2px(.2475)+" "+Q.measure.em2px(.6525+n)+"L"+Q.measure.em2px(.262125)+" "+Q.measure.em2px(.660375+n)+"L"+Q.measure.em2px(.3015)+" "+Q.measure.em2px(.660375+n)+"L"+Q.measure.em2px(.30825)+" "+Q.measure.em2px(.653625+n)+"V"+Q.measure.em2px(.622125+n)+"Q"+Q.measure.em2px(.30825)+" "+Q.measure.em2px(.60975+n)+" "+Q.measure.em2px(.2925)+" "+Q.measure.em2px(.60075+n)+"Q"+Q.measure.em2px(.205875)+" "+Q.measure.em2px(.541125+n)+" "+Q.measure.em2px(.149625)+" "+Q.measure.em2px(.44775+n)+"T"+Q.measure.em2px(.07425)+" "+Q.measure.em2px(.239625+n)+"Q"+Q.measure.em2px(.07425)+" "+Q.measure.em2px(.2385+n)+" "+Q.measure.em2px(.073125)+" "+Q.measure.em2px(.235125+n)+"Q"+Q.measure.em2px(.068625)+" "+Q.measure.em2px(.203625+n)+" "+Q.measure.em2px(.0675)+" "+Q.measure.em2px(.041625+n)+"L"+Q.measure.em2px(.0675)+" "+Q.measure.em2px(-.041625+a)+"Q"+Q.measure.em2px(.068625)+" "+Q.measure.em2px(-.203625+a)+" "+Q.measure.em2px(.073125)+" "+Q.measure.em2px(-.235125+a)+"Q"+Q.measure.em2px(.07425)+" "+Q.measure.em2px(-.2385+a)+" "+Q.measure.em2px(.07425)+" "+Q.measure.em2px(-.239625+a)+"Q"+Q.measure.em2px(.093375)+" "+Q.measure.em2px(-.354375+a)+" "+Q.measure.em2px(.149625)+" "+Q.measure.em2px(-.44775+a)+"T"+Q.measure.em2px(.2925)+" "+Q.measure.em2px(-.60075+a)+"Q"+Q.measure.em2px(.30825)+" "+Q.measure.em2px(-.60975+a)+" "+Q.measure.em2px(.30825)+" "+Q.measure.em2px(-.622125+a)+"L"+Q.measure.em2px(.30825)+" "+Q.measure.em2px(-.653625+a)+"L"+Q.measure.em2px(.3015)+" "+Q.measure.em2px(-.660375+a)+"L"+Q.measure.em2px(.262125)+" "+Q.measure.em2px(-.660375+a)+"L"+Q.measure.em2px(.2475)+" "+Q.measure.em2px(-.6525+a)+"Q"+Q.measure.em2px(.07425)+" "+Q.measure.em2px(-.55575+a)+" "+Q.measure.em2px(-.01125)+" "+Q.measure.em2px(-.387+a)+"Q"+Q.measure.em2px(-.048375)+" "+Q.measure.em2px(-.311625+a)+" "+Q.measure.em2px(-.0585)+" "+Q.measure.em2px(-.250875+a)+"T"+Q.measure.em2px(-.068625)+" "+Q.measure.em2px(-.07875+a)+"Q"+Q.measure.em2px(-.0675)+" "+Q.measure.em2px(a)+" "+Q.measure.em2px(-.0675)+" "+Q.measure.em2px(a)+"Z",e.createSvgElement("path",{d:t,fill:this.color,stroke:this.color,"stroke-width":"0pt",transform:"translate("+Q.measure.em2px(this.x)+","+Q.measure.em2px(-this.y)+") rotate("+-this.degree+") scale("+r/1.125+")"})}getBoundingBox(){var e=Q.measure.oneem;return new le.Rect(this.x,this.y,{l:.06*e,r:.274*e,u:Math.max(.660375*e/1.125,this.height/2),d:Math.max(.660375*e/1.125,this.height/2)}).rotate(this.degree*Math.PI/180)}toString(){return"LeftBrace[x:"+this.x+", y:"+this.y+", up:"+this.up+", down:"+this.down+"]"}},de.TextShape=class extends de{constructor(e,t){super(),this.c=e,this.math=t,this.originalBBox=void 0,ce(this,"getBoundingBox"),ce(this,"getOriginalReferencePoint")}draw(e){this._draw(e,!1)}getBoundingBox(){return this._draw(Q.svgForTestLayout,!0)}_draw(e,t){return e.xypicWrapper.drawTextObject(this,e,t)}getOriginalReferencePoint(){this.getBoundingBox();var e=this.originalBBox,t=this.c,r=e.H,n=e.D;return new le.Point(t.x,t.y-(r-n)/2)}toString(){return"TextShape[c:"+this.c.toString()+", math:"+this.math.toString()+"]"}},de.ImageShape=class extends de{constructor(e,t){super(),this.c=e,this.url=t,ce(this,"getBoundingBox"),ce(this,"getOriginalReferencePoint")}draw(e){var t=this.c;e.createSvgElement("image",{x:Q.measure.em2px(t.x-t.l),y:Q.measure.em2px(-t.y-t.u),width:Q.measure.em2px(t.l+t.r),height:Q.measure.em2px(t.u+t.d),preserveAspectRatio:"none","xlink:href":this.url})}getBoundingBox(){return this.c}getOriginalReferencePoint(){return this.c}toString(){return"ImageShape[c:"+this.c.toString()+", height:"+this.height+", width:"+this.width+", url:"+this.url+"]"}},de.ArrowheadShape=class extends de{constructor(){super()}draw(e){var t=e.createGroup(e.transformBuilder().translate(this.c.x,this.c.y).rotateRadian(this.angle));this.drawDelegate(t)}getBoundingBox(){return this.c.toRect(this.getBox()).rotate(this.angle)}toString(){return"ArrowheadShape[c:"+this.c.toString()+", angle:"+this.angle+"]"}},de.GT2ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:.456*e,r:0,d:.229*e,u:.229*e}}getRadius(){return.213*Q.measure.oneem}drawDelegate(e){var t=Q.measure.oneem,r=e.createGroup(e.transformBuilder().rotateDegree(-10)),n=e.createGroup(e.transformBuilder().rotateDegree(10));r.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)}),n.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)})}},de.GT3ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:.507*e,r:0,d:.268*e,u:.268*e}}getRadius(){return.325*Q.measure.oneem}drawDelegate(e){var t=Q.measure.oneem,r=e.createGroup(e.transformBuilder().rotateDegree(-15)),n=e.createGroup(e.transformBuilder().rotateDegree(15));r.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)}),e.createSvgElement("line",{x1:0,y1:0,x2:Q.measure.em2px(-.507*t),y2:0}),n.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)})}},de.UpperGTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:.489*e,r:0,d:0,u:.147*e}}drawDelegate(e){var t=Q.measure.oneem;e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)})}},de.LowerGTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:.489*e,r:0,d:.147*e,u:0}}drawDelegate(e){var t=Q.measure.oneem;e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)})}},de.GTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:.489*e,r:0,d:.147*e,u:.147*e}}drawDelegate(e){var t=Q.measure.oneem;e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)})}},de.LT2ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:0,r:.456*e,d:.229*e,u:.229*e}}getRadius(){return.213*Q.measure.oneem}drawDelegate(e){var t=Q.measure.oneem,r=e.createGroup(e.transformBuilder().rotateDegree(10)),n=e.createGroup(e.transformBuilder().rotateDegree(-10));r.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(-.147*t)}),n.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(.147*t)})}},de.LT3ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:0,r:.507*e,d:.268*e,u:.268*e}}getRadius(){return.325*Q.measure.oneem}drawDelegate(e){var t=Q.measure.oneem,r=e.createGroup(e.transformBuilder().rotateDegree(15)),n=e.createGroup(e.transformBuilder().rotateDegree(-15));r.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(-.147*t)}),e.createSvgElement("line",{x1:0,y1:0,x2:Q.measure.em2px(.507*t),y2:0}),n.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(.147*t)})}},de.UpperLTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:0,r:.489*e,d:0,u:.147*e}}drawDelegate(e){var t=Q.measure.oneem;e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(-.147*t)})}},de.LowerLTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:0,r:.489*e,d:.147*e,u:0}}drawDelegate(e){var t=Q.measure.oneem;e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(.147*t)})}},de.LTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:0,r:.489*e,d:.147*e,u:.147*e}}drawDelegate(e){var t=Q.measure.oneem;e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(-.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(.147*t)})}},de.UpperColumnArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:0,u:Q.measure.lineElementLength,d:0}}drawDelegate(e){var t=Q.measure.em2px(Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:0,x2:0,y2:-t})}},de.LowerColumnArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:0,u:0,d:Q.measure.lineElementLength}}drawDelegate(e){var t=Q.measure.em2px(Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:0,x2:0,y2:t})}},de.Column2ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:0,u:.5*(Q.measure.lineElementLength+Q.measure.thickness),d:.5*(Q.measure.lineElementLength+Q.measure.thickness)}}drawDelegate(e){var t=Q.measure.em2px(.5*(Q.measure.lineElementLength+Q.measure.thickness));e.createSvgElement("line",{x1:0,y1:t,x2:0,y2:-t})}},de.Column3ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:0,u:.5*Q.measure.lineElementLength+Q.measure.thickness,d:.5*Q.measure.lineElementLength+Q.measure.thickness}}drawDelegate(e){var t=Q.measure.em2px(.5*Q.measure.lineElementLength+Q.measure.thickness);e.createSvgElement("line",{x1:0,y1:t,x2:0,y2:-t})}},de.ColumnArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:0,u:.5*Q.measure.lineElementLength,d:.5*Q.measure.lineElementLength}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:t,x2:0,y2:-t})}},de.UpperLParenArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:.5*Q.measure.lineElementLength,r:0,u:Q.measure.lineElementLength,d:0}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("path",{d:"M0,0 A "+t+","+t+" 0 0,1 0,"+-2*t})}},de.LowerLParenArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:.5*Q.measure.lineElementLength,r:0,u:0,d:Q.measure.lineElementLength}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("path",{d:"M0,0 A "+t+","+t+" 0 0,0 0,"+2*t})}},de.LParenArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:.5*Q.measure.lineElementLength,u:.5*Q.measure.lineElementLength,d:.5*Q.measure.lineElementLength}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("path",{d:"M"+t+","+-t+" A "+t+","+t+" 0 0,0 "+t+","+t})}},de.UpperRParenArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:.5*Q.measure.lineElementLength,u:Q.measure.lineElementLength,d:0}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("path",{d:"M0,0 A "+t+","+t+" 0 0,0 0,"+-2*t})}},de.LowerRParenArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:.5*Q.measure.lineElementLength,u:0,d:Q.measure.lineElementLength}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("path",{d:"M0,0 A "+t+","+t+" 0 0,1 0,"+2*t})}},de.RParenArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:.5*Q.measure.lineElementLength,r:0,u:.5*Q.measure.lineElementLength,d:.5*Q.measure.lineElementLength}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("path",{d:"M"+-t+","+-t+" A "+t+","+t+" 0 0,1 "+-t+","+t})}},de.LowerBackquoteArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:.5*Q.measure.lineElementLength,r:0,u:0,d:.5*Q.measure.lineElementLength}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("path",{d:"M0,0 A "+t+","+t+" 0 0,0 "+-t+","+t})}},de.UpperBackquoteArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:.5*Q.measure.lineElementLength,r:0,u:.5*Q.measure.lineElementLength,d:0}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("path",{d:"M0,0 A "+t+","+t+" 0 0,1 "+-t+","+-t})}},de.LowerQuoteArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:.5*Q.measure.lineElementLength,u:0,d:.5*Q.measure.lineElementLength}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("path",{d:"M0,0 A "+t+","+t+" 0 0,1 "+t+","+t})}},de.UpperQuoteArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:.5*Q.measure.lineElementLength,u:.5*Q.measure.lineElementLength,d:0}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("path",{d:"M0,0 A "+t+","+t+" 0 0,0 "+t+","+-t})}},de.AsteriskArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=0,ce(this,"getBoundingBox")}getBox(){return{l:Q.measure.thickness,r:Q.measure.thickness,u:Q.measure.thickness,d:Q.measure.thickness}}drawDelegate(e){e.createSvgElement("circle",{cx:0,cy:0,r:Q.measure.em2px(Q.measure.thickness),fill:"currentColor"})}},de.OArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=0,ce(this,"getBoundingBox")}getBox(){return{l:Q.measure.thickness,r:Q.measure.thickness,u:Q.measure.thickness,d:Q.measure.thickness}}drawDelegate(e){e.createSvgElement("circle",{cx:0,cy:0,r:Q.measure.em2px(Q.measure.thickness)})}},de.PlusArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:.5*Q.measure.lineElementLength,r:.5*Q.measure.lineElementLength,u:.5*Q.measure.lineElementLength,d:.5*Q.measure.lineElementLength}}drawDelegate(e){var t=Q.measure.lineElementLength/2,r=Q.measure.em2px(t);e.createSvgElement("line",{x1:-r,y1:0,x2:r,y2:0}),e.createSvgElement("line",{x1:0,y1:r,x2:0,y2:-r})}},de.XArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t+Math.PI/4,ce(this,"getBoundingBox")}getBox(){return{l:.5*Q.measure.lineElementLength,r:.5*Q.measure.lineElementLength,u:.5*Q.measure.lineElementLength,d:.5*Q.measure.lineElementLength}}drawDelegate(e){var t=Q.measure.lineElementLength/2,r=Q.measure.em2px(t);e.createSvgElement("line",{x1:-r,y1:0,x2:r,y2:0}),e.createSvgElement("line",{x1:0,y1:r,x2:0,y2:-r})}},de.SlashArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t-Math.PI/10,ce(this,"getBoundingBox")}getBox(){return{l:0,r:0,u:Q.measure.lineElementLength/2,d:Q.measure.lineElementLength/2}}drawDelegate(e){var t=Q.measure.lineElementLength/2,r=Q.measure.em2px(t);e.createSvgElement("line",{x1:0,y1:r,x2:0,y2:-r})}},de.Line3ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:Q.measure.lineElementLength,u:Q.measure.thickness,d:Q.measure.thickness}}drawDelegate(e){var t=Q.measure.em2px(Q.measure.lineElementLength),r=Q.measure.em2px(Q.measure.thickness);e.createSvgElement("line",{x1:0,y1:r,x2:t,y2:r}),e.createSvgElement("line",{x1:0,y1:0,x2:t,y2:0}),e.createSvgElement("line",{x1:0,y1:-r,x2:t,y2:-r})}},de.Line2ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:Q.measure.lineElementLength,u:.5*Q.measure.thickness,d:.5*Q.measure.thickness}}drawDelegate(e){var t=Q.measure.em2px(.5*Q.measure.thickness),r=Q.measure.em2px(Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:t,x2:r,y2:t}),e.createSvgElement("line",{x1:0,y1:-t,x2:r,y2:-t})}},de.LineArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:Q.measure.lineElementLength,u:0,d:0}}drawDelegate(e){var t=Q.measure.em2px(Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:0,x2:t,y2:0})}},de.Dot3ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:0,u:Q.measure.thickness,d:Q.measure.thickness}}drawDelegate(e){Q.measure.oneem;var t=Q.measure.em2px(Q.measure.thickness),r=Q.measure.em2px(Q.measure.thickness),n=Q.measure.dottedDasharray;e.createSvgElement("line",{x1:0,y1:t,x2:r,y2:t,"stroke-dasharray":n}),e.createSvgElement("line",{x1:0,y1:0,x2:r,y2:0,"stroke-dasharray":n}),e.createSvgElement("line",{x1:0,y1:-t,x2:r,y2:-t,"stroke-dasharray":n})}},de.Dot2ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:0,u:.5*Q.measure.thickness,d:.5*Q.measure.thickness}}drawDelegate(e){var t=Q.measure.em2px(.5*Q.measure.thickness),r=Q.measure.em2px(Q.measure.thickness),n=Q.measure.dottedDasharray;e.createSvgElement("line",{x1:0,y1:t,x2:r,y2:t,"stroke-dasharray":n}),e.createSvgElement("line",{x1:0,y1:-t,x2:r,y2:-t,"stroke-dasharray":n})}},de.DotArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:0,u:0,d:0}}drawDelegate(e){Q.measure.oneem;var t=Q.measure.em2px(Q.measure.thickness),r=Q.measure.dottedDasharray;e.createSvgElement("line",{x1:0,y1:0,x2:t,y2:0,"stroke-dasharray":r})}},de.Tilde3ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:-2*Q.measure.thickness,r:2*Q.measure.thickness,u:2*Q.measure.thickness,d:2*Q.measure.thickness}}drawDelegate(e){var t=Q.measure.em2px(Q.measure.thickness);e.createSvgElement("path",{d:"M"+-2*t+","+t+" Q"+-t+",0 0,"+t+" T"+2*t+","+t+"M"+-2*t+",0 Q"+-t+","+-t+" 0,0 T"+2*t+",0M"+-2*t+","+-t+" Q"+-t+","+-2*t+" 0,"+-t+" T"+2*t+","+-t})}},de.Tilde2ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:-2*Q.measure.thickness,r:2*Q.measure.thickness,u:1.5*Q.measure.thickness,d:1.5*Q.measure.thickness}}drawDelegate(e){var t=Q.measure.em2px(Q.measure.thickness);e.createSvgElement("path",{d:"M"+-2*t+","+.5*t+" Q"+-t+","+-.5*t+" 0,"+.5*t+" T"+2*t+","+.5*t+"M"+-2*t+","+-.5*t+" Q"+-t+","+-1.5*t+" 0,"+-.5*t+" T"+2*t+","+-.5*t})}},de.TildeArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:-2*Q.measure.thickness,r:2*Q.measure.thickness,u:Q.measure.thickness,d:Q.measure.thickness}}drawDelegate(e){var t=Q.measure.em2px(Q.measure.thickness);e.createSvgElement("path",{d:"M"+-2*t+",0 Q"+-t+","+-t+" 0,0 T"+2*t+",0"})}},de.TildeArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:-2*Q.measure.thickness,r:2*Q.measure.thickness,u:Q.measure.thickness,d:Q.measure.thickness}}drawDelegate(e){var t=Q.measure.em2px(Q.measure.thickness);e.createSvgElement("path",{d:"M"+-2*t+",0 Q"+-t+","+-t+" 0,0 T"+2*t+",0"})}},de.GTGTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:.489*e+2*Q.measure.thickness,r:0,d:.147*e,u:.147*e}}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.thickness,n=Q.measure.em2px(2*r);e.createSvgElement("path",{d:"M"+-n+",0 Q"+(Q.measure.em2px(-.222*t)-n)+","+Q.measure.em2px(.02*t)+" "+(Q.measure.em2px(-.489*t)-n)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("path",{d:"M"+-n+",0 Q"+(Q.measure.em2px(-.222*t)-n)+","+Q.measure.em2px(-.02*t)+" "+(Q.measure.em2px(-.489*t)-n)+","+Q.measure.em2px(-.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)})}},de.UpperGTGTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:.489*e+2*Q.measure.thickness,r:0,d:0,u:.147*e}}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.thickness,n=Q.measure.em2px(2*r);e.createSvgElement("path",{d:"M"+-n+",0 Q"+(Q.measure.em2px(-.222*t)-n)+","+Q.measure.em2px(-.02*t)+" "+(Q.measure.em2px(-.489*t)-n)+","+Q.measure.em2px(-.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)})}},de.LowerGTGTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:.489*e+2*Q.measure.thickness,r:0,d:.147*e,u:0}}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.thickness,n=Q.measure.em2px(2*r);e.createSvgElement("path",{d:"M"+-n+",0 Q"+(Q.measure.em2px(-.222*t)-n)+","+Q.measure.em2px(.02*t)+" "+(Q.measure.em2px(-.489*t)-n)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)})}},de.GTGT2ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:.456*e+2*Q.measure.thickness,r:0,d:.229*e,u:.229*e}}getRadius(){return.213*Q.measure.oneem}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.thickness,n=e.createGroup(e.transformBuilder().rotateDegree(-10)),a=e.createGroup(e.transformBuilder().rotateDegree(10));n.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)}),a.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)});var i=e.createGroup(e.transformBuilder().translate(-2*r,0).rotateDegree(-10)),o=e.createGroup(e.transformBuilder().translate(-2*r,0).rotateDegree(10));i.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)}),o.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)})}},de.GTGT3ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:.507*e+2*Q.measure.thickness,r:0,d:.268*e,u:.268*e}}getRadius(){return.325*Q.measure.oneem}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.thickness,n=e.createGroup(e.transformBuilder().rotateDegree(-15)),a=e.createGroup(e.transformBuilder().rotateDegree(15));n.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)}),a.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)});var i=e.createGroup(e.transformBuilder().translate(-2*r,0).rotateDegree(-15)),o=e.createGroup(e.transformBuilder().translate(-2*r,0).rotateDegree(15));i.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)}),o.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("line",{x1:0,y1:0,x2:Q.measure.em2px(-.507*t-2*r),y2:0})}},de.LTLTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:0,r:.489*e+2*Q.measure.thickness,d:.147*e,u:.147*e}}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.thickness,n=Q.measure.em2px(2*r);e.createSvgElement("path",{d:"M"+n+",0 Q"+(Q.measure.em2px(.222*t)+n)+","+Q.measure.em2px(-.02*t)+" "+(Q.measure.em2px(.489*t)+n)+","+Q.measure.em2px(-.147*t)}),e.createSvgElement("path",{d:"M"+n+",0 Q"+(Q.measure.em2px(.222*t)+n)+","+Q.measure.em2px(.02*t)+" "+(Q.measure.em2px(.489*t)+n)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(-.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(.147*t)})}},de.UpperLTLTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:0,r:.489*e+2*Q.measure.thickness,d:0,u:.147*e}}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.thickness,n=Q.measure.em2px(2*r);e.createSvgElement("path",{d:"M"+n+",0 Q"+(Q.measure.em2px(.222*t)+n)+","+Q.measure.em2px(-.02*t)+" "+(Q.measure.em2px(.489*t)+n)+","+Q.measure.em2px(-.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(-.147*t)})}},de.LowerLTLTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:0,r:.489*e+2*Q.measure.thickness,d:.147*e,u:0}}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.thickness,n=Q.measure.em2px(2*r);e.createSvgElement("path",{d:"M"+n+",0 Q"+(Q.measure.em2px(.222*t)+n)+","+Q.measure.em2px(.02*t)+" "+(Q.measure.em2px(.489*t)+n)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(.147*t)})}},de.LTLT2ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:0,r:.456+e+2*Q.measure.thickness,d:.229*e,u:.229*e}}getRadius(){return.213*Q.measure.oneem}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.thickness,n=e.createGroup(e.transformBuilder().translate(2*r,0).rotateDegree(10)),a=e.createGroup(e.transformBuilder().translate(2*r,0).rotateDegree(-10));n.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(-.147*t)}),a.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(.147*t)});var i=e.createGroup(e.transformBuilder().rotateDegree(10)),o=e.createGroup(e.transformBuilder().rotateDegree(-10));i.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(-.147*t)}),o.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(.147*t)})}},de.LTLT3ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:0,r:.507*e+2*Q.measure.thickness,d:.268*e,u:.268*e}}getRadius(){return.325*Q.measure.oneem}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.thickness,n=e.createGroup(e.transformBuilder().translate(2*r,0).rotateDegree(15)),a=e.createGroup(e.transformBuilder().translate(2*r,0).rotateDegree(-15));n.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(-.147*t)}),a.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(.147*t)});var i=e.createGroup(e.transformBuilder().rotateDegree(15)),o=e.createGroup(e.transformBuilder().rotateDegree(-15));i.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(-.147*t)}),o.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("line",{x1:0,y1:0,x2:Q.measure.em2px(.507*t+2*r),y2:0})}},de.ColumnColumnArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:Q.measure.thickness,r:0,u:.5*Q.measure.lineElementLength,d:.5*Q.measure.lineElementLength}}drawDelegate(e){var t=Q.measure.thickness,r=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:r,x2:0,y2:-r}),e.createSvgElement("line",{x1:-Q.measure.em2px(t),y1:r,x2:-Q.measure.em2px(t),y2:-r})}},de.UpperColumnColumnArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:Q.measure.thickness,r:0,u:Q.measure.lineElementLength,d:0}}drawDelegate(e){var t=Q.measure.thickness,r=Q.measure.em2px(Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:0,x2:0,y2:-r}),e.createSvgElement("line",{x1:-Q.measure.em2px(t),y1:0,x2:-Q.measure.em2px(t),y2:-r})}},de.LowerColumnColumnArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:Q.measure.thickness,r:0,u:0,d:Q.measure.lineElementLength}}drawDelegate(e){var t=Q.measure.thickness,r=Q.measure.em2px(Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:0,x2:0,y2:r}),e.createSvgElement("line",{x1:-Q.measure.em2px(t),y1:0,x2:-Q.measure.em2px(t),y2:r})}},de.ColumnColumn2ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:Q.measure.thickness,r:0,u:.5*(Q.measure.lineElementLength+Q.measure.thickness),d:.5*(Q.measure.lineElementLength+Q.measure.thickness)}}drawDelegate(e){var t=Q.measure.thickness,r=Q.measure.em2px(.5*(Q.measure.lineElementLength+Q.measure.thickness));e.createSvgElement("line",{x1:0,y1:r,x2:0,y2:-r}),e.createSvgElement("line",{x1:-Q.measure.em2px(t),y1:r,x2:-Q.measure.em2px(t),y2:-r})}},de.ColumnColumn3ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:Q.measure.thickness,r:0,u:.5*Q.measure.lineElementLength+Q.measure.thickness,d:.5*Q.measure.lineElementLength+Q.measure.thickness}}drawDelegate(e){var t=Q.measure.thickness,r=Q.measure.em2px(.5*Q.measure.lineElementLength+Q.measure.thickness);e.createSvgElement("line",{x1:0,y1:r,x2:0,y2:-r}),e.createSvgElement("line",{x1:-Q.measure.em2px(t),y1:r,x2:-Q.measure.em2px(t),y2:-r})}},de.ColumnLineArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:Q.measure.lineElementLength,u:.5*Q.measure.lineElementLength,d:.5*Q.measure.lineElementLength}}drawDelegate(e){var t=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:t,x2:0,y2:-t});var r=Q.measure.em2px(Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:0,x2:r,y2:0})}},de.UpperColumnLineArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:Q.measure.lineElementLength,u:Q.measure.lineElementLength,d:0}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:0,x2:0,y2:-t});var r=Q.measure.em2px(Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:0,x2:r,y2:0})}},de.LowerColumnLineArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:Q.measure.lineElementLength,u:0,d:Q.measure.lineElementLength}}drawDelegate(e){Q.measure.thickness;var t=Q.measure.em2px(Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:0,x2:0,y2:t});var r=Q.measure.em2px(Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:0,x2:r,y2:0})}},de.ColumnLine2ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:Q.measure.lineElementLength,u:.5*(Q.measure.lineElementLength+Q.measure.thickness),d:.5*(Q.measure.lineElementLength+Q.measure.thickness)}}drawDelegate(e){var t=Q.measure.thickness,r=Q.measure.em2px(.5*(Q.measure.lineElementLength+Q.measure.thickness));e.createSvgElement("line",{x1:0,y1:-r,x2:0,y2:r});var n=Q.measure.em2px(.5*t),a=Q.measure.em2px(Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:n,x2:a,y2:n}),e.createSvgElement("line",{x1:0,y1:-n,x2:a,y2:-n})}},de.ColumnLine3ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:Q.measure.lineElementLength,u:.5*Q.measure.lineElementLength+Q.measure.thickness,d:.5*Q.measure.lineElementLength+Q.measure.thickness}}drawDelegate(e){var t=Q.measure.thickness,r=Q.measure.em2px(.5*Q.measure.lineElementLength+Q.measure.thickness);e.createSvgElement("line",{x1:0,y1:-r,x2:0,y2:r});var n=Q.measure.em2px(Q.measure.lineElementLength),a=Q.measure.em2px(t);e.createSvgElement("line",{x1:0,y1:a,x2:n,y2:a}),e.createSvgElement("line",{x1:0,y1:0,x2:n,y2:0}),e.createSvgElement("line",{x1:0,y1:-a,x2:n,y2:-a})}},de.GTColumnArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:.489*Q.measure.oneem,r:0,u:.5*Q.measure.lineElementLength,d:.5*Q.measure.lineElementLength}}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:r,x2:0,y2:-r}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)})}},de.GTGTColumnArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:.489*Q.measure.oneem+2*Q.measure.thickness,r:0,u:.5*Q.measure.lineElementLength,d:.5*Q.measure.lineElementLength}}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.thickness,n=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:n,x2:0,y2:-n});var a=Q.measure.em2px(2*r);e.createSvgElement("path",{d:"M"+-a+",0 Q"+(Q.measure.em2px(-.222*t)-a)+","+Q.measure.em2px(.02*t)+" "+(Q.measure.em2px(-.489*t)-a)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("path",{d:"M"+-a+",0 Q"+(Q.measure.em2px(-.222*t)-a)+","+Q.measure.em2px(-.02*t)+" "+(Q.measure.em2px(-.489*t)-a)+","+Q.measure.em2px(-.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)})}},de.ColumnLTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:.489*Q.measure.oneem,u:.5*Q.measure.lineElementLength,d:.5*Q.measure.lineElementLength}}drawDelegate(e){var t=Q.measure.oneem,r=(Q.measure.thickness,Q.measure.em2px(.5*Q.measure.lineElementLength));e.createSvgElement("line",{x1:0,y1:r,x2:0,y2:-r}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(-.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(.147*t)})}},de.ColumnLTLTArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){return{l:0,r:.489*Q.measure.oneem+2*Q.measure.thickness,u:.5*Q.measure.lineElementLength,d:.5*Q.measure.lineElementLength}}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.thickness,n=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:n,x2:0,y2:-n});var a=Q.measure.em2px(2*r);e.createSvgElement("path",{d:"M"+a+",0 Q"+(Q.measure.em2px(.222*t)+a)+","+Q.measure.em2px(-.02*t)+" "+(Q.measure.em2px(.489*t)+a)+","+Q.measure.em2px(-.147*t)}),e.createSvgElement("path",{d:"M"+a+",0 Q"+(Q.measure.em2px(.222*t)+a)+","+Q.measure.em2px(.02*t)+" "+(Q.measure.em2px(.489*t)+a)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(-.147*t)}),e.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(.489*t)+","+Q.measure.em2px(.147*t)})}},de.SlashSlashArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t-Math.PI/10,ce(this,"getBoundingBox")}getBox(){return{l:Q.measure.thickness,r:0,u:.5*Q.measure.lineElementLength,d:.5*Q.measure.lineElementLength}}drawDelegate(e){var t=Q.measure.em2px(Q.measure.thickness),r=Q.measure.em2px(.5*Q.measure.lineElementLength);e.createSvgElement("line",{x1:0,y1:r,x2:0,y2:-r}),e.createSvgElement("line",{x1:-t,y1:r,x2:-t,y2:-r})}},de.LineGT2ArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){var e=Q.measure.oneem;return{l:Q.measure.lineElementLength,r:Q.measure.lineElementLength,d:.229*e,u:.229*e}}getRadius(){return.213*Q.measure.oneem}drawDelegate(e){var t=Q.measure.oneem,r=Q.measure.lineElementLength,n=Q.measure.em2px(r),a=.5*Q.measure.thickness,i=Q.measure.em2px(a),o=this.getRadius(),s=Q.measure.em2px(Math.sqrt(o*o-a*a)),h=e.createGroup(e.transformBuilder().translate(r,0).rotateDegree(-10)),u=e.createGroup(e.transformBuilder().translate(r,0).rotateDegree(10));h.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(-.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(-.147*t)}),u.createSvgElement("path",{d:"M0,0 Q"+Q.measure.em2px(-.222*t)+","+Q.measure.em2px(.02*t)+" "+Q.measure.em2px(-.489*t)+","+Q.measure.em2px(.147*t)}),e.createSvgElement("path",{d:"M"+-n+","+i+" L"+(n-s)+","+i+" M"+-n+","+-i+" L"+(n-s)+","+-i})}},de.TwocellEqualityArrowheadShape=class extends de.ArrowheadShape{constructor(e,t){super(),this.c=e,this.angle=t,ce(this,"getBoundingBox")}getBox(){Q.measure.oneem;return{l:Q.measure.lineElementLength,r:Q.measure.lineElementLength,d:.5*Q.measure.thickness,u:.5*Q.measure.thickness}}drawDelegate(e){Q.measure.oneem;var t=Q.measure.em2px(Q.measure.lineElementLength),r=Q.measure.em2px(.5*Q.measure.thickness);e.createSvgElement("path",{d:"M"+-t+","+r+" L"+t+","+r+" M"+-t+","+-r+" L"+t+","+-r})}},de.LineShape=class extends de{constructor(e,t,r,n,a){super(),this.line=e,this.object=t,this.main=r,this.variant=n,this.bbox=a,this.holeRanges=w.empty}sliceHole(e){this.holeRanges=this.holeRanges.prepend(e)}draw(e){this.line.drawLine(e,this.object,this.main,this.variant,this.holeRanges)}getBoundingBox(){return this.bbox}toString(){return"LineShape[line:"+this.line+", object:"+this.object+", main:"+this.main+", variant:"+this.variant+"]"}},de.CurveShape=class extends de{constructor(e,t,r,n){super(),this.curve=e,this.objectForDrop=t,this.objectForConnect=r,this.bbox=n,this.holeRanges=w.empty}sliceHole(e){this.holeRanges=this.holeRanges.prepend(e)}draw(e){this.curve.drawCurve(e,this.objectForDrop,this.objectForConnect,this.holeRanges)}getBoundingBox(){return this.bbox}toString(){return"CurveShape[curve"+this.curve+", objectForDrop:"+(void 0!==this.objectForDrop?this.objectForDrop.toString():"null")+", objectForConnect:"+(void 0!==this.objectForConnect?this.objectForConnect.toString():"null")+"]"}};class xe{constructor(e,t){this.shape=e,this.env=t}duplicateEnv(){var e=this.env.duplicate();return new xe(this.shape,e)}appendShapeToFront(e){e.isNone||(this.shape.isNone?this.shape=e:this.shape=new de.CompositeShape(e,this.shape))}appendShapeToBack(e){e.isNone||(this.shape.isNone?this.shape=e:this.shape=new de.CompositeShape(this.shape,e))}}class ge{constructor(){var e=Q.measure.length2em("1mm");this.origin={x:0,y:0},this.xBase={x:e,y:0},this.yBase={x:0,y:e},this.savedPosition={},this.stateStack=w.empty,this.stackFrames=w.empty,this.stack=w.empty,this.angle=0,this.lastCurve=ve.none,this.p=this.c=ge.originPosition,this.shouldCapturePos=!1,this.capturedPositions=w.empty,this.objectmargin=Q.measure.objectmargin,this.objectheight=Q.measure.objectheight,this.objectwidth=Q.measure.objectwidth,this.labelmargin=Q.measure.labelmargin}duplicate(){var e=new ge;return ge.copyFields(this,e),e}saveState(){var e=this.duplicate();this.stateStack=this.stateStack.prepend(e)}restoreState(){if(!this.stateStack.isEmpty){var e=this.stateStack.head;this.stateStack=this.stateStack.tail,ge.copyFields(e,this)}}absVector(e,t){return{x:this.origin.x+e*this.xBase.x+t*this.yBase.x,y:this.origin.y+e*this.xBase.y+t*this.yBase.y}}inverseAbsVector(e,t){var r=this.xBase.x,n=this.xBase.y,a=this.yBase.x,i=this.yBase.y,o=r*i-n*a,s=e-this.origin.x,h=t-this.origin.y;return{x:(i*s-a*h)/o,y:(-n*s+r*h)/o}}setOrigin(e,t){this.origin={x:e,y:t}}setXBase(e,t){this.xBase={x:e,y:t}}setYBase(e,t){this.yBase={x:e,y:t}}swapPAndC(){var e=this.p;this.p=this.c,this.c=e}enterStackFrame(){this.stackFrames=this.stackFrames.prepend(this.stack),this.initStack()}leaveStackFrame(){this.stackFrames.isEmpty?this.initStack():(this.stack=this.stackFrames.head,this.stackFrames=this.stackFrames.tail)}savePos(e,t){this.savedPosition[e]=t}startCapturePositions(){this.shouldCapturePos=!0,this.capturedPositions=w.empty}endCapturePositions(){this.shouldCapturePos=!1;var e=this.capturedPositions;return this.capturedPositions=w.empty,e}capturePosition(e){this.shouldCapturePos&&void 0!==e&&(this.capturedPositions=this.capturedPositions.prepend(e))}pushPos(e){void 0!==e&&(this.stack=this.stack.prepend(e))}popPos(){if(this.stack.isEmpty)throw d("ExecutionError","cannot pop from the empty stack");var e=this.stack.head;return this.stack=this.stack.tail,e}initStack(){this.stack=w.empty}setStack(e){this.stack=e}stackAt(e){return this.stack.at(e)}lookupPos(e,t){var r=this.savedPosition[e];if(void 0===r)throw d("ExecutionError",void 0!==t?t:'<pos> "'+e+'" not defined.');return r}toString(){var e="";for(var t in this.savedPosition)this.savedPosition.hasOwnProperty(t)&&(e.length>0&&(e+=", "),e+=t.toString()+":"+this.savedPosition[t]);return"Env\n  p:"+this.p+"\n  c:"+this.c+"\n  angle:"+this.angle+"\n  lastCurve:"+this.lastCurve+"\n  savedPosition:{"+e+"}\n  origin:{x:"+this.origin.x+", y:"+this.origin.y+"}\n  xBase:{x:"+this.xBase.x+", y:"+this.xBase.y+"}\n  yBase:{x:"+this.yBase.x+", y:"+this.yBase.y+"}\n  stackFrames:"+this.stackFrames+"\n  stack:"+this.stack+"\n  shouldCapturePos:"+this.shouldCapturePos+"\n  capturedPositions:"+this.capturedPositions}static copyFields(e,t){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);for(var n in t.savedPosition={},e.savedPosition)e.savedPosition.hasOwnProperty(n)&&(t.savedPosition[n]=e.savedPosition[n])}}ge.originPosition=new le.Point(0,0);class fe{constructor(){}velocity(e){var t=this.dpx(e),r=this.dpy(e);return Math.sqrt(t*t+r*r)}length(e){if(e<0||e>1)throw d("ExecutionError","illegal cubic Bezier parameter t:"+e);this.buildLengthArray();var t=e*oe.lengthResolution,r=Math.floor(t),n=Math.ceil(t);if(r===n)return this.lengthArray[r];var a=this.lengthArray[r];return a+(this.lengthArray[n]-a)/(n-r)*(t-r)}tOfLength(e){this.buildLengthArray();var t,r,n,a=this.lengthArray;if(e<a[0])return 0;if(e>a[a.length-1])return 1;for(var i=0,o=a.length-2;i<=o&&(r=a[t=i+o>>1],n=a[t+1],!(e>=r&&e<=n));)e<r?o=t-1:i=t+1;var s=oe.lengthResolution;return r===n?t/s:(t+(e-r)/(n-r))/s}tOfShavedStart(e){if(e.isPoint())return 0;var t=this.tOfIntersections(e);return 0!=t.length?Math.min.apply(Math,t):void 0}tOfShavedEnd(e){if(e.isPoint())return 1;var t=this.tOfIntersections(e);return 0!=t.length?Math.max.apply(Math,t):void 0}shaveStart(e){if(e.isPoint())return this;var t=this.tOfIntersections(e);if(0!=t.length){var r=Math.min.apply(Math,t);return this.divide(r)[1]}}shaveEnd(e){if(e.isPoint())return this;var t=this.tOfIntersections(e);if(0!=t.length){var r=Math.max.apply(Math,t);return this.divide(r)[0]}}buildLengthArray(){if(void 0===this.lengthArray){var e=oe.lengthResolution,t=new Array(e+1),r=0,n=.5/e,a=0,i=n/3;t[0]=0,r=this.velocity(0)+4*this.velocity(n);var o=this.velocity(2*n);for(t[1]=i*(r+o),a=2;a<=e;a++)r+=2*o+4*this.velocity((2*a-1)*n),o=this.velocity(2*a*n),t[a]=i*(r+o);this.lengthArray=t}}drawParallelCurve(e,t){var r,n,a,i,o,s,h,u,c=this.countOfSegments()*oe.interpolationResolution,m=new Array(c+1),p=new Array(c+1),l=new Array(c+1),d=new Array(c+1),x=new Array(c+1),g=Math.PI/2,f=t;for(r=0;r<=c;r++)n=r/c,m[r]=n,a=this.angle(n),o=(i=this.position(n)).x,s=i.y,h=f*Math.cos(a+g),u=f*Math.sin(a+g),p[r]=o+h,l[r]=s+u,d[r]=o-h,x[r]=s-u;fe.CubicBeziers.interpolation(m,p,l).drawPrimitive(e,"none"),fe.CubicBeziers.interpolation(m,d,x).drawPrimitive(e,"none")}drawParallelDottedCurve(e,t,r){var n=1/Q.measure.em,a=n/2,i=n+t,o=this.length(1),s=Math.floor((o-n)/i),h=r;if(s>=0){var u,c=Math.PI/2,m=this.startPosition();this.endPosition();for(u=0;u<=s;u++){m=a+u*i;var p=this.tOfLength(m),l=this.angle(p),d=this.position(p),x=d.x,g=d.y,f=h*Math.cos(l+c),w=h*Math.sin(l+c);e.createSvgElement("circle",{cx:Q.measure.em2px(x+f),cy:-Q.measure.em2px(g+w),r:.12,fill:"currentColor"}),e.createSvgElement("circle",{cx:Q.measure.em2px(x-f),cy:-Q.measure.em2px(g-w),r:.12,fill:"currentColor"})}}}drawParallelDashedCurve(e,t,r){var n,a,i,o,s,h,u,c,m=this.length(1),p=Math.floor((m-t)/(2*t)),l=2*p+1,d=(m-t)/2-p*t,x=new Array(p+1),g=new Array(p+1),f=new Array(p+1),w=new Array(p+1),v=new Array(p+1),S=Math.PI/2,y=r;for(n=0;n<=l;n++)a=this.tOfLength(d+n*t),x[n]=a,i=this.angle(a),s=(o=this.position(a)).x,h=o.y,u=y*Math.cos(i+S),c=y*Math.sin(i+S),g[n]=s+u,f[n]=h+c,w[n]=s-u,v[n]=h-c;fe.CubicBeziers.interpolation(x,g,f).drawSkipped(e),fe.CubicBeziers.interpolation(x,w,v).drawSkipped(e)}drawSquigCurve(e,t){var r=Q.measure.length2em("0.15em"),n=this.length(1),a=4*r,i=r;if(n>=a){var o,s,h,u,c,m,p,l,d,x=Math.floor(n/a),g=(n-x*a)/2,f=Math.PI/2;switch(t){case"3":o=g,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p="M"+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),l="M"+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),d="M"+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m);for(var w=0;w<x;w++)o=g+a*w+r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" Q"+Q.measure.em2px(h.x+2*c)+","+Q.measure.em2px(-h.y-2*m),l+=" Q"+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),d+=" Q"+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),o=g+a*w+2*r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" "+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),l+=" "+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),d+=" "+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m),o=g+a*w+3*r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" Q"+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),l+=" Q"+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m),d+=" "+Q.measure.em2px(h.x-2*c)+","+Q.measure.em2px(-h.y+2*m),o=g+a*(w+1),s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" "+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),l+=" "+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),d+=" "+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m);e.createSvgElement("path",{d:p}),e.createSvgElement("path",{d:l}),e.createSvgElement("path",{d});break;case"2":o=g,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f)/2,m=i*Math.sin(u+f)/2,p="M"+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),l="M"+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m);for(w=0;w<x;w++)o=g+a*w+r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f)/2,m=i*Math.sin(u+f)/2,p+=" Q"+Q.measure.em2px(h.x+3*c)+","+Q.measure.em2px(-h.y-3*m),l+=" Q"+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),o=g+a*w+2*r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f)/2,m=i*Math.sin(u+f)/2,p+=" "+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),l+=" "+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m),o=g+a*w+3*r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f)/2,m=i*Math.sin(u+f)/2,p+=" Q"+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m),l+=" Q"+Q.measure.em2px(h.x-3*c)+","+Q.measure.em2px(-h.y+3*m),o=g+a*(w+1),s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f)/2,m=i*Math.sin(u+f)/2,p+=" "+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),l+=" "+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m);e.createSvgElement("path",{d:p}),e.createSvgElement("path",{d:l});break;default:o=g,s=this.tOfLength(o),h=this.position(s),p="M"+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y);for(w=0;w<x;w++)o=g+a*w+r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" Q"+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),o=g+a*w+2*r,s=this.tOfLength(o),h=this.position(s),p+=" "+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),o=g+a*w+3*r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" Q"+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m),o=g+a*(w+1),s=this.tOfLength(o),h=this.position(s),p+=" "+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y);e.createSvgElement("path",{d:p})}}}drawDashSquigCurve(e,t){var r=Q.measure.thickness,n=this.length(1),a=4*r,i=r;if(n>=a){var o,s,h,u,c,m,p,l,d,x=Math.floor((n-a)/2/a),g=(n-a)/2-x*a,f=Math.PI/2;switch(t){case"3":p=l=d="";for(var w=0;w<=x;w++)o=g+a*w*2,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" M"+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),l+=" M"+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),d+=" M"+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m),o=g+a*w*2+r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" Q"+Q.measure.em2px(h.x+2*c)+","+Q.measure.em2px(-h.y-2*m),l+=" Q"+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),d+=" Q"+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),o=g+a*w*2+2*r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" "+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),l+=" "+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),d+=" "+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m),o=g+a*w*2+3*r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" Q"+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),l+=" Q"+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m),d+=" "+Q.measure.em2px(h.x-2*c)+","+Q.measure.em2px(-h.y+2*m),o=g+a*(2*w+1),s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" "+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),l+=" "+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),d+=" "+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m);e.createSvgElement("path",{d:p}),e.createSvgElement("path",{d:l}),e.createSvgElement("path",{d});break;case"2":p=l="";for(w=0;w<=x;w++)o=g+a*w*2,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f)/2,m=i*Math.sin(u+f)/2,p+=" M"+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),l+=" M"+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m),o=g+a*w*2+r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f)/2,m=i*Math.sin(u+f)/2,p+=" Q"+Q.measure.em2px(h.x+3*c)+","+Q.measure.em2px(-h.y-3*m),l+=" Q"+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),o=g+a*w*2+2*r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f)/2,m=i*Math.sin(u+f)/2,p+=" "+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),l+=" "+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m),o=g+a*w*2+3*r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f)/2,m=i*Math.sin(u+f)/2,p+=" Q"+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m),l+=" Q"+Q.measure.em2px(h.x-3*c)+","+Q.measure.em2px(-h.y+3*m),o=g+a*(2*w+1),s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f)/2,m=i*Math.sin(u+f)/2,p+=" "+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),l+=" "+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m);e.createSvgElement("path",{d:p}),e.createSvgElement("path",{d:l});break;default:p="";for(w=0;w<=x;w++)o=g+a*w*2,s=this.tOfLength(o),h=this.position(s),p+=" M"+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),o=g+a*w*2+r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" Q"+Q.measure.em2px(h.x+c)+","+Q.measure.em2px(-h.y-m),o=g+a*w*2+2*r,s=this.tOfLength(o),h=this.position(s),p+=" "+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),o=g+a*w*2+3*r,s=this.tOfLength(o),h=this.position(s),u=this.angle(s),c=i*Math.cos(u+f),m=i*Math.sin(u+f),p+=" Q"+Q.measure.em2px(h.x-c)+","+Q.measure.em2px(-h.y+m),o=g+a*(2*w+1),s=this.tOfLength(o),h=this.position(s),p+=" "+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y);e.createSvgElement("path",{d:p})}}}drawCurve(e,t,r,n){if(n.isEmpty)this._drawCurve(e,t,r);else{var a=new pe(0,1).differenceRanges(n),i=this;a.foreach(function(n){i.slice(n.start,n.end)._drawCurve(e,t,r)})}}_drawCurve(e,t,r){var n,a=Q.measure.length2em("0.15em");if(void 0!==r){var i=r.dirMain(),o=r.dirVariant();switch(i){case"=":i="-",o="2";break;case"==":i="--",o="2";break;case":":case"::":i=".",o="2"}switch(i){case"":break;case"-":switch(o){case"2":n=a/2,this.drawParallelCurve(e,n);break;case"3":n=a,this.drawParallelCurve(e,n),this.drawPrimitive(e,"none");break;default:n=0,this.drawPrimitive(e,"none")}break;case".":case"..":switch(o){case"2":n=a/2,this.drawParallelDottedCurve(e,a,n);break;case"3":n=a,this.drawParallelDottedCurve(e,a,n),this.drawPrimitive(e,Q.measure.dottedDasharray);break;default:n=0,this.drawPrimitive(e,Q.measure.dottedDasharray)}break;case"--":var s=3*a;if((w=this.length(1))>=s)switch(o){case"2":n=a/2,this.drawParallelDashedCurve(e,s,n);break;case"3":n=a,this.drawParallelDashedCurve(e,s,n);var h=(w-s)/2-Math.floor((w-s)/2/s)*s,u=this.tOfLength(h);this.divide(u)[1].drawPrimitive(e,Q.measure.em2px(s)+" "+Q.measure.em2px(s));break;default:n=0;h=(w-s)/2-Math.floor((w-s)/2/s)*s,u=this.tOfLength(h);this.divide(u)[1].drawPrimitive(e,Q.measure.em2px(s)+" "+Q.measure.em2px(s))}break;case"~":switch(this.drawSquigCurve(e,o),o){case"2":n=1.5*a;break;case"3":n=2*a;break;default:n=0}break;case"~~":switch(this.drawDashSquigCurve(e,o),o){case"2":n=1.5*a;break;case"3":n=2*a;break;default:n=0}break;default:(S=new ge).c=ge.originPosition;var c=new xe(de.none,S),m=r.boundingBox(c);if(null==m)return;var p,l,d=m.l,x=d+m.r;if(void 0!==t){var g=t.boundingBox(c);void 0!==g&&(p=(l=g.l)+g.r)}else p=0;var f=x+p;0==f&&(f=Q.measure.strokeWidth);var w=this.length(1);if(0==(P=Math.floor(w/f)))return;h=(w-P*f)/2,c=new xe(de.none,S);for(var v=0;v<P;v++){B=h+v*f,void 0!==t&&(A=this.tOfLength(B+l),S.c=this.position(A),S.angle=this.angle(A),t.toDropShape(c).draw(e)),A=this.tOfLength(B+p+d),S.c=this.position(A),S.angle=this.angle(A);r.toDropShape(c).draw(e)}}}else{var S;(S=new ge).c=ge.originPosition;c=new xe(de.none,S);var y=t,C=y.boundingBox(c);if(void 0===C)return;var b=C.l+C.r,M=b;0==M&&(M=Q.measure.strokeWidth);var P;w=this.length(1);if(0==(P=Math.floor(w/M)))return;for(h=(w-P*M+M-b)/2+C.l,c=new xe(de.none,S),v=0;v<P;v++){var B=h+v*M,A=this.tOfLength(B);S.c=this.position(A),S.angle=0,y.toDropShape(c).draw(e)}}}toShape(e,t,r){var n,a=e.env,i=Q.measure.length2em("0.15em"),o=de.none;if(void 0!==r){var s=r.dirMain(),h=r.dirVariant();switch(s){case"=":s="-",h="2";break;case"==":s="--",h="2";break;case":":case"::":s=".",h="2"}switch(s){case"":n=0;break;case"-":case".":case"..":switch(h){case"2":n=i/2;break;case"3":n=i;break;default:n=0}break;case"--":var u=3*i;if((x=this.length(1))>=u)switch(h){case"2":n=i/2;break;case"3":n=i;break;default:n=0}break;case"~":case"~~":switch(h){case"2":n=1.5*i;break;case"3":n=2*i;break;default:n=0}break;default:var c=r.boundingBox(e);if(null==c)return a.angle=0,a.lastCurve=ve.none,de.none;n=Math.max(c.u,c.d);var m,p=c.l+c.r;if(void 0!==t){var l=t.boundingBox(e);void 0!==l&&(m=l.l+l.r,n=Math.max(n,l.u,l.d))}else m=0;var d=p+m;0==d&&(d=Q.measure.strokeWidth);var x=this.length(1);return 0==Math.floor(x/d)?(a.angle=0,a.lastCurve=ve.none,de.none):(o=new de.CurveShape(this,t,r,this.boundingBox(n)),e.appendShapeToFront(o),o)}return void 0===n?de.none:(o=new de.CurveShape(this,t,r,this.boundingBox(n)),e.appendShapeToFront(o),o)}if(void 0!==t){var g=t.boundingBox(e);if(null==g)return a.angle=0,a.lastCurve=ve.none,de.none;var f=g.l+g.r;0==f&&(f=Q.measure.strokeWidth);x=this.length(1);return 0==Math.floor(x/f)?(a.angle=0,a.lastCurve=ve.none,de.none):(n=Math.max(g.u,g.d),o=new de.CurveShape(this,t,r,this.boundingBox(n)),e.appendShapeToFront(o),o)}return o}static sign(e){return e>0?1:0===e?0:-1}static solutionsOfCubicEq(e,t,r,n){if(0===e)return fe.solutionsOfQuadEq(t,r,n);var a=t/3/e,i=r/e,o=a*a-i/3,s=-(n/e)/2+i*a/2-a*a*a,h=s*s-o*o*o;if(0===h){var u=2*(d=Math.pow(s,1/3))-a,c=-d-a;return fe.filterByIn0to1([u,c])}if(h>0){var m=s+fe.sign(s)*Math.sqrt(h),p=(l=fe.sign(m)*Math.pow(Math.abs(m),1/3))+(d=o/l)-a;return fe.filterByIn0to1([p])}var l=2*Math.sqrt(o),d=Math.acos(2*s/o/l),x=(u=l*Math.cos(d/3)-a,c=l*Math.cos((d+2*Math.PI)/3)-a,l*Math.cos((d+4*Math.PI)/3)-a);return fe.filterByIn0to1([u,c,x])}static solutionsOfQuadEq(e,t,r){if(0===e)return fe.solutionsOfLinearEq(t,r);var n=t*t-4*r*e;if(n>=0){var a=Math.sqrt(n),i=(-t+a)/2/e,o=(-t-a)/2/e;return fe.filterByIn0to1([i,o])}return[]}static solutionsOfLinearEq(e,t){return 0===e?0===t?0:[]:fe.filterByIn0to1([-t/e])}static filterByIn0to1(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];n>=0&&n<=1&&t.push(n)}return t}}fe.QuadBezier=class extends fe{constructor(e,t,r){super(),this.cp0=e,this.cp1=t,this.cp2=r;var n=e.x,a=2*(t.x-e.x),i=r.x-2*t.x+e.x;this.px=function(e){return n+e*a+e*e*i},this.dpx=function(e){return a+2*e*i};var o=e.y,s=2*(t.y-e.y),h=r.y-2*t.y+e.y;this.py=function(e){return o+e*s+e*e*h},this.dpy=function(e){return s+2*e*h}}startPosition(){return this.cp0}endPosition(){return this.cp2}position(e){return new le.Point(this.px(e),this.py(e))}derivative(e){return new le.Point(this.dpx(e),this.dpy(e))}angle(e){return Math.atan2(this.dpy(e),this.dpx(e))}boundingBox(e){var t=this.maxMin(this.cp0.x,this.cp1.x,this.cp2.x,e),r=this.maxMin(this.cp0.y,this.cp1.y,this.cp2.y,e);if(0===e)return new le.Rect(this.cp0.x,this.cp0.y,{l:this.cp0.x-t.min,r:t.max-this.cp0.x,u:r.max-this.cp0.y,d:this.cp0.y-r.min});var n=Math.PI/2,a=this.cp0.x,i=this.cp0.y,o=this.cp2.x,s=this.cp2.y,h=this.angle(0)+n,u=this.angle(1)+n,c=e*Math.cos(h),m=e*Math.sin(h),p=e*Math.cos(u),l=e*Math.sin(u),d=Math.min(t.min,a+c,a-c,o+p,o-p),x=Math.max(t.max,a+c,a-c,o+p,o-p),g=Math.min(r.min,i+m,i-m,s+l,s-l),f=Math.max(r.max,i+m,i-m,s+l,s-l);return new le.Rect(a,i,{l:a-d,r:x-a,u:f-i,d:i-g})}maxMin(e,t,r,n){var a,i;e>r?(a=e,i=r):(a=r,i=e);var o,s,h=ue,u=h(e),c=h(t-e),m=h(r-2*t+e);return 0!=m&&(s=-c/m)>0&&s<1&&(o=function(e){return u+2*e*c+e*e*m}(s),a=Math.max(a,o+n,o-n),i=Math.min(i,o+n,o-n)),{min:i,max:a}}divide(e){if(e<0||e>1)throw d("ExecutionError","illegal quadratic Bezier parameter t:"+e);var t=this.cp0.x,r=this.cp1.x,n=this.cp2.x,a=this.cp0.y,i=this.cp1.y,o=this.cp2.y,s=this.px(e),h=this.py(e),u=this.cp0,c=new le.Point(t+e*(r-t),a+e*(i-a)),m=new le.Point(s,h),p=m,l=new le.Point(r+e*(n-r),i+e*(o-i)),x=this.cp2;return[new fe.QuadBezier(u,c,m),new fe.QuadBezier(p,l,x)]}slice(e,t){if(!(e>=t)){if(e<0&&(e=0),t>1&&(t=1),0===e&&1===t)return this;this.cp0.x;var r=this.cp1.x,n=this.cp2.x,a=(this.cp0.y,this.cp1.y),i=this.cp2.y,o=this.px(e),s=this.py(e),h=r+e*(n-r),u=a+e*(i-a),c=new le.Point(o,s),m=new le.Point(o+t*(h-o),s+t*(u-s)),p=new le.Point(this.px(t),this.py(t));return new fe.QuadBezier(c,m,p)}}tOfIntersections(e){if(e.isPoint())return[];if(e.isRect()){var t,r=e.x+e.r,n=e.x-e.l,a=e.y+e.u,i=e.y-e.d,o=ue,s=this.cp0.x,h=this.cp1.x,u=this.cp2.x,c=o(s),m=o(2*(h-s)),p=o(u-2*h+s),l=function(e){return c+e*m+e*e*p},d=this.cp0.y,x=this.cp1.y,g=this.cp2.y,f=o(d),w=o(2*(x-d)),v=o(g-2*x+d),S=function(e){return f+e*w+e*e*v},y=[];t=(t=fe.solutionsOfQuadEq(p,m,c-r)).concat(fe.solutionsOfQuadEq(p,m,c-n));for(var C=0;C<t.length;C++){(P=S(W=t[C]))>=i&&P<=a&&y.push(W)}t=(t=fe.solutionsOfQuadEq(v,w,f-a)).concat(fe.solutionsOfQuadEq(v,w,f-i));for(C=0;C<t.length;C++){(M=l(W=t[C]))>=n&&M<=r&&y.push(W)}return y}if(e.isCircle()){var b=Math.PI,M=e.x,P=e.y,B=e.l,A=e.r,L=e.u,E=e.d,O=M+(A-B)/2,k=P+(L-E)/2,D=(r=(B+A)/2,(L+E)/2),j=b/180,T=new we.Arc(O,k,r,D,-b-j,-b/2+j),R=new we.Arc(O,k,r,D,-b/2-j,0+j),F=new we.Arc(O,k,r,D,0-j,b/2+j),I=new we.Arc(O,k,r,D,b/2-j,b+j),z=new we.QuadBezier(this,0,1),Q=[];Q=(Q=(Q=(Q=Q.concat(we.findIntersections(T,z))).concat(we.findIntersections(R,z))).concat(we.findIntersections(F,z))).concat(we.findIntersections(I,z));for(y=[],C=0;C<Q.length;C++){var W=(Q[C][1].min+Q[C][1].max)/2;y.push(W)}return y}}countOfSegments(){return 1}drawPrimitive(e,t){var r=this.cp0,n=this.cp1,a=this.cp2;e.createSvgElement("path",{d:"M"+Q.measure.em2px(r.x)+","+Q.measure.em2px(-r.y)+" Q"+Q.measure.em2px(n.x)+","+Q.measure.em2px(-n.y)+" "+Q.measure.em2px(a.x)+","+Q.measure.em2px(-a.y),"stroke-dasharray":t})}toString(){return"QuadBezier("+this.cp0.x+", "+this.cp0.y+")-("+this.cp1.x+", "+this.cp1.y+")-("+this.cp2.x+", "+this.cp2.y+")"}},fe.CubicBezier=class extends fe{constructor(e,t,r,n){super(),this.cp0=e,this.cp1=t,this.cp2=r,this.cp3=n;var a=e.x,i=3*(t.x-e.x),o=3*(r.x-2*t.x+e.x),s=n.x-3*r.x+3*t.x-e.x;this.px=function(e){return a+e*i+e*e*o+e*e*e*s},this.dpx=function(e){return i+2*e*o+3*e*e*s};var h=e.y,u=3*(t.y-e.y),c=3*(r.y-2*t.y+e.y),m=n.y-3*r.y+3*t.y-e.y;this.py=function(e){return h+e*u+e*e*c+e*e*e*m},this.dpy=function(e){return u+2*e*c+3*e*e*m}}startPosition(){return this.cp0}endPosition(){return this.cp3}position(e){return new le.Point(this.px(e),this.py(e))}derivative(e){return new le.Point(this.dpx(e),this.dpy(e))}angle(e){return Math.atan2(this.dpy(e),this.dpx(e))}boundingBox(e){var t=this.maxMin(this.cp0.x,this.cp1.x,this.cp2.x,this.cp3.x,e),r=this.maxMin(this.cp0.y,this.cp1.y,this.cp2.y,this.cp3.y,e);if(0===e)return new le.Rect(this.cp0.x,this.cp0.y,{l:this.cp0.x-t.min,r:t.max-this.cp0.x,u:r.max-this.cp0.y,d:this.cp0.y-r.min});var n=Math.PI/2,a=this.cp0.x,i=this.cp0.y,o=this.cp3.x,s=this.cp3.y,h=this.angle(0)+n,u=this.angle(1)+n,c=e*Math.cos(h),m=e*Math.sin(h),p=e*Math.cos(u),l=e*Math.sin(u),d=Math.min(t.min,a+c,a-c,o+p,o-p),x=Math.max(t.max,a+c,a-c,o+p,o-p),g=Math.min(r.min,i+m,i-m,s+l,s-l),f=Math.max(r.max,i+m,i-m,s+l,s-l);return new le.Rect(a,i,{l:a-d,r:x-a,u:f-i,d:i-g})}maxMin(e,t,r,n,a){var i,o;e>n?(i=e,o=n):(i=n,o=e);var s,h=ue,u=h(e),c=h(t-e),m=h(r-2*t+e),p=h(n-3*r+3*t-e),l=function(e){e>0&&e<1&&(s=function(e){return u+3*e*c+3*e*e*m+e*e*e*p}(e),i=Math.max(i,s+a,s-a),o=Math.min(o,s+a,s-a))};if(0==p)0!=m&&l(-c/m/2);else{var d=m*m-c*p;d>0?(l((-m+Math.sqrt(d))/p),l((-m-Math.sqrt(d))/p)):0==d&&l(-m/p)}return{min:o,max:i}}divide(e){if(e<0||e>1)throw d("ExecutionError","illegal cubic Bezier parameter t:"+e);var t=this.cp0.x,r=this.cp1.x,n=this.cp2.x,a=this.cp3.x,i=this.cp0.y,o=this.cp1.y,s=this.cp2.y,h=this.cp3.y,u=this.px(e),c=this.py(e),m=this.cp0,p=new le.Point(t+e*(r-t),i+e*(o-i)),l=new le.Point(t+2*e*(r-t)+e*e*(n-2*r+t),i+2*e*(o-i)+e*e*(s-2*o+i)),x=new le.Point(u,c),g=x,f=new le.Point(r+2*e*(n-r)+e*e*(a-2*n+r),o+2*e*(s-o)+e*e*(h-2*s+o)),w=new le.Point(n+e*(a-n),s+e*(h-s)),v=this.cp3;return[new fe.CubicBezier(m,p,l,x),new fe.CubicBezier(g,f,w,v)]}slice(e,t){if(!(e>=t)){if(e<0&&(e=0),t>1&&(t=1),0===e&&1===t)return this;this.cp0.x;var r=this.cp1.x,n=this.cp2.x,a=this.cp3.x,i=(this.cp0.y,this.cp1.y),o=this.cp2.y,s=this.cp3.y,h=this.px(e),u=this.py(e),c=r+2*e*(n-r)+e*e*(a-2*n+r),m=i+2*e*(o-i)+e*e*(s-2*o+i),p=n+e*(a-n),l=o+e*(s-o),d=new le.Point(h,u),x=new le.Point(h+t*(c-h),u+t*(m-u)),g=new le.Point(h+2*t*(c-h)+t*t*(p-2*c+h),u+2*t*(m-u)+t*t*(l-2*m+u)),f=new le.Point(this.px(t),this.py(t));return new fe.CubicBezier(d,x,g,f)}}tOfIntersections(e){if(e.isPoint())return[];if(e.isRect()){var t,r=e.x+e.r,n=e.x-e.l,a=e.y+e.u,i=e.y-e.d,o=ue,s=this.cp0.x,h=this.cp1.x,u=this.cp2.x,c=this.cp3.x,m=this.cp0.y,p=this.cp1.y,l=this.cp2.y,d=this.cp3.y,x=o(s),g=o(3*(h-s)),f=o(3*(u-2*h+s)),w=o(c-3*u+3*h-s),v=function(e){return x+e*g+e*e*f+e*e*e*w},S=o(m),y=o(3*(p-m)),C=o(3*(l-2*p+m)),b=o(d-3*l+3*p-m),M=function(e){return S+e*y+e*e*C+e*e*e*b},P=[];t=(t=fe.solutionsOfCubicEq(w,f,g,x-r)).concat(fe.solutionsOfCubicEq(w,f,g,x-n));for(var B=0;B<t.length;B++){(E=M(G=t[B]))>=i&&E<=a&&P.push(G)}t=(t=fe.solutionsOfCubicEq(b,C,y,S-a)).concat(fe.solutionsOfCubicEq(b,C,y,S-i));for(B=0;B<t.length;B++){(L=v(G=t[B]))>=n&&L<=r&&P.push(G)}return P}if(e.isCircle()){var A=Math.PI,L=e.x,E=e.y,O=e.l,k=e.r,D=e.u,j=e.d,T=L+(k-O)/2,R=E+(D-j)/2,F=(r=(O+k)/2,(D+j)/2),I=A/180,z=new we.Arc(T,R,r,F,-A-I,-A/2+I),Q=new we.Arc(T,R,r,F,-A/2-I,0+I),W=new we.Arc(T,R,r,F,0-I,A/2+I),N=new we.Arc(T,R,r,F,A/2-I,A+I),_=new we.CubicBezier(this,0,1),U=[];U=(U=(U=(U=U.concat(we.findIntersections(z,_))).concat(we.findIntersections(Q,_))).concat(we.findIntersections(W,_))).concat(we.findIntersections(N,_));for(P=[],B=0;B<U.length;B++){var G=(U[B][1].min+U[B][1].max)/2;P.push(G)}return P}}countOfSegments(){return 1}drawPrimitive(e,t){var r=this.cp0,n=this.cp1,a=this.cp2,i=this.cp3;e.createSvgElement("path",{d:"M"+Q.measure.em2px(r.x)+","+Q.measure.em2px(-r.y)+" C"+Q.measure.em2px(n.x)+","+Q.measure.em2px(-n.y)+" "+Q.measure.em2px(a.x)+","+Q.measure.em2px(-a.y)+" "+Q.measure.em2px(i.x)+","+Q.measure.em2px(-i.y),"stroke-dasharray":t})}toString(){return"CubicBezier("+this.cp0.x+", "+this.cp0.y+")-("+this.cp1.x+", "+this.cp1.y+")-("+this.cp2.x+", "+this.cp2.y+")-("+this.cp3.x+", "+this.cp3.y+")"}},fe.CubicBeziers=class extends fe{constructor(e){super(),this.cbs=e;var t=this.cbs.length;this.delegate=0==t?function(e,t,r){return r}:function(r,n,a){var i=r*t,o=Math.floor(i);o<0&&(o=0),o>=t&&(o=t-1);var s=i-o;return n(e[o],s)}}startPosition(){return this.cbs[0].cp0}endPosition(){return this.cbs[this.cbs.length-1].cp3}position(e){return this.delegate(e,function(e,t){return e.position(t)},void 0)}derivative(e){return this.delegate(e,function(e,t){return e.derivative(t)},void 0)}angle(e){return this.delegate(e,function(e,t){return e.angle(t)},0)}velocity(e){var t=this.cbs.length;return this.delegate(e,function(e,r){return t*e.velocity(r)},0)}boundingBox(e){if(0!=this.cbs.length){var t,r=this.cbs[0].boundingBox(e),n=this.cbs.length;for(t=1;t<n;t++)r=r.combineRect(this.cbs[t].boundingBox(e));return r}}tOfIntersections(e){var t=[],r=0,n=this.cbs.length;for(r=0;r<n;r++)for(var a=this.cbs[r].tOfIntersections(e),i=0;i<a.length;i++)t.push((a[i]+r)/n);return t}divide(e){if(e<0||e>1)throw d("ExecutionError","illegal cubic Bezier parameter t:"+e);if(0===e)return[new fe.CubicBeziers([]),this];if(1===e)return[this,new fe.CubicBeziers([])];var t=this.cbs.length,r=e*t,n=Math.floor(r);n===t&&(n=t-1);var a=r-n,i=this.cbs.slice(0,n),o=this.cbs.slice(n+1),s=this.cbs[n].divide(a);return i.push(s[0]),o.unshift(s[1]),[new fe.CubicBeziers(i),new fe.CubicBeziers(o)]}slice(e,t){if(!(e>=t)){if(e<0&&(e=0),t>1&&(t=1),0===e&&1===t)return this;var r=this.cbs.length,n=e*r,a=t*r,i=Math.floor(n),o=Math.floor(a);i===r&&(i=r-1),o===r&&(o=r-1);var s,h=n-i,u=a-o;return i===o?s=[this.cbs[i].slice(h,u)]:((s=this.cbs.slice(i+1,o)).push(this.cbs[o].slice(0,u)),s.unshift(this.cbs[i].slice(h,1))),new fe.CubicBeziers(s)}}countOfSegments(){return this.cbs.length}drawPrimitive(e,t){for(var r=this.cbs.length,n=this.cbs,a=n[0],i=a.cp0,o=a.cp1,s=a.cp2,h=a.cp3,u="M"+Q.measure.em2px(i.x)+","+Q.measure.em2px(-i.y)+" C"+Q.measure.em2px(o.x)+","+Q.measure.em2px(-o.y)+" "+Q.measure.em2px(s.x)+","+Q.measure.em2px(-s.y)+" "+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y),c=1;c<r;c++)s=(a=n[c]).cp2,h=a.cp3,u+=" S"+Q.measure.em2px(s.x)+","+Q.measure.em2px(-s.y)+" "+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y);e.createSvgElement("path",{d:u,"stroke-dasharray":t})}drawSkipped(e){for(var t=this.cbs.length,r=this.cbs,n="",a=0;a<t;a+=2){var i=r[a],o=i.cp0,s=i.cp1,h=i.cp2,u=i.cp3;n+="M"+Q.measure.em2px(o.x)+","+Q.measure.em2px(-o.y)+" C"+Q.measure.em2px(s.x)+","+Q.measure.em2px(-s.y)+" "+Q.measure.em2px(h.x)+","+Q.measure.em2px(-h.y)+" "+Q.measure.em2px(u.x)+","+Q.measure.em2px(-u.y)}e.createSvgElement("path",{d:n})}static interpolation(e,t,r){var n,a=fe.CubicBeziers.cubicSplineInterpolation(e,t),i=a[0],o=a[1],s=fe.CubicBeziers.cubicSplineInterpolation(e,r),h=s[0],u=s[1],c=e.length,m=new Array(c-1);for(n=0;n<c-1;n++)m[n]=new fe.CubicBezier(new le.Point(t[n],r[n]),new le.Point(i[n],h[n]),new le.Point(o[n],u[n]),new le.Point(t[n+1],r[n+1]));return new fe.CubicBeziers(m)}static cubicSplineInterpolation(e,t){var r,n=e.length-1,a=new Array(n);for(r=0;r<n;r++)a[r]=e[r+1]-e[r];var i=new Array(n);for(r=1;r<n;r++)i[r]=3*(t[r+1]-t[r])/a[r]-3*(t[r]-t[r-1])/a[r-1];var o=new Array(n+1),s=new Array(n+1),h=new Array(n+1);for(o[0]=1,s[0]=0,h[0]=0,r=1;r<n;r++)o[r]=2*(e[r+1]-e[r-1])-a[r-1]*s[r-1],s[r]=a[r]/o[r],h[r]=(i[r]-a[r-1]*h[r-1])/o[r];o[n]=1,h[n]=0;var u=new Array(n),c=new Array(n+1);for(c[n]=0,r=n-1;r>=0;r--){var m=a[r],p=c[r+1],l=m*m*h[r]-s[r]*p;c[r]=l,u[r]=t[r+1]-t[r]-(p+2*l)/3}var d=new Array(n),x=new Array(n);for(r=0;r<n;r++){var g=t[r],f=u[r],w=c[r];d[r]=g+f/3,x[r]=g+(2*f+w)/3}return[d,x]}},fe.CubicBSpline=class{constructor(e,t,r){if(t.length<1)throw d("ExecutionError","the number of internal control points of cubic B-spline must be greater than or equal to 1");var n=[];n.push(e);for(var a=0,i=t.length;a<i;a++)n.push(t[a]);n.push(r),this.cps=n;var o=this.cps.length-1,s=function(e){return e<0?n[0]:e>o?n[o]:n[e]},h=function(e){var t=Math.abs(e);return t<=1?(3*t*t*t-6*t*t+4)/6:t<=2?-(t-2)*(t-2)*(t-2)/6:0};this.px=function(e){for(var t=(o+2)*e-1,r=Math.ceil(t-2),n=Math.floor(t+2),a=0,i=r;i<=n;i++)a+=h(t-i)*s(i).x;return a},this.py=function(e){for(var t=(o+2)*e-1,r=Math.ceil(t-2),n=Math.floor(t+2),a=0,i=r;i<=n;i++)a+=h(t-i)*s(i).y;return a};var u=function(e){var t=e>0?1:e<0?-1:0,r=Math.abs(e);return r<=1?t*(3*r*r-4*r)/2:r<=2?-t*(r-2)*(r-2)/2:0};this.dpx=function(e){for(var t=(o+2)*e-1,r=Math.ceil(t-2),n=Math.floor(t+2),a=0,i=r;i<=n;i++)a+=u(t-i)*s(i).x;return a},this.dpy=function(e){for(var t=(o+2)*e-1,r=Math.ceil(t-2),n=Math.floor(t+2),a=0,i=r;i<=n;i++)a+=u(t-i)*s(i).y;return a}}position(e){return new le.Point(this.px(e),this.py(e))}angle(e){return Math.atan2(this.dpy(e),this.dpx(e))}toCubicBeziers(){var e=[],t=this.cps,r=t[0],n=t[1],a=t[2],i=r.x,o=r.y,s=i+(n.x-i)/3,h=o+(n.y-o)/3,u=i+2*(n.x-i)/3,c=o+2*(n.y-o)/3,m=n.x+(a.x-n.x)/3,p=n.y+(a.y-n.y)/3,l=(u+m)/2,d=(c+p)/2,x=r,g=new le.Point(s,h),f=new le.Point(u,c),w=new le.Point(l,d),v=new fe.CubicBezier(x,g,f,w);e.push(v);for(var S=this.cps.length-1,y=2;y<S;y++)r=n,n=a,a=t[y+1],i=l,o=d,s=2*l-u,h=2*d-c,u=r.x+2*(n.x-r.x)/3,c=r.y+2*(n.y-r.y)/3,l=(u+(m=n.x+(a.x-n.x)/3))/2,d=(c+(p=n.y+(a.y-n.y)/3))/2,x=w,g=new le.Point(s,h),f=new le.Point(u,c),w=new le.Point(l,d),v=new fe.CubicBezier(x,g,f,w),e.push(v);return r=n,n=a,i=l,o=d,s=2*l-u,h=2*d-c,u=r.x+2*(n.x-r.x)/3,c=r.y+2*(n.y-r.y)/3,l=n.x,d=n.y,x=w,g=new le.Point(s,h),f=new le.Point(u,c),w=new le.Point(l,d),v=new fe.CubicBezier(x,g,f,w),e.push(v),e}countOfSegments(){return this.cps.length-1}},fe.Line=class{constructor(e,t){this.s=e,this.e=t}position(e){return new le.Point(this.s.x+e*(this.e.x-this.s.x),this.s.y+e*(this.e.y-this.s.y))}slice(e,t){if(!(e>=t)){if(e<0&&(e=0),t>1&&(t=1),0===e&&1===t)return this;var r=this.s,n=this.e,a=n.x-r.x,i=n.y-r.y,o=new le.Point(r.x+e*a,r.y+e*i),s=new le.Point(r.x+t*a,r.y+t*i);return new fe.Line(o,s)}}tOfIntersections(e){if(e.isPoint())return[];var t=this.s,r=this.e;if(e.isRect()){var n,a=e.x+e.r,i=e.x-e.l,o=e.y+e.u,s=e.y-e.d,h=t.x,u=t.y,c=r.x-h,m=r.y-u,p=function(e){return h+e*c},l=function(e){return u+e*m},d=[];n=(n=fe.solutionsOfLinearEq(c,h-a)).concat(fe.solutionsOfLinearEq(c,h-i));for(var x=0;x<n.length;x++){var g=l(f=n[x]);g>=s&&g<=o&&d.push(f)}n=(n=fe.solutionsOfLinearEq(m,u-o)).concat(fe.solutionsOfLinearEq(m,u-s));for(x=0;x<n.length;x++){var f,w=p(f=n[x]);w>=i&&w<=a&&d.push(f)}return d}if(e.isCircle()){Math.PI;var v=e.l,S=e.r,y=e.u,C=e.d,b=e.x+(S-v)/2,M=e.y+(y-C)/2,P=(a=(v+S)/2,(y+C)/2),B=t.x,A=t.y,L=r.x-B,E=-L,O=(s=r.y-A)*a,k=E*P,D=O*O+k*k,j=(r=-(C=O*b+k*M+((L*A-s*B)*a+(a-P)*E*M))/D,D*a*a-C*C);if(j<0)return[];var T,R,F=Math.sqrt(j)/D,I=P/a,z=O*r+k*F+b,Q=I*(k*r-O*F+M-M)+M,W=O*r-k*F+b,N=I*(k*r+O*F+M-M)+M;Math.abs(L)>Math.abs(s)?(T=(z-B)/L,R=(W-B)/L):(T=(Q-A)/s,R=(N-A)/s);d=[];return T>=0&&T<=1&&d.push(T),R>=0&&R<=1&&d.push(R),d}}toShape(e,t,r,n){var a=e.env,i=Q.measure.thickness,o=this.s,s=this.e;if(o.x!==s.x||o.y!==s.y){var h,u=s.x-o.x,c=s.y-o.y,m=Math.atan2(c,u),p=de.none;switch(r){case"=":r="-",n="2";break;case"==":r="--",n="2";break;case":":case"::":r=".",n="2"}switch(r){case"":return a.angle=m,a.lastCurve=new ve.Line(o,s,a.p,a.c,void 0),p;case"-":case".":case"..":switch(n){case"2":h=i/2;break;case"3":h=i;break;default:h=0}break;case"--":var l=3*i;if((g=Math.sqrt(u*u+c*c))>=l)switch(n){case"2":h=i/2;break;case"3":h=i;break;default:h=0}break;case"~":case"~~":switch(n){case"2":h=1.5*i;break;case"3":h=2*i;break;default:h=0}break;default:var d=t.boundingBox(e);if(null==d)return a.angle=0,a.lastCurve=ve.none,de.none;var x=d.l+d.r;0==x&&(x=Q.measure.strokeWidth);var g=Math.sqrt(u*u+c*c);if(0==Math.floor(g/x))return a.angle=0,a.lastCurve=ve.none,de.none;h=Math.max(d.u,d.d)}if(void 0!==h){var f=this.boundingBox(h);return p=new de.LineShape(this,t,r,n,f),e.appendShapeToFront(p),a.angle=m,a.lastCurve=new ve.Line(o,s,a.p,a.c,p),p}}return a.angle=0,a.lastCurve=ve.none,de.none}boundingBox(e){var t=this.s,r=this.e,n=r.x-t.x,a=r.y-t.y,i=Math.atan2(a,n),o=e*Math.cos(i+Math.PI/2),s=e*Math.sin(i+Math.PI/2);return new le.Rect(t.x,t.y,{l:t.x-Math.min(t.x+o,t.x-o,r.x+o,r.x-o),r:Math.max(t.x+o,t.x-o,r.x+o,r.x-o)-t.x,u:Math.max(t.y+s,t.y-s,r.y+s,r.y-s)-t.y,d:t.y-Math.min(t.y+s,t.y-s,r.y+s,r.y-s)})}drawLine(e,t,r,n,a){if(a.isEmpty)this._drawLine(e,t,r,n);else{var i=new pe(0,1).differenceRanges(a),o=this;i.foreach(function(a){o.slice(a.start,a.end)._drawLine(e,t,r,n)})}}_drawLine(e,t,r,n){var a=Q.measure.thickness,i=this.s,o=this.e;if(i.x!==o.x||i.y!==o.y){var s=o.x-i.x,h=o.y-i.y,u=Math.atan2(h,s),c={x:0,y:0};switch(r){case"":break;case"-":this.drawStraightLine(e,i,o,c,u,a,n,"");break;case"=":this.drawStraightLine(e,i,o,c,u,a,"2","");break;case".":case"..":this.drawStraightLine(e,i,o,c,u,a,n,Q.measure.dottedDasharray);break;case":":case"::":this.drawStraightLine(e,i,o,c,u,a,"2",Q.measure.dottedDasharray);break;case"--":case"==":var m=3*a;if((B=Math.sqrt(s*s+h*h))>=m)c={x:(A=(B-m)/2-Math.floor((B-m)/2/m)*m)*Math.cos(u),y:A*Math.sin(u)},this.drawStraightLine(e,i,o,c,u,a,"=="===r?"2":n,Q.measure.em2px(m)+" "+Q.measure.em2px(m));break;case"~":if((B=Math.sqrt(s*s+h*h))>=(S=4*a)){c={x:(A=(B-(P=Math.floor(B/S))*S)/2)*Math.cos(u),y:A*Math.sin(u)};for(var p=a*Math.cos(u+Math.PI/2),l=a*Math.sin(u+Math.PI/2),d=a*Math.cos(u),x=a*Math.sin(u),g=i.x+c.x,f=-i.y-c.y,w="M"+Q.measure.em2px(g)+","+Q.measure.em2px(f)+" Q"+Q.measure.em2px(g+d+p)+","+Q.measure.em2px(f-x-l)+" "+Q.measure.em2px(g+2*d)+","+Q.measure.em2px(f-2*x)+" T"+Q.measure.em2px(g+4*d)+","+Q.measure.em2px(f-4*x),v=1;v<P;v++)w+=" T"+Q.measure.em2px(g+(4*v+2)*d)+","+Q.measure.em2px(f-(4*v+2)*x)+" T"+Q.measure.em2px(g+(4*v+4)*d)+","+Q.measure.em2px(f-(4*v+4)*x);this.drawSquigglyLineShape(e,w,i,o,p,l,n)}break;case"~~":var S;if((B=Math.sqrt(s*s+h*h))>=(S=4*a)){c={x:(A=(B-S)/2-(P=Math.floor((B-S)/2/S))*S)*Math.cos(u),y:A*Math.sin(u)};for(p=a*Math.cos(u+Math.PI/2),l=a*Math.sin(u+Math.PI/2),d=a*Math.cos(u),x=a*Math.sin(u),g=i.x+c.x,f=-i.y-c.y,w="",v=0;v<=P;v++)w+=" M"+Q.measure.em2px(g+8*v*d)+","+Q.measure.em2px(f-8*v*x)+" Q"+Q.measure.em2px(g+(8*v+1)*d+p)+","+Q.measure.em2px(f-(8*v+1)*x-l)+" "+Q.measure.em2px(g+(8*v+2)*d)+","+Q.measure.em2px(f-(8*v+2)*x)+" T"+Q.measure.em2px(g+(8*v+4)*d)+","+Q.measure.em2px(f-(8*v+4)*x);this.drawSquigglyLineShape(e,w,i,o,p,l,n)}break;default:var y=new ge;y.c=ge.originPosition;var C=new xe(de.none,y),b=t.boundingBox(C);if(null==b)return;var M=b.l+b.r;0==M&&(M=Q.measure.strokeWidth);var P,B=Math.sqrt(s*s+h*h);if(0==(P=Math.floor(B/M)))return;var A=(B-P*M)/2,L=Math.cos(u),E=Math.sin(u),O=M*L,k=M*E,D=i.x+(A+b.l)*L,j=i.y+(A+b.l)*E;for(C=new xe(de.none,y),v=0;v<P;v++)y.c=new le.Point(D+v*O,j+v*k),y.angle=u,t.toDropShape(C).draw(e)}}}drawStraightLine(e,t,r,n,a,i,o,s){if("3"===o){var h=i*Math.cos(a+Math.PI/2),u=i*Math.sin(a+Math.PI/2);e.createSvgElement("line",{x1:Q.measure.em2px(t.x+n.x),y1:-Q.measure.em2px(t.y+n.y),x2:Q.measure.em2px(r.x),y2:-Q.measure.em2px(r.y),"stroke-dasharray":s}),e.createSvgElement("line",{x1:Q.measure.em2px(t.x+h+n.x),y1:-Q.measure.em2px(t.y+u+n.y),x2:Q.measure.em2px(r.x+h),y2:-Q.measure.em2px(r.y+u),"stroke-dasharray":s}),e.createSvgElement("line",{x1:Q.measure.em2px(t.x-h+n.x),y1:-Q.measure.em2px(t.y-u+n.y),x2:Q.measure.em2px(r.x-h),y2:-Q.measure.em2px(r.y-u),"stroke-dasharray":s})}else if("2"===o){h=i*Math.cos(a+Math.PI/2)/2,u=i*Math.sin(a+Math.PI/2)/2;e.createSvgElement("line",{x1:Q.measure.em2px(t.x+h+n.x),y1:-Q.measure.em2px(t.y+u+n.y),x2:Q.measure.em2px(r.x+h),y2:-Q.measure.em2px(r.y+u),"stroke-dasharray":s}),e.createSvgElement("line",{x1:Q.measure.em2px(t.x-h+n.x),y1:-Q.measure.em2px(t.y-u+n.y),x2:Q.measure.em2px(r.x-h),y2:-Q.measure.em2px(r.y-u),"stroke-dasharray":s})}else e.createSvgElement("line",{x1:Q.measure.em2px(t.x+n.x),y1:-Q.measure.em2px(t.y+n.y),x2:Q.measure.em2px(r.x),y2:-Q.measure.em2px(r.y),"stroke-dasharray":s})}drawSquigglyLineShape(e,t,r,n,a,i,o){"3"===o?(e.createSvgElement("path",{d:t}),e.createGroup(e.transformBuilder().translate(a,i)).createSvgElement("path",{d:t}),e.createGroup(e.transformBuilder().translate(-a,-i)).createSvgElement("path",{d:t})):"2"===o?(e.createGroup(e.transformBuilder().translate(a/2,i/2)).createSvgElement("path",{d:t}),e.createGroup(e.transformBuilder().translate(-a/2,-i/2)).createSvgElement("path",{d:t})):e.createSvgElement("path",{d:t})}};class we{bezierFatLine(e){var t,r,n,a,i=this.cps[0],o=this.cps[e];if(i.x!==o.x||i.y!==o.y)t=i.y-o.y,r=o.x-i.x,t/=a=Math.sqrt(t*t+r*r),r/=a,n=(i.x*o.y-i.y*o.x)/a;else{var s=this.bezier.angle(this.tmin);t=-Math.sin(s),r=Math.cos(s),n=-t*this.cp0.x-r*this.cp0.y}for(var h=n,u=n,c=1;c<e;c++){var m=-t*this.cps[c].x-r*this.cps[c].y;m>u?u=m:m<h&&(h=m)}return{min:[t,r,h],max:[t,r,u]}}clippedLineRange(e,t,r){for(var n,a,i,o,s,h=e.length-1,u=new Array(h+1),c=se,m=0;m<=h;m++)u[m]=[m/h,-t[0]*e[m].x-t[1]*e[m].y-t[2],1];if(u[0][1]<0){var p=!0;for(m=1;m<=h;m++){(n=-(d=c(u[0],u[m]))[2]/d[0])>0&&n<1&&(void 0===a||n<a)&&(a=n),u[m][1]>=0&&(p=!1)}if(p)return}else a=0;if(u[h][1]<0)for(m=0;m<h;m++){(n=-(x=c(u[h],u[m]))[2]/x[0])>0&&n<1&&(void 0===i||n>i)&&(i=n)}else i=1;for(m=0;m<=h;m++)u[m]=[m/h,r[0]*e[m].x+r[1]*e[m].y+r[2],1];if(u[0][1]<0){var l=!0;for(m=1;m<=h;m++){var d;(n=-(d=c(u[0],u[m]))[2]/d[0])>0&&n<1&&(void 0===o||n<o)&&(o=n),u[m][1]>=0&&(l=!1)}if(l)return}else o=0;if(u[h][1]<0)for(m=0;m<h;m++){var x;(n=-(x=c(u[h],u[m]))[2]/x[0])>0&&n<1&&(void 0===s||n>s)&&(s=n)}else s=1;var g=Math.max(a,o),f=Math.min(i,s);return{min:this.tmin+g*(this.tmax-this.tmin),max:this.tmin+f*(this.tmax-this.tmin)}}static findIntersections(e,t){for(var r=we.maxIterations,n=we.goalAccuracy,a=[[e,t,!1]],i=0,o=[];i<r&&a.length>0;){i++;var s=a.shift(),h=(e=s[0],t=s[1],s[2]),u=e.fatLine(),c=t.clippedRange(u.min,u.max);if(null!=c){var m=c.min,p=c.max,l=p-m;if(l<n&&e.paramLength()<n)h?o.push([t.clip(m,p).paramRange(),e.paramRange()]):o.push([e.paramRange(),t.clip(m,p).paramRange()]);else if(l<=.8*t.paramLength())a.push([t.clip(m,p),e,!h]);else if(l>e.paramLength()){var d=(p+m)/2;a.push([t.clip(m,d),e,!h]),a.push([t.clip(d,p),e,!h])}else{var x=t.clip(m,p),g=e.paramRange(),f=(g.min+g.max)/2;a.push([x,e.clip(g.min,f),!h]),a.push([x,e.clip(f,g.max),!h])}}}return o}static get maxIterations(){return 30}static get goalAccuracy(){return 1e-4}}we.Line=class extends we{constructor(e,t,r,n){super(),this.p0=e,this.p1=t,this.tmin=r,this.tmax=n}paramRange(){return{min:this.tmin,max:this.tmax}}paramLength(){return this.tmax-this.tmin}containsParam(e){return e>=this.tmin&&e<=this.tmax}position(e){return{x:this.p0.x+e*(this.p1.x-this.p0.x),y:this.p0.y+e*(this.p1.y-this.p0.y)}}fatLine(){var e=this.p1.y-this.p0.y,t=this.p0.x-this.p1.x,r=this.p1.x*this.p0.y-this.p0.x*this.p1.y,n=Math.sqrt(e*e+t*t);return 0===n?(e=1,t=0):(e/=n,t/=n,r/=n),{min:[e,t,r],max:[e,t,r]}}clip(e,t){return new we.Line(this.p0,this.p1,e,t)}clippedRange(e,t){var r=new Array(2);return r[0]=this.position(this.tmin),r[1]=this.position(this.tmax),this.clippedLineRange(r,e,t)}drawFatLine(){var e=this.fatLine().max,t=function(e,t){return-(e*t[0]+t[2])/t[1]},r=this.p0.x,n=this.p1.x;Q.svgForDebug.createSvgElement("line",{x1:Q.measure.em2px(r),y1:-Q.measure.em2px(t(r,e)),x2:Q.measure.em2px(n),y2:-Q.measure.em2px(t(n,e)),"stroke-width":Q.measure.em2px(.02*Q.measure.oneem),stroke:"red"})}},we.QuadBezier=class extends we{constructor(e,t,r){super(),this.bezier=e,this.tmin=t,this.tmax=r,this.cp0=e.position(t),this.cp1=new le.Point((1-r)*(1-t)*e.cp0.x+(t+r-2*t*r)*e.cp1.x+t*r*e.cp2.x,(1-r)*(1-t)*e.cp0.y+(t+r-2*t*r)*e.cp1.y+t*r*e.cp2.y),this.cp2=e.position(r),this.cps=[this.cp0,this.cp1,this.cp2]}paramRange(){return{min:this.tmin,max:this.tmax}}paramLength(){return this.tmax-this.tmin}fatLine(){return this.bezierFatLine(2)}clip(e,t){return new we.QuadBezier(this.bezier,e,t)}clippedRange(e,t){return this.clippedLineRange(this.cps,e,t)}drawFatLine(){var e=this.fatLine(),t=e.min,r=e.max,n=function(e,t){return-(e*t[0]+t[2])/t[1]},a=this.cp0.x,i=this.cp2.x;Q.svgForDebug.createSvgElement("line",{x1:Q.measure.em2px(a),y1:-Q.measure.em2px(n(a,t)),x2:Q.measure.em2px(i),y2:-Q.measure.em2px(n(i,t)),"stroke-width":Q.measure.em2px(.02*Q.measure.oneem),stroke:"blue"}),Q.svgForDebug.createSvgElement("line",{x1:Q.measure.em2px(a),y1:-Q.measure.em2px(n(a,r)),x2:Q.measure.em2px(i),y2:-Q.measure.em2px(n(i,r)),"stroke-width":Q.measure.em2px(.02*Q.measure.oneem),stroke:"red"})}},we.CubicBezier=class extends we{constructor(e,t,r){super(),this.bezier=e,this.tmin=t,this.tmax=r,this.cp0=e.position(t),this.cp1=new le.Point((1-r)*(1-t)*(1-t)*e.cp0.x+(1-t)*(2*t+r-3*t*r)*e.cp1.x+t*(2*r+t-3*t*r)*e.cp2.x+t*t*r*e.cp3.x,(1-r)*(1-t)*(1-t)*e.cp0.y+(1-t)*(2*t+r-3*t*r)*e.cp1.y+t*(2*r+t-3*t*r)*e.cp2.y+t*t*r*e.cp3.y),this.cp2=new le.Point((1-t)*(1-r)*(1-r)*e.cp0.x+(1-r)*(2*r+t-3*t*r)*e.cp1.x+r*(2*t+r-3*t*r)*e.cp2.x+t*r*r*e.cp3.x,(1-t)*(1-r)*(1-r)*e.cp0.y+(1-r)*(2*r+t-3*t*r)*e.cp1.y+r*(2*t+r-3*t*r)*e.cp2.y+t*r*r*e.cp3.y),this.cp3=e.position(r),this.cps=[this.cp0,this.cp1,this.cp2,this.cp3]}paramRange(){return{min:this.tmin,max:this.tmax}}paramLength(){return this.tmax-this.tmin}fatLine(){return this.bezierFatLine(3)}clip(e,t){return new we.CubicBezier(this.bezier,e,t)}clippedRange(e,t){return this.clippedLineRange(this.cps,e,t)}drawFatLine(){var e=this.fatLine(),t=e.min,r=e.max,n=function(e,t){return-(e*t[0]+t[2])/t[1]},a=this.cp0.x,i=this.cp3.x;Q.svgForDebug.createSvgElement("line",{x1:Q.measure.em2px(a),y1:-Q.measure.em2px(n(a,t)),x2:Q.measure.em2px(i),y2:-Q.measure.em2px(n(i,t)),"stroke-width":Q.measure.em2px(.02*Q.measure.oneem),stroke:"blue"}),Q.svgForDebug.createSvgElement("line",{x1:Q.measure.em2px(a),y1:-Q.measure.em2px(n(a,r)),x2:Q.measure.em2px(i),y2:-Q.measure.em2px(n(i,r)),"stroke-width":Q.measure.em2px(.02*Q.measure.oneem),stroke:"red"})}},we.Arc=class extends we{constructor(e,t,r,n,a,i){super(),this.x=e,this.y=t,this.rx=r,this.ry=n,this.angleMin=a,this.angleMax=i}paramRange(){return{min:this.angleMin,max:this.angleMax}}paramLength(){return this.angleMax-this.angleMin}normalizeAngle(e){return(e=e%2*Math.PI)>Math.PI?e-2*Math.PI:e<-Math.PI?e+2*Math.PI:e}containsParam(e){return e>=this.angleMin&&e<=this.angleMax}fatLine(){var e=this.rx,t=this.ry,r=(this.angleMax+this.angleMin)/2,n=(this.angleMax-this.angleMin)/2,a=Math.cos(r),i=Math.sin(r),o=Math.sqrt(e*e*i*i+t*t*a*a);if(o<oe.machinePrecision)var s=[1,0,this.x*t*a+this.y*e*i+e*t*Math.cos(n)],h=[1,0,this.x*t*a+this.y*e*i+e*t];else{var u=e/o,c=t/o;s=[-c*a,-u*i,this.x*c*a+this.y*u*i+e*t/o*Math.cos(n)],h=[-c*a,-u*i,this.x*c*a+this.y*u*i+e*t/o]}return{min:s,max:h}}clip(e,t){return new we.Arc(this.x,this.y,this.rx,this.ry,e,t)}toCircleLine(e,t,r,n,a){var i=e[0],o=e[1],s=i*n,h=o*a,u=e[2]*n+(n-a)*o*r,c=Math.sqrt(s*s+h*h);return c<oe.machinePrecision?(s=1,h=0):(s/=c,h/=c,u/=c),[s,h,u]}clippedRange(e,t){var r=this.x,n=this.y,a=this.rx,i=this.ry,o=this.toCircleLine(e,r,n,a,i),s=this.toCircleLine(t,r,n,a,i),h=a,u=this.angleMin,c=this.angleMax,m=-(o[0]*r+o[1]*n+o[2]),p=[];if(h*h-m*m>=0){var l=o[0]*m-o[1]*Math.sqrt(h*h-m*m),d=o[1]*m+o[0]*Math.sqrt(h*h-m*m),x=o[0]*m+o[1]*Math.sqrt(h*h-m*m),g=o[1]*m-o[0]*Math.sqrt(h*h-m*m),f=Math.atan2(d,l),w=Math.atan2(g,x);this.containsParam(f)&&p.push(f),this.containsParam(w)&&p.push(w)}var v,S,y=-(o[0]*(r+h*Math.cos(u))+o[1]*(n+h*Math.sin(u))+o[2]),C=-(o[0]*(r+h*Math.cos(c))+o[1]*(n+h*Math.sin(c))+o[2]);if(y<0){if(0==p.length)return;v=Math.min.apply(Math,p)}else v=this.angleMin;if(C<0){if(0==p.length)return;S=Math.max.apply(Math,p)}else S=this.angleMax;p=[];if(h*h-(m=s[0]*r+s[1]*n+s[2])*m>=0){l=-o[0]*m+o[1]*Math.sqrt(h*h-m*m),d=-o[1]*m-o[0]*Math.sqrt(h*h-m*m),x=-o[0]*m-o[1]*Math.sqrt(h*h-m*m),g=-o[1]*m+o[0]*Math.sqrt(h*h-m*m),f=Math.atan2(d,l),w=Math.atan2(g,x);this.containsParam(f)&&p.push(f),this.containsParam(w)&&p.push(w)}var b,M;y=s[0]*(r+h*Math.cos(u))+s[1]*(n+h*Math.sin(u))+s[2],C=s[0]*(r+h*Math.cos(c))+s[1]*(n+h*Math.sin(c))+s[2];if(y<0){if(0==p.length)return;b=Math.min.apply(Math,p)}else b=this.angleMin;if(C<0){if(0==p.length)return;M=Math.max.apply(Math,p)}else M=this.angleMax;return{min:Math.max(v,b),max:Math.min(S,M)}}drawFatLine(){var e=this.fatLine(),t=e.min,r=e.max,n=function(e,t){return-(e*t[0]+t[2])/t[1]},a=this.x+this.r*Math.cos(this.angleMin),i=this.x+this.r*Math.cos(this.angleMax);Q.svgForDebug.createSvgElement("line",{x1:Q.measure.em2px(a),y1:-Q.measure.em2px(n(a,t)),x2:Q.measure.em2px(i),y2:-Q.measure.em2px(n(i,t)),"stroke-width":Q.measure.em2px(.02*Q.measure.oneem),stroke:"blue"}),Q.svgForDebug.createSvgElement("line",{x1:Q.measure.em2px(a),y1:-Q.measure.em2px(n(a,r)),x2:Q.measure.em2px(i),y2:-Q.measure.em2px(n(i,r)),"stroke-width":Q.measure.em2px(.02*Q.measure.oneem),stroke:"red"})}};class ve{}ve.None=class extends ve{constructor(){super()}get isDefined(){return!1}segments(){return[]}angle(){return 0}},ve.none=new ve.None,ve.Line=class extends ve{constructor(e,t,r,n,a){super(),this.start=e,this.end=t,this.p=r,this.c=n,this.lineShape=a}get isDefined(){return!0}position(e){return new le.Point(this.p.x+e*(this.c.x-this.p.x),this.p.y+e*(this.c.y-this.p.y))}derivative(e){return new le.Point(this.c.x-this.p.x,this.c.y-this.p.y)}angle(e){var t=this.c.x-this.p.x,r=this.c.y-this.p.y;return 0===t&&0===r?0:Math.atan2(r,t)}tOfPlace(e,t,r,n){var a=e?this.start:this.p,i=t?this.end:this.c;if(a.x===i.x&&a.y===i.y)return 0;var o,s,h=i.x-a.x,u=i.y-a.y,c=Math.sqrt(h*h+u*u);r>.5?(o=i.x-(1-r)*h+n*h/c,s=i.y-(1-r)*u+n*u/c):(o=a.x+r*h+n*h/c,s=a.y+r*u+n*u/c);var m=this.c.x-this.p.x,p=this.c.y-this.p.y;return 0===m&&0===p?0:Math.abs(m)>Math.abs(p)?(o-this.p.x)/m:(s-this.p.y)/p}sliceHole(e,t){if(void 0!==this.lineShape&&!e.isPoint()){var r=this.lineShape,n=r.line,a=n.tOfIntersections(e);a.push(0),a.push(1),a.sort();for(var i=a[0],o=1;o<a.length;o++){var s=a[o],h=n.position((s+i)/2);if(e.contains(h)){var u=new pe(i,s);r.sliceHole(u)}i=s}}}segments(){return[new we.Line(this.p,this.c,0,1)]}},ve.QuadBezier=class extends ve{constructor(e,t,r,n){super(),this.origBezier=e,this.tOfShavedStart=t,this.tOfShavedEnd=r,n.isNone||(this.curveShape=n,t>0&&n.sliceHole(new pe(0,t)),r<1&&n.sliceHole(new pe(r,1)))}get isDefined(){return!0}position(e){return this.origBezier.position(e)}derivative(e){return this.origBezier.derivative(e)}angle(e){return this.origBezier.angle(e)}tOfPlace(e,t,r,n){var a,i;e?(a=this.tOfShavedStart,i=t?this.tOfShavedEnd-this.tOfShavedStart:1-this.tOfShavedStart):(a=0,i=t?this.tOfShavedEnd:1);var o=this.origBezier,s=a+i*r;if(0!==n){var h=o.length(s);s=o.tOfLength(h+n)}return s}sliceHole(e,t){var r=this.curveShape;if(void 0!==r&&!e.isPoint()){var n=r.curve,a=n.tOfIntersections(e);a.push(0),a.push(1),a.sort();for(var i=a[0],o=1;o<a.length;o++){var s=a[o];if(i<=t&&t<=s){var h=n.position((s+i)/2);if(e.contains(h)){var u=new pe(i,s);r.sliceHole(u)}}i=s}}}segments(){return[new we.QuadBezier(this.origBezier,0,1)]}},ve.CubicBezier=class extends ve{constructor(e,t,r,n){super(),this.origBezier=e,this.tOfShavedStart=t,this.tOfShavedEnd=r,n.isNone||(this.curveShape=n,t>0&&n.sliceHole(new pe(0,t)),r<1&&n.sliceHole(new pe(r,1)))}originalLine(){return this.originalLine}get isDefined(){return!0}position(e){return this.origBezier.position(e)}derivative(e){return this.origBezier.derivative(e)}angle(e){return this.origBezier.angle(e)}tOfPlace(e,t,r,n){var a,i;e?(a=this.tOfShavedStart,i=t?this.tOfShavedEnd-this.tOfShavedStart:1-this.tOfShavedStart):(a=0,i=t?this.tOfShavedEnd:1);var o=this.origBezier,s=a+i*r;if(0!==n){var h=o.length(s);s=o.tOfLength(h+n)}return s}sliceHole(e,t){var r=this.curveShape;if(void 0!==r&&!e.isPoint()){var n=r.curve,a=n.tOfIntersections(e);a.push(0),a.push(1),a.sort();for(var i=a[0],o=1;o<a.length;o++){var s=a[o];if(i<=t&&t<=s){var h=n.position((s+i)/2);if(e.contains(h)){var u=new pe(i,s);r.sliceHole(u)}}i=s}}}segments(){return[new we.CubicBezier(this.origBezier,0,1)]}},ve.CubicBSpline=class extends ve{constructor(e,t,r,n,a,i){super(),this.s=e,this.e=t,this.origBeziers=r,this.tOfShavedStart=n,this.tOfShavedEnd=a,i.isNone||(this.curveShape=i,n>0&&i.sliceHole(new pe(0,n)),a<1&&i.sliceHole(new pe(a,1)))}get isDefined(){return!0}position(e){return this.origBeziers.position(e)}derivative(e){return this.origBeziers.derivative(e)}angle(e){return this.origBeziers.angle(e)}tOfPlace(e,t,r,n){var a,i;e?(a=this.tOfShavedStart,i=t?this.tOfShavedEnd-this.tOfShavedStart:1-this.tOfShavedStart):(a=0,i=t?this.tOfShavedEnd:1);var o=this.origBeziers,s=a+i*r;if(0!==n){var h=o.length(s);s=o.tOfLength(h+n)}return s}sliceHole(e,t){var r=this.curveShape;if(void 0!==r&&!e.isPoint()){var n=r.curve,a=n.tOfIntersections(e);a.push(0),a.push(1),a.sort();for(var i=a[0],o=1;o<a.length;o++){var s=a[o];if(i<=t&&t<=s){var h=n.position((s+i)/2);if(e.contains(h)){var u=new pe(i,s);r.sliceHole(u)}}i=s}}}segments(){for(var e=new Array(this.origBeziers.length),t=e.length,r=0;r<t;r++)e[r]=new we.CubicBezier(this.origBezier,r/t,(r+1)/t);return e}};class Se{}function ye(e,t){for(let r in t)e.prototype.hasOwnProperty(r)?console.log("WARN","method "+r+" is already exists in class "+e.name):e.prototype[r]=t[r]}Se.Position=class{constructor(e){this.pos=e}position(e){return this.pos}toString(){return this.pos.toString()}},Se.Macro=class{constructor(e){this.macro=e}position(e){var t=e.env;return t.c=this.macro.position(e),t.c}toString(){return this.macro.toString()}},Se.Base=class{constructor(e,t,r){this.origin=e,this.xBase=t,this.yBase=r}position(e){var t=e.env;return t.origin=this.origin,t.xBase=this.xBase,t.yBase=this.yBase,t.c}toString(){return"origin:"+this.origin+", xBase:"+this.xBase+", yBase:"+this.yBase}},Se.Stack=class{constructor(e){this.stack=e}position(e){var t=e.env;return this.stack.isEmpty||(this.stack.tail.reverse().foreach(function(e){t.capturePosition(e)}),t.c=this.stack.head),t.c}toString(){return this.stack.toString()}},ye(W.PosDecor,{toShape:function(e){this.pos.toShape(e),this.decor.toShape(e)}}),ye(W.Pos.Coord,{toShape:function(e){e.env.c=this.coord.position(e),this.pos2s.foreach(function(t){t.toShape(e)})}}),ye(W.Pos.Plus,{toShape:function(e){var t=e.env,r=this.coord.position(e);t.c=r.move(t.c.x+r.x,t.c.y+r.y)}}),ye(W.Pos.Minus,{toShape:function(e){var t=e.env,r=this.coord.position(e);t.c=r.move(t.c.x-r.x,t.c.y-r.y)}}),ye(W.Pos.Skew,{toShape:function(e){var t=e.env,r=this.coord.position(e),n=new le.Point(r.x+t.c.x,r.y+t.c.y);t.c=n.combineRect(t.c)}}),ye(W.Pos.Cover,{toShape:function(e){var t=e.env,r=this.coord.position(e);t.c=t.c.combineRect(r)}}),ye(W.Pos.Then,{toShape:function(e){var t=e.env;t.capturePosition(t.c),t.c=this.coord.position(e)}}),ye(W.Pos.SwapPAndC,{toShape:function(e){var t=e.env;t.swapPAndC(),t.c=this.coord.position(e)}}),ye(W.Pos.SetBase,{toShape:function(e){var t=e.env,r=t.p,n=t.c.x-r.x,a=t.c.y-r.y;t.setOrigin(r.x,r.y),t.setXBase(n,a),t.setYBase(-a,n),t.c=this.coord.position(e)}}),ye(W.Pos.SetYBase,{toShape:function(e){var t=e.env;t.setYBase(t.c.x-t.origin.x,t.c.y-t.origin.y),t.c=this.coord.position(e)}}),ye(W.Pos.ConnectObject,{toShape:function(e){this.object.toConnectShape(e)}}),ye(W.Pos.DropObject,{toShape:function(e){this.object.toDropShape(e)}}),ye(W.Pos.Place,{toShape:function(e){var t=e.env;if(t.lastCurve.isDefined){var r,n=this.place,a=n.shaveP>0,i=n.shaveC>0,o=a?n.shaveP-1:0,s=i?n.shaveC-1:0;if(a&&(r=0),i&&(r=1),a==i&&(r=.5),void 0!==n.factor)if(n.factor.isIntercept){if(i=a=!1,void 0===(r=n.factor.value(e)))return}else r=n.factor.value(e);var h=Q.measure.length2em(n.slide.dimen.getOrElse("0"))+(o-s)*Q.measure.jot,u=t.lastCurve.tOfPlace(a,i,r,h),c=t.lastCurve.position(u),m=t.lastCurve.angle(u);return t.c=c,t.angle=m,u}}}),ye(W.Pos.PushCoord,{toShape:function(e){var t=e.env,r=this.coord.position(e);t.pushPos(r)}}),ye(W.Pos.EvalCoordThenPop,{toShape:function(e){var t=e.env;t.c=this.coord.position(e),t.popPos()}}),ye(W.Pos.LoadStack,{toShape:function(e){var t=e.env;t.startCapturePositions(),this.coord.position(e);var r=t.endCapturePositions();t.setStack(r),t.pushPos(t.c)}}),ye(W.Pos.DoCoord,{toShape:function(e){var t=e.env,r=this.coord;t.stack.reverse().foreach(function(n){t.c=n,r.position(e)})}}),ye(W.Pos.InitStack,{toShape:function(e){e.env.initStack()}}),ye(W.Pos.EnterFrame,{toShape:function(e){e.env.enterStackFrame()}}),ye(W.Pos.LeaveFrame,{toShape:function(e){e.env.leaveStackFrame()}}),ye(W.Place.Factor,{value:function(e){return this.factor}}),ye(W.Place.Intercept,{value:function(e){var t=e.env;if(t.lastCurve.isDefined){var r=t.duplicate();r.angle=0,r.lastCurve=ve.none,r.p=r.c=ge.originPosition;var n=new xe(de.none,r);this.pos.toShape(n);e.appendShapeToFront(n.shape),r.lastCurve.isDefined||(r.lastCurve=new ve.Line(r.p,r.c,r.p,r.c,void 0));for(var a=[],i=t.lastCurve.segments(),o=r.lastCurve.segments(),s=0;s<i.length;s++)for(var h=0;h<o.length;h++)a=a.concat(we.findIntersections(i[s],o[h]));if(0===a.length){console.log("perhaps no curve intersection.");for(var u=t.lastCurve,c=r.lastCurve,m=1e-5,p=0,l=2,d=0,x=0,g=function(e){return 1/(1+Math.exp(-e))},f=function(e){var t=Math.exp(-e);return t/(1+t)/(1+t)},w=g(d),v=g(x),S=f(d),y=f(x),C=u.derivative(w),b=c.derivative(v),M=C.x*S,P=-b.x*y,B=C.y*S,A=-b.y*y,L=M*M+B*B,E=M*P+B*A,O=P*M+A*B,k=P*P+A*A,D=u.position(w),j=c.position(v),T=D.x-j.x,R=D.y-j.y,F=M*T+B*R,I=P*T+A*R,z=Math.sqrt(F*F+I*I)<m,Q=.001*Math.max(L,k);!z&&p<100;){p++;do{var W=k+Q,N=(L+Q)*W-E*O,_=(W*F-E*I)/N,U=(-O*F+L*I)/N;if(_*_+U*U<1.0000000000000002e-10*(d*d+x*x))z=!0;else{var G=d-_,X=x-U,V=g(G),H=g(X),q=u.position(V),J=c.position(H),Z=q.x-J.x,Y=q.y-J.y,$=(T*T+R*R-(Z*Z+Y*Y))/(_*(Q*_+F)+U*(Q*U+I));if($>0){x=X,w=V,v=H,S=f(d=G),y=f(x),C=u.derivative(w),b=c.derivative(v),M=C.x*S,P=-b.x*y,L=M*M+(B=C.y*S)*B,E=M*P+B*(A=-b.y*y),O=P*M+A*B,k=P*P+A*A,F=M*(T=Z)+B*(R=Y),I=P*T+A*R,z=Math.sqrt(F*F+I*I)<m;var K=2*$-1;Q+=Math.max(1/3,1-K*K*K),l=2}else Q*=l,l*=2}}while(!(z||void 0!==$&&$>0))}return g(d)}var ee=(a[0][0].min+a[0][0].max)/2;for(s=1;s<a.length;s++){var te=(a[s][0].min+a[s][0].max)/2;ee>te&&(ee=te)}return ee}}}),ye(W.Pos.SavePos,{toShape:function(e){var t=e.env;t.savePos(this.id,new Se.Position(t.c))}}),ye(W.Pos.SaveMacro,{toShape:function(e){e.env.savePos(this.id,new Se.Macro(this.macro))}}),ye(W.Pos.SaveBase,{toShape:function(e){var t=e.env;t.savePos(this.id,new Se.Base(t.origin,t.xBase,t.yBase))}}),ye(W.Pos.SaveStack,{toShape:function(e){var t=e.env;t.savePos(this.id,new Se.Stack(t.stack))}}),ye(W.Object,{toDropShape:function(e){var t=e.env;if(void 0===t.c)return de.none;var r=this.modifiers;if(r.isEmpty)return this.object.toDropShape(e);var n=t.duplicate(),a=new xe(de.none,n),i=w.empty;r.foreach(function(e){e.preprocess(a,i),i=i.prepend(e)});var o=this.object.toDropShape(a),s=n.c;if(void 0===s)return de.none;var h=n.originalReferencePoint;return(n=t.duplicate()).c=s,n.originalReferencePoint=h,a=new xe(de.none,n),o=r.head.modifyShape(a,o,r.tail),e.appendShapeToFront(o),t.c=n.c.move(t.c.x,t.c.y),o},toConnectShape:function(e){var t=e.env;if(void 0===t.c)return de.none;var r=this.modifiers;if(r.isEmpty)return this.object.toConnectShape(e);var n=t.duplicate(),a=new xe(de.none,n),i=w.empty;r.foreach(function(e){e.preprocess(a,i),i=i.prepend(e)});var o=this.object.toConnectShape(a);t.angle=n.angle,t.lastCurve=n.lastCurve;var s=n.c;if(void 0===s)return de.none;var h=n.originalReferencePoint;return(n=t.duplicate()).c=s,n.originalReferencePoint=h,a=new xe(de.none,n),o=r.head.modifyShape(a,o,r.tail),e.appendShapeToFront(o),t.c=n.c.move(t.c.x,t.c.y),o},boundingBox:function(e){var t=e.duplicateEnv(),r=t.env;return r.angle=0,r.p=r.c=ge.originPosition,t.shape=de.none,this.toDropShape(t).getBoundingBox()}}),ye(W.ObjectBox,{toConnectShape:function(e){var t=(r=e.env).c,r=e.env,n=(Q.measure.thickness,r.p.edgePoint(r.c.x,r.c.y)),a=r.c.edgePoint(r.p.x,r.p.y);if(n.x!==a.x||n.y!==a.y){var i=new fe.Line(n,a).toShape(e,this,"196883","");return r.originalReferencePoint=t,i}return r.angle=0,r.lastCurve=ve.none,r.originalReferencePoint=t,de.none},boundingBox:function(e){var t=e.duplicateEnv(),r=t.env;return r.angle=0,r.p=r.c=ge.originPosition,t.shape=de.none,this.toDropShape(t).getBoundingBox()}}),ye(W.ObjectBox.WrapUpObject,{toDropShape:function(e){var t=e.env,r=this.object.toDropShape(e);return t.originalReferencePoint=t.c,r},toConnectShape:function(e){var t=e.env,r=this.object.toConnectShape(e);return t.originalReferencePoint=t.c,r}}),ye(W.ObjectBox.CompositeObject,{toDropShape:function(e){var t=e.env,r=t.c;if(void 0===r)return de.none;var n=r,a=t.duplicate(),i=new xe(de.none,a);this.objects.foreach(function(e){a.c=r;var t=e.toDropShape(i);n=le.combineRect(n,a.c),n=le.combineRect(n,t.getBoundingBox().toPoint())}),t.c=n;var o=i.shape;return e.appendShapeToFront(o),t.originalReferencePoint=r,o}}),ye(W.ObjectBox.Xybox,{toDropShape:function(e){var t=e.env,r=t.c;if(void 0===r)return de.none;var n=new ge,a=new xe(de.none,n);this.posDecor.toShape(a);var i=a.shape,o=i.getBoundingBox();if(void 0===o)return de.none;var s=Math.max(0,o.l-o.x),h=Math.max(0,o.r+o.x),u=Math.max(0,o.u+o.y),c=Math.max(0,o.d-o.y);t.c=new le.Rect(r.x,r.y,{l:s,r:h,u,d:c}),t.originalReferencePoint=r;var m=new de.TranslateShape(r.x,r.y,i);return e.appendShapeToFront(m),m}}),ye(W.ObjectBox.Xymatrix,{toDropShape:function(e){var t=e.env,r=t.c,n=this.xymatrix.toShape(e);return t.originalReferencePoint=r,n}}),ye(W.ObjectBox.Text,{toDropShape:function(e){var t=e.env,r=new de.TextShape(t.c,this.math);return e.appendShapeToFront(r),t.c=r.getBoundingBox(),t.originalReferencePoint=r.getOriginalReferencePoint(),r}}),ye(W.ObjectBox.Empty,{toDropShape:function(e){var t=e.env;return t.originalReferencePoint=t.c,t.c=new le.Point(t.c.x,t.c.y),de.none}}),ye(W.ObjectBox.Txt,{toDropShape:function(e){var t=e.env;if(void 0===t.c)return de.none;var r=this.textObject.toDropShape(e);return t.originalReferencePoint=t.c,r}}),ye(W.ObjectBox.Txt.Width.Vector,{width:function(e){return this.vector.xy().x}}),ye(W.ObjectBox.Txt.Width.Default,{width:function(e){var t=e.env.c;return t.r+t.l}}),ye(W.ObjectBox.Cir,{toDropShape:function(e){var t=e.env;if(void 0===t.c)return de.none;t.originalReferencePoint=t.c;var r=this.radius.radius(e),n=t.c.x,a=t.c.y,i=this.cir.toDropShape(e,n,a,r);return t.c=new le.Ellipse(n,a,r,r,r,r),i},toConnectShape:function(e){var t=e.env;return t.originalReferencePoint=t.c,de.none}}),ye(W.ObjectBox.Cir.Radius.Vector,{radius:function(e){return this.vector.xy(e).x}}),ye(W.ObjectBox.Cir.Radius.Default,{radius:function(e){return e.env.c.r}}),ye(W.ObjectBox.Cir.Cir.Segment,{toDropShape:function(e,t,r,n){e.env;var a,i,o=this.startPointDegree(e),s=this.endPointDegree(e,o),h=s-o;if(0===(h=h<0?h+360:h))return de.none;"^"===this.orient?(a=h>180?"1":"0",i="0"):(a=h>180?"0":"1",i="1");var u=Math.PI/180,c=t+n*Math.cos(o*u),m=r+n*Math.sin(o*u),p=t+n*Math.cos(s*u),l=r+n*Math.sin(s*u),d=new de.CircleSegmentShape(t,r,c,m,n,a,i,p,l);return e.appendShapeToFront(d),d},startPointDegree:function(e){var t=this.startDiag.toString();return"^"===this.orient?this.diagToAngleACW(t):this.diagToAngleCW(t)},endPointDegree:function(e,t){var r=this.endDiag.toString();return"^"===this.orient?this.diagToAngleACW(r,t):this.diagToAngleCW(r,t)},diagToAngleACW:function(e,t){switch(e){case"l":return 90;case"r":return-90;case"d":return 180;case"u":return 0;case"dl":case"ld":return 135;case"dr":case"rd":return-135;case"ul":case"lu":return 45;case"ur":case"ru":return-45;default:return void 0!==t?t+180:0}},diagToAngleCW:function(e,t){switch(e){case"l":return-90;case"r":return 90;case"d":return 0;case"u":return 180;case"dl":case"ld":return-45;case"dr":case"rd":return 45;case"ul":case"lu":return-135;case"ur":case"ru":return 135;default:return void 0!==t?t+180:0}}}),ye(W.ObjectBox.Cir.Cir.Full,{toDropShape:function(e,t,r,n){var a=new de.FullCircleShape(t,r,n);return e.appendShapeToFront(a),a}}),ye(W.ObjectBox.Frame,{toDropShape:function(e){var t=e.env;return t.originalReferencePoint=t.c,this.toDropFilledShape(e,"currentColor",!1)},toDropFilledShape:function(e,t,r){var n=e.env.c;if(void 0===n)return de.none;var a=Q.measure.thickness,i=n.x,o=n.y,s=n.l,h=n.r,u=n.u,c=n.d,m=de.none;switch(this.main){case"--":var p=3*a;if(r){var l=this.radius.xy(e);m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,l.x,l.y,!1,t,Q.measure.em2px(p)+" "+Q.measure.em2px(p))}else{var d=this.radius.radius(e);m=new de.RectangleShape(i,o,s,h,u,c,d,!1,t,Q.measure.em2px(p)+" "+Q.measure.em2px(p))}break;case"==":p=3*a;if(r){l=this.radius.xy(e);m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,l.x,l.y,!0,t,Q.measure.em2px(p)+" "+Q.measure.em2px(p))}else{d=this.radius.radius(e);m=new de.RectangleShape(i,o,s,h,u,c,d,!0,t,Q.measure.em2px(p)+" "+Q.measure.em2px(p))}break;case"o-":p=3*a,d=Q.measure.lineElementLength;m=new de.RectangleShape(i,o,s,h,u,c,d,!1,t,Q.measure.em2px(p)+" "+Q.measure.em2px(p));break;case"oo":var x=(l=this.radius.xy(e)).x;m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,x,x,!0,t,void 0);break;case"ee":l=this.radius.xy(e);m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,l.x,l.y,!0,t,void 0);break;case"-,":var g=this.radius.depth(e);d=this.radius.radius(e);m=new de.CompositeShape(new de.RectangleShape(i,o,s,h,u,c,d,!1,t,void 0),new de.BoxShadeShape(i,o,s,h,u,c,g));break;case".o":x=(l=this.radius.xy(e)).x;m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,x,x,!1,t,Q.measure.dottedDasharray);break;case"-o":p=3*a,x=(l=this.radius.xy(e)).x;m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,x,x,!1,t,Q.measure.em2px(p)+" "+Q.measure.em2px(p));break;case".e":l=this.radius.xy(e);m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,l.x,l.y,!1,t,Q.measure.dottedDasharray);break;case"-e":p=3*a,l=this.radius.xy(e);m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,l.x,l.y,!1,t,Q.measure.em2px(p)+" "+Q.measure.em2px(p));break;case"-":if(r){l=this.radius.xy(e);m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,l.x,l.y,!1,t,void 0)}else{d=this.radius.radius(e);m=new de.RectangleShape(i,o,s,h,u,c,d,!1,t,void 0)}break;case"=":if(r){l=this.radius.xy(e);m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,l.x,l.y,!0,t,void 0)}else{d=this.radius.radius(e);m=new de.RectangleShape(i,o,s,h,u,c,d,!0,t,void 0)}break;case".":if(r){l=this.radius.xy(e);m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,l.x,l.y,!1,t,Q.measure.dottedDasharray)}else{d=this.radius.radius(e);m=new de.RectangleShape(i,o,s,h,u,c,d,!1,t,Q.measure.dottedDasharray)}break;case",":g=this.radius.depth(e);m=new de.BoxShadeShape(i,o,s,h,u,c,g,t);break;case"o":x=(l=this.radius.xy(e)).x;m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,x,x,!1,t,void 0);break;case"e":l=this.radius.xy(e);m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,l.x,l.y,!1,t,void 0);break;case"\\{":m=new de.LeftBrace(i-s,o,u,c,0,t);break;case"\\}":m=new de.LeftBrace(i+h,o,c,u,180,t);break;case"^\\}":case"^\\{":m=new de.LeftBrace(i,o+u,h,s,270,t);break;case"_\\{":case"_\\}":m=new de.LeftBrace(i,o-c,s,h,90,t);break;case"(":m=new de.LeftParenthesis(i-s,o+(u-c)/2,u+c,0,t);break;case")":m=new de.LeftParenthesis(i+h,o+(u-c)/2,u+c,180,t);break;case"^(":case"^)":m=new de.LeftParenthesis(i+(h-s)/2,o+u,s+h,270,t);break;case"_(":case"_)":m=new de.LeftParenthesis(i+(h-s)/2,o-c,s+h,90,t);break;case"*":if(n.isCircle()){l=this.radius.xy(e);m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,l.x,l.y,!1,"currentColor",void 0,t,!0)}else{d=this.radius.radius(e);m=new de.RectangleShape(i,o,s,h,u,c,d,!1,"currentColor",void 0,t,!0)}break;case"**":if(n.isCircle()){l=this.radius.xy(e);m=new de.EllipseShape(i+(h-s)/2,o+(u-c)/2,l.x,l.y,!1,"currentColor",void 0,t,!1)}else{d=this.radius.radius(e);m=new de.RectangleShape(i,o,s,h,u,c,d,!1,"currentColor",void 0,t,!1)}break;default:return de.none}return e.appendShapeToFront(m),m},toConnectShape:function(e){var t=e.env,r=t.c,n=t.p;void 0!==r&&void 0!==n||de.none,t.originalReferencePoint=r;var a=t.duplicate();a.c=n.combineRect(r);var i=new xe(de.none,a),o=this.toDropShape(i);return e.appendShapeToFront(o),o}}),ye(W.ObjectBox.Frame.Radius.Vector,{radius:function(e){return this.vector.xy(e).x},depth:function(e){return this.vector.xy(e).x},xy:function(e){return this.vector.xy(e)}}),ye(W.ObjectBox.Frame.Radius.Default,{radius:function(e){return 0},depth:function(e){return Q.measure.thickness/2},xy:function(e){var t=e.env.c;return{x:(t.l+t.r)/2,y:(t.u+t.d)/2}}}),ye(W.ObjectBox.Dir,{toDropShape:function(e){var t=e.env,r=t.c;t.originalReferencePoint=r;var n=t.angle;if(void 0===r)return de.none;t.c=new le.Point(r.x,r.y);Q.measure.thickness;var a=de.none;switch(this.main){case"":return de.none;case">":switch(this.variant){case"2":var i=(a=new de.GT2ArrowheadShape(r,n)).getRadius();t.c=new le.Ellipse(r.x,r.y,i,i,i,i);break;case"3":i=(a=new de.GT3ArrowheadShape(r,n)).getRadius();t.c=new le.Ellipse(r.x,r.y,i,i,i,i);break;default:a="^"===this.variant?new de.UpperGTArrowheadShape(r,n):"_"===this.variant?new de.LowerGTArrowheadShape(r,n):new de.GTArrowheadShape(r,n)}break;case"<":switch(this.variant){case"2":i=(a=new de.LT2ArrowheadShape(r,n)).getRadius();t.c=new le.Ellipse(r.x,r.y,i,i,i,i);break;case"3":i=(a=new de.LT3ArrowheadShape(r,n)).getRadius();t.c=new le.Ellipse(r.x,r.y,i,i,i,i);break;default:a="^"===this.variant?new de.UpperLTArrowheadShape(r,n):"_"===this.variant?new de.LowerLTArrowheadShape(r,n):new de.LTArrowheadShape(r,n)}break;case"|":switch(this.variant){case"^":a=new de.UpperColumnArrowheadShape(r,n);break;case"_":a=new de.LowerColumnArrowheadShape(r,n);break;case"2":a=new de.Column2ArrowheadShape(r,n);break;case"3":a=new de.Column3ArrowheadShape(r,n);break;default:a=new de.ColumnArrowheadShape(r,n)}break;case"(":switch(this.variant){case"^":a=new de.UpperLParenArrowheadShape(r,n);break;case"_":a=new de.LowerLParenArrowheadShape(r,n);break;default:a=new de.LParenArrowheadShape(r,n)}break;case")":switch(this.variant){case"^":a=new de.UpperRParenArrowheadShape(r,n);break;case"_":a=new de.LowerRParenArrowheadShape(r,n);break;default:a=new de.RParenArrowheadShape(r,n)}break;case"`":if("_"===this.variant)a=new de.LowerBackquoteArrowheadShape(r,n);else a=new de.UpperBackquoteArrowheadShape(r,n);break;case"'":if("_"===this.variant)a=new de.LowerQuoteArrowheadShape(r,n);else a=new de.UpperQuoteArrowheadShape(r,n);break;case"*":a=new de.AsteriskArrowheadShape(r,0);break;case"o":a=new de.OArrowheadShape(r,0);break;case"+":a=new de.PlusArrowheadShape(r,n);break;case"x":a=new de.XArrowheadShape(r,n);break;case"/":a=new de.SlashArrowheadShape(r,n);break;case"-":case"--":Q.measure.lineElementLength;a="3"===this.variant?new de.Line3ArrowheadShape(r,n):"2"===this.variant?new de.Line2ArrowheadShape(r,n):new de.LineArrowheadShape(r,n);break;case"=":case"==":a=new de.Line2ArrowheadShape(r,n);break;case".":case"..":a="3"===this.variant?new de.Dot3ArrowheadShape(r,n):"2"===this.variant?new de.Dot2ArrowheadShape(r,n):new de.DotArrowheadShape(r,n);break;case":":case"::":a=new de.Dot2ArrowheadShape(r,n);break;case"~":case"~~":a="3"===this.variant?new de.Tilde3ArrowheadShape(r,n):"2"===this.variant?new de.Tilde2ArrowheadShape(r,n):new de.TildeArrowheadShape(r,n);break;case">>":switch(this.variant){case"^":a=new de.UpperGTGTArrowheadShape(r,n);break;case"_":a=new de.LowerGTGTArrowheadShape(r,n);break;case"2":i=(a=new de.GTGT2ArrowheadShape(r,n)).getRadius();t.c=new le.Ellipse(r.x,r.y,i,i,i,i);break;case"3":i=(a=new de.GTGT3ArrowheadShape(r,n)).getRadius();t.c=new le.Ellipse(r.x,r.y,i,i,i,i);break;default:a=new de.GTGTArrowheadShape(r,n)}break;case"<<":switch(this.variant){case"^":a=new de.UpperLTLTArrowheadShape(r,n);break;case"_":a=new de.LowerLTLTArrowheadShape(r,n);break;case"2":i=(a=new de.LTLT2ArrowheadShape(r,n)).getRadius();t.c=new le.Ellipse(r.x,r.y,i,i,i,i);break;case"3":i=(a=new de.LTLT3ArrowheadShape(r,n)).getRadius();t.c=new le.Ellipse(r.x,r.y,i,i,i,i);break;default:a=new de.LTLTArrowheadShape(r,n)}break;case"||":switch(this.variant){case"^":a=new de.UpperColumnColumnArrowheadShape(r,n);break;case"_":a=new de.LowerColumnColumnArrowheadShape(r,n);break;case"2":a=new de.ColumnColumn2ArrowheadShape(r,n);break;case"3":a=new de.ColumnColumn3ArrowheadShape(r,n);break;default:a=new de.ColumnColumnArrowheadShape(r,n)}break;case"|-":switch(this.variant){case"^":a=new de.UpperColumnLineArrowheadShape(r,n);break;case"_":a=new de.LowerColumnLineArrowheadShape(r,n);break;case"2":a=new de.ColumnLine2ArrowheadShape(r,n);break;case"3":a=new de.ColumnLine3ArrowheadShape(r,n);break;default:a=new de.ColumnLineArrowheadShape(r,n)}break;case">|":a=new de.GTColumnArrowheadShape(r,n);break;case">>|":a=new de.GTGTColumnArrowheadShape(r,n);break;case"|<":a=new de.ColumnLTArrowheadShape(r,n);break;case"|<<":a=new de.ColumnLTLTArrowheadShape(r,n);break;case"//":a=new de.SlashSlashArrowheadShape(r,n);break;case"=>":a=new de.LineGT2ArrowheadShape(r,n);break;default:var o=Q.repositories.dirRepository.get(this.main);if(void 0===o)throw d("ExecutionError","\\dir "+this.variant+"{"+this.main+"} not defined.");a=o.toDropShape(e)}return e.appendShapeToFront(a),a},toConnectShape:function(e){var t=e.env;t.originalReferencePoint=t.c;Q.measure.thickness;var r=t.p.edgePoint(t.c.x,t.c.y),n=t.c.edgePoint(t.p.x,t.p.y);return r.x!==n.x||r.y!==n.y?new fe.Line(r,n).toShape(e,this,this.main,this.variant):(t.angle=0,t.lastCurve=ve.none,de.none)}}),ye(W.ObjectBox.Curve,{toDropShape:function(e){var t=e.env;return t.originalReferencePoint=t.c,de.none},toConnectShape:function(e){var t=e.env;t.originalReferencePoint=t.c;var r=void 0,n=void 0;this.objects.foreach(function(e){r=e.objectForDrop(r),n=e.objectForConnect(n)}),void 0===r&&void 0===n&&(n=new W.Object(w.empty,new W.ObjectBox.Dir("","-")));Q.measure.thickness;var a=t.c,i=t.p,o=[];this.poslist.foreach(function(t){t.addPositions(o,e)}),t.c=a,t.p=i;var s=de.none,h=i,u=a;switch(o.length){case 0:return h.x===u.x&&h.y===u.y?(t.lastCurve=ve.none,t.angle=0,de.none):void 0!==n?n.toConnectShape(e):r.toConnectShape(e);case 1:var c=(p=new fe.QuadBezier(h,o[0],u)).tOfShavedStart(h),m=p.tOfShavedEnd(u);if(void 0===c||void 0===m||c>=m)return t.angle=0,t.lastCurve=ve.none,de.none;s=p.toShape(e,r,n),t.lastCurve=new ve.QuadBezier(p,c,m,s),t.angle=Math.atan2(u.y-h.y,u.x-h.x);break;case 2:var p;c=(p=new fe.CubicBezier(h,o[0],o[1],u)).tOfShavedStart(h),m=p.tOfShavedEnd(u);if(void 0===c||void 0===m||c>=m)return t.angle=0,t.lastCurve=ve.none,de.none;s=p.toShape(e,r,n),t.lastCurve=new ve.CubicBezier(p,c,m,s),t.angle=Math.atan2(u.y-h.y,u.x-h.x);break;default:var l=new fe.CubicBSpline(h,o,u),d=new fe.CubicBeziers(l.toCubicBeziers());c=d.tOfShavedStart(h),m=d.tOfShavedEnd(u);if(void 0===c||void 0===m||c>=m)return t.angle=0,t.lastCurve=ve.none,de.none;s=d.toShape(e,r,n),t.lastCurve=new ve.CubicBSpline(h,u,d,c,m,s),t.angle=Math.atan2(u.y-h.y,u.x-h.x)}return s}}),ye(W.ObjectBox.Curve.Object.Drop,{objectForDrop:function(e){return this.object},objectForConnect:function(e){return e}}),ye(W.ObjectBox.Curve.Object.Connect,{objectForDrop:function(e){return e},objectForConnect:function(e){return this.object}}),ye(W.ObjectBox.Curve.PosList.CurPos,{addPositions:function(e,t){var r=t.env;e.push(r.c)}}),ye(W.ObjectBox.Curve.PosList.Pos,{addPositions:function(e,t){var r=t.env;this.pos.toShape(t),e.push(r.c)}}),ye(W.ObjectBox.Curve.PosList.AddStack,{addPositions:function(e,t){t.env.stack.reverse().foreach(function(t){e.push(t)})}}),ye(W.Coord.C,{position:function(e){return e.env.c}}),ye(W.Coord.P,{position:function(e){return e.env.p}}),ye(W.Coord.X,{position:function(e){var t=e.env,r=t.p,n=t.c,a=t.origin,i=t.xBase,o=n.y-r.y,s=r.x-n.x,h=n.x*r.y-n.y*r.x,u=i.y,c=-i.x,m=i.x*a.y-i.y*a.x,p=o*c-u*s;if(Math.abs(p)<oe.machinePrecision)return console.log("there is no intersection point."),ge.originPosition;var l=-(c*h-s*m)/p,d=(u*h-o*m)/p;return new le.Point(l,d)}}),ye(W.Coord.Y,{position:function(e){var t=e.env,r=t.p,n=t.c,a=t.origin,i=t.yBase,o=n.y-r.y,s=r.x-n.x,h=n.x*r.y-n.y*r.x,u=i.y,c=-i.x,m=i.x*a.y-i.y*a.x,p=o*c-u*s;if(Math.abs(p)<oe.machinePrecision)return console.log("there is no intersection point."),ge.originPosition;var l=-(c*h-s*m)/p,d=(u*h-o*m)/p;return new le.Point(l,d)}}),ye(W.Coord.Vector,{position:function(e){var t=this.vector.xy(e);return new le.Point(t.x,t.y)}}),ye(W.Coord.Id,{position:function(e){return e.env.lookupPos(this.id).position(e)}}),ye(W.Coord.Group,{position:function(e){var t=e.env,r=t.origin,n=t.xBase,a=t.yBase,i=t.p;return this.posDecor.toShape(e),t.p=i,t.origin=r,t.xBase=n,t.yBase=a,t.c}}),ye(W.Coord.StackPosition,{position:function(e){return e.env.stackAt(this.number)}}),ye(W.Coord.DeltaRowColumn,{position:function(e){var t=e.env,r=t.xymatrixRow,n=t.xymatrixCol;if(void 0===r||void 0===n)throw d("ExecutionError","xymatrix rows and columns not found for "+this.toSring());var a=this.prefix+(r+this.dr)+","+(n+this.dc);return e.env.lookupPos(a,'in entry "'+t.xymatrixRow+","+t.xymatrixCol+'": No '+this+" (is "+a+") from here.").position(e)}}),ye(W.Coord.Hops,{position:function(e){var t=e.env,r=t.xymatrixRow,n=t.xymatrixCol;if(void 0===r||void 0===n)throw d("ExecutionError","xymatrix rows and columns not found for "+this.toSring());this.hops.foreach(function(e){switch(e){case"u":r-=1;break;case"d":r+=1;break;case"l":n-=1;break;case"r":n+=1}});var a=this.prefix+r+","+n;return e.env.lookupPos(a,'in entry "'+t.xymatrixRow+","+t.xymatrixCol+'": No '+this+" (is "+a+") from here.").position(e)}}),ye(W.Coord.HopsWithPlace,{position:function(e){var t=e.env,r=t.xymatrixRow,n=t.xymatrixCol;if(void 0===r||void 0===n)throw d("ExecutionError","xymatrix rows and columns not found for "+this.toSring());this.hops.foreach(function(e){switch(e){case"u":r-=1;break;case"d":r+=1;break;case"l":n-=1;break;case"r":n+=1}});var a=this.prefix+r+","+n,i=e.env.lookupPos(a,'in entry "'+t.xymatrixRow+","+t.xymatrixCol+'": No '+this+" (is "+a+") from here.").position(e),o=(t.c,t.duplicate());o.p=t.c,o.c=i;var s,h=o.c.x-o.p.x,u=o.c.y-o.p.y;s=0===h&&0===u?0:Math.atan2(u,h),o.angle=s;var c=o.p.edgePoint(o.c.x,o.c.y),m=o.c.edgePoint(o.p.x,o.p.y);o.lastCurve=new ve.Line(c,m,o.p,o.c,void 0);var p=new xe(de.none,o),l=this.place.toShape(p);return o.lastCurve.position(l)}}),ye(W.Vector.InCurBase,{xy:function(e){return e.env.absVector(this.x,this.y)},angle:function(e){var t=e.env.absVector(this.x,this.y);return Math.atan2(t.y,t.x)}}),ye(W.Vector.Abs,{xy:function(e){return{x:Q.measure.length2em(this.x),y:Q.measure.length2em(this.y)}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),ye(W.Vector.Angle,{xy:function(e){var t=Math.PI/180*this.degree;return e.env.absVector(Math.cos(t),Math.sin(t))},angle:function(e){return Math.PI/180*this.degree}}),ye(W.Vector.Dir,{xy:function(e){var t=Q.measure.length2em(this.dimen),r=this.dir.angle(e);return{x:t*Math.cos(r),y:t*Math.sin(r)}},angle:function(e){return this.dir.angle(e)}}),ye(W.Vector.Corner,{xy:function(e){var t=this.corner.xy(e);return{x:t.x*this.factor,y:t.y*this.factor}},angle:function(e){return this.corner.angle(e)}}),ye(W.Corner.L,{xy:function(e){return{x:-e.env.c.l,y:0}},angle:function(e){return Math.PI}}),ye(W.Corner.R,{xy:function(e){return{x:e.env.c.r,y:0}},angle:function(e){return 0}}),ye(W.Corner.D,{xy:function(e){return{x:0,y:-e.env.c.d}},angle:function(e){return-Math.PI/2}}),ye(W.Corner.U,{xy:function(e){return{x:0,y:e.env.c.u}},angle:function(e){return Math.PI/2}}),ye(W.Corner.CL,{xy:function(e){var t=e.env.c;return{x:-t.l,y:(t.u-t.d)/2}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),ye(W.Corner.CR,{xy:function(e){var t=e.env.c;return{x:t.r,y:(t.u-t.d)/2}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),ye(W.Corner.CD,{xy:function(e){var t=e.env.c;return{x:(t.r-t.l)/2,y:-t.d}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),ye(W.Corner.CU,{xy:function(e){var t=e.env.c;return{x:(t.r-t.l)/2,y:t.u}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),ye(W.Corner.LU,{xy:function(e){var t=e.env.c;return{x:-t.l,y:t.u}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),ye(W.Corner.LD,{xy:function(e){var t=e.env.c;return{x:-t.l,y:-t.d}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),ye(W.Corner.RU,{xy:function(e){var t=e.env.c;return{x:t.r,y:t.u}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),ye(W.Corner.RD,{xy:function(e){var t=e.env.c;return{x:t.r,y:-t.d}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),ye(W.Corner.NearestEdgePoint,{xy:function(e){var t=e.env,r=t.c,n=r.edgePoint(t.p.x,t.p.y);return{x:n.x-r.x,y:n.y-r.y}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),ye(W.Corner.PropEdgePoint,{xy:function(e){var t=e.env,r=t.c,n=r.proportionalEdgePoint(t.p.x,t.p.y);return{x:n.x-r.x,y:n.y-r.y}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),ye(W.Corner.Axis,{xy:function(e){return{x:0,y:Q.measure.axisHeightLength}},angle:function(e){return Math.PI/2}}),ye(W.Modifier,{proceedModifyShape:function(e,t,r){return r.isEmpty?t:r.head.modifyShape(e,t,r.tail)}}),ye(W.Modifier.Vector,{preprocess:function(e,t){},modifyShape:function(e,t,r){var n=this.vector.xy(e),a=e.env;return a.c=a.c.shiftFrame(-n.x,-n.y),t=new de.TranslateShape(-n.x,-n.y,t),this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.RestoreOriginalRefPoint,{preprocess:function(e,t){},modifyShape:function(e,t,r){var n=e.env,a=n.originalReferencePoint;if(void 0!==a){var i=n.c.x-a.x,o=n.c.y-a.y;n.c=n.c.shiftFrame(i,o),t=new de.TranslateShape(i,o,t)}return this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Shape.Point,{preprocess:function(e,t){},modifyShape:function(e,t,r){var n=e.env.c;return e.env.c=new le.Point(n.x,n.y),this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Shape.Rect,{preprocess:function(e,t){},modifyShape:function(e,t,r){var n=e.env.c;return e.env.c=new le.Rect(n.x,n.y,{l:n.l,r:n.r,u:n.u,d:n.d}),this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Shape.Circle,{preprocess:function(e,t){},modifyShape:function(e,t,r){var n=e.env.c;return e.env.c=new le.Ellipse(n.x,n.y,n.l,n.r,n.u,n.d),this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Shape.L,{preprocess:function(e,t){},modifyShape:function(e,t,r){var n=e.env,a=n.c;if(void 0!==a){var i,o,s=a.r+a.l,h=a.u+a.d;s<h?(i=(a.l-a.r)/2,o=(a.d-a.u)/2):(i=-a.r+h/2,o=(a.d-a.u)/2),n.c=n.c.shiftFrame(i,o),t=new de.TranslateShape(i,o,t)}return this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Shape.R,{preprocess:function(e,t){},modifyShape:function(e,t,r){var n=e.env,a=n.c;if(void 0!==a){var i,o,s=a.r+a.l,h=a.u+a.d;s<h?(i=(a.l-a.r)/2,o=(a.d-a.u)/2):(i=a.l-h/2,o=(a.d-a.u)/2),n.c=n.c.shiftFrame(i,o),t=new de.TranslateShape(i,o,t)}return this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Shape.U,{preprocess:function(e,t){},modifyShape:function(e,t,r){var n=e.env,a=n.c;if(void 0!==a){var i,o,s=a.r+a.l;s>a.u+a.d?(i=(a.l-a.r)/2,o=(a.d-a.u)/2):(i=(a.l-a.r)/2,o=a.d-s/2),n.c=n.c.shiftFrame(i,o),t=new de.TranslateShape(i,o,t)}return this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Shape.D,{preprocess:function(e,t){},modifyShape:function(e,t,r){var n=e.env,a=n.c;if(void 0!==a){var i,o,s=a.r+a.l;s>a.u+a.d?(i=(a.l-a.r)/2,o=(a.d-a.u)/2):(i=(a.l-a.r)/2,o=-a.u+s/2),n.c=n.c.shiftFrame(i,o),t=new de.TranslateShape(i,o,t)}return this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Shape.C,{preprocess:function(e,t){},modifyShape:function(e,t,r){var n,a,i=e.env,o=i.c;void 0!==o&&(n=(o.l-o.r)/2,a=(o.d-o.u)/2,i.c=i.c.shiftFrame(n,a),t=new de.TranslateShape(n,a,t));return this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Shape.ChangeColor,{preprocess:function(e,t){},modifyShape:function(e,t,r){return t=this.proceedModifyShape(e,t,r),new de.ChangeColorShape(this.colorName,t)}}),ye(W.Modifier.Shape.Alphabets,{preprocess:function(e,t){var r=Q.repositories.modifierRepository.get(this.alphabets);if(void 0!==r)return r.preprocess(e,t)},modifyShape:function(e,t,r){var n=Q.repositories.modifierRepository.get(this.alphabets);if(void 0!==n)return n.modifyShape(e,t,r)}}),ye(W.Modifier.Shape.DefineShape,{preprocess:function(e,t){var r=t.reverse();Q.repositories.modifierRepository.put(this.shape,new W.Modifier.Shape.CompositeModifiers(r))},modifyShape:function(e,t,r){return this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Shape.CompositeModifiers,{preprocess:function(e,t){this.modifiers.foreach(function(r){r.preprocess(e,t),t=t.prepend(r)})},modifyShape:function(e,t,r){return t=this.proceedModifyShape(e,t,this.modifiers),this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Invisible,{preprocess:function(e,t){},modifyShape:function(e,t,r){return t=this.proceedModifyShape(e,t,r),de.none}}),ye(W.Modifier.Hidden,{preprocess:function(e,t){},modifyShape:function(e,t,r){return this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Direction,{preprocess:function(e,t){e.env.angle=this.direction.angle(e)},modifyShape:function(e,t,r){return e.env.angle=this.direction.angle(e),this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.AddOp,{preprocess:function(e,t){},modifyShape:function(e,t,r){var n=e.env.c;return e.env.c=this.op.apply(this.size,n,e),e.appendShapeToFront(new de.InvisibleBoxShape(e.env.c)),this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.AddOp.Grow,{apply:function(e,t,r){var n=r.env,a=e.isDefault?{x:2*n.objectmargin,y:2*n.objectmargin}:e.vector.xy(r),i=Math.abs(a.x/2),o=Math.abs(a.y/2);return t.grow(i,o)},applyToDimen:function(e,t){return e+t}}),ye(W.Modifier.AddOp.Shrink,{apply:function(e,t,r){var n=r.env,a=e.isDefault?{x:2*n.objectmargin,y:2*n.objectmargin}:e.vector.xy(r),i=-Math.abs(a.x/2),o=-Math.abs(a.y/2);return t.grow(i,o)},applyToDimen:function(e,t){return e-t}}),ye(W.Modifier.AddOp.Set,{apply:function(e,t,r){var n=r.env,a=e.isDefault?{x:n.objectwidth,y:n.objectheight}:e.vector.xy(r),i=Math.abs(a.x),o=Math.abs(a.y);return t.toSize(i,o)},applyToDimen:function(e,t){return t}}),ye(W.Modifier.AddOp.GrowTo,{apply:function(e,t,r){var n=Math.max(t.l+t.r,t.u+t.d),a=e.isDefault?{x:n,y:n}:e.vector.xy(r),i=Math.abs(a.x),o=Math.abs(a.y);return t.growTo(i,o)},applyToDimen:function(e,t){return Math.max(Math.max(e,t),0)}}),ye(W.Modifier.AddOp.ShrinkTo,{apply:function(e,t,r){var n=Math.min(t.l+t.r,t.u+t.d),a=e.isDefault?{x:n,y:n}:e.vector.xy(r),i=Math.abs(a.x),o=Math.abs(a.y);return t.shrinkTo(i,o)},applyToDimen:function(e,t){return Math.max(Math.min(e,t),0)}}),ye(W.Modifier.Shape.Frame,{preprocess:function(e,t){},modifyShape:function(e,t,r){var n=e.env;if(void 0!==n.c){this.main;var a=new W.ObjectBox.Frame.Radius.Default,i="currentColor";this.options.foreach(function(e){a=e.getRadius(a)}),this.options.foreach(function(e){i=e.getColorName(i)});var o=n.duplicate(),s=new xe(de.none,o),h=new W.ObjectBox.Frame(a,this.main).toDropFilledShape(s,i,n.c.isCircle());t=new de.CompositeShape(t,h)}return this.proceedModifyShape(e,t,r)}}),ye(W.Modifier.Shape.Frame.Radius,{getRadius:function(e){return new W.ObjectBox.Frame.Radius.Vector(this.vector)},getColorName:function(e){return e}}),ye(W.Modifier.Shape.Frame.Color,{getRadius:function(e){return e},getColorName:function(e){return this.colorName}}),ye(W.Direction.Compound,{angle:function(e){var t=this.dir.angle(e);return this.rots.foreach(function(r){t=r.rotate(t,e)}),t}}),ye(W.Direction.Diag,{angle:function(e){return this.diag.angle(e)}}),ye(W.Direction.Vector,{angle:function(e){return this.vector.angle(e)}}),ye(W.Direction.ConstructVector,{angle:function(e){var t=e.env,r=t.origin,n=t.xBase,a=t.yBase,i=t.p,o=t.c;this.posDecor.toShape(e);var s=Math.atan2(t.c.y-t.p.y,t.c.x-t.p.x);return t.c=o,t.p=i,t.origin=r,t.xBase=n,t.yBase=a,s}}),ye(W.Direction.RotVector,{rotate:function(e,t){return e+this.vector.angle(t)}}),ye(W.Direction.RotCW,{rotate:function(e,t){return e+Math.PI/2}}),ye(W.Direction.RotAntiCW,{rotate:function(e,t){return e-Math.PI/2}}),ye(W.Diag.Default,{isEmpty:!0,angle:function(e){return e.env.angle}}),ye(W.Diag.Angle,{isEmpty:!1,angle:function(e){return this.ang}}),ye(W.Decor,{toShape:function(e){this.commands.foreach(function(t){t.toShape(e)})}}),ye(W.Command.Save,{toShape:function(e){e.env.saveState(),this.pos.toShape(e)}}),ye(W.Command.Restore,{toShape:function(e){e.env.restoreState()}}),ye(W.Command.Pos,{toShape:function(e){this.pos.toShape(e)}}),ye(W.Command.AfterPos,{toShape:function(e){this.pos.toShape(e),this.decor.toShape(e)}}),ye(W.Command.Drop,{toShape:function(e){this.object.toDropShape(e)}}),ye(W.Command.Connect,{toShape:function(e){this.object.toConnectShape(e)}}),ye(W.Command.Relax,{toShape:function(e){}}),ye(W.Command.Ignore,{toShape:function(e){}}),ye(W.Command.ShowAST,{toShape:function(e){console.log(this.pos.toString()+" "+this.decor)}}),ye(W.Command.Ar,{toShape:function(e){var t=e.env,r=t.origin,n=t.xBase,a=t.yBase,i=t.p,o=t.c;t.pathActionForBeforeSegment=x.empty,t.pathActionForAfterSegment=x.empty,t.labelsForNextSegmentOnly=x.empty,t.labelsForLastSegmentOnly=x.empty,t.labelsForEverySegment=x.empty,t.segmentSlideEm=x.empty,t.lastTurnDiag=x.empty,t.arrowVariant="",t.tailTip=new W.Command.Ar.Form.Tip.Tipchars(""),t.headTip=new W.Command.Ar.Form.Tip.Tipchars(">"),t.stemConn=new W.Command.Ar.Form.Conn.Connchars("-"),t.reverseAboveAndBelow=!1,t.arrowObjectModifiers=w.empty,this.forms.foreach(function(t){t.toShape(e)}),t.pathActionForBeforeSegment.isDefined||(t.pathActionForBeforeSegment=new x.Some(new W.PosDecor(new W.Pos.Coord(new W.Coord.C,w.empty.append(new W.Pos.ConnectObject(new W.Object(t.arrowObjectModifiers,t.stemConn.getObject(e))))),new W.Decor(w.empty)))),t.labelsForNextSegmentOnly=new x.Some(new W.Command.Path.Labels(w.empty.append(new W.Command.Path.Label.At(new W.Pos.Place(new W.Place(1,1,new W.Place.Factor(0),new W.Slide(x.empty))),t.tailTip.getObject(e),x.empty)))),t.labelsForLastSegmentOnly=new x.Some(new W.Command.Path.Labels(w.empty.append(new W.Command.Path.Label.At(new W.Pos.Place(new W.Place(1,1,new W.Place.Factor(1),new W.Slide(x.empty))),t.headTip.getObject(e),x.empty)))),this.path.toShape(e),t.c=o,t.p=i,t.origin=r,t.xBase=n,t.yBase=a}}),ye(W.Command.Ar.Form.BuildArrow,{toShape:function(e){var t=e.env;t.arrowVariant=this.variant,t.tailTip=this.tailTip,t.stemConn=this.stemConn,t.headTip=this.headTip}}),ye(W.Command.Ar.Form.ChangeVariant,{toShape:function(e){e.env.arrowVariant=this.variant}}),ye(W.Command.Ar.Form.ChangeStem,{toShape:function(e){e.env.stemConn=new W.Command.Ar.Form.Conn.Connchars(this.connchar)}}),ye(W.Command.Ar.Form.DashArrowStem,{toShape:function(e){}}),ye(W.Command.Ar.Form.CurveArrow,{toShape:function(e){var t=e.env,r=Q.measure.em2length(2*Q.measure.length2em(this.dist));t.pathActionForBeforeSegment=new x.Some(new W.PosDecor(new W.Pos.Coord(new W.Coord.C,w.empty.append(new W.Pos.ConnectObject(new W.Object(t.arrowObjectModifiers,new W.ObjectBox.Curve(w.empty,w.empty.append(new W.ObjectBox.Curve.Object.Connect(t.stemConn.getObject(e))),w.empty.append(new W.ObjectBox.Curve.PosList.Pos(new W.Pos.Coord(new W.Coord.Group(new W.PosDecor(new W.Pos.Coord(new W.Coord.C,w.empty.append(new W.Pos.ConnectObject(new W.Object(w.empty,new W.ObjectBox.Dir("","")))).append(new W.Pos.Place(new W.Place(0,0,void 0,new W.Slide(x.empty)))).append(new W.Pos.Plus(new W.Coord.Vector(new W.Vector.Dir(this.direction,r))))),new W.Decor(w.empty))),w.empty)))))))),new W.Decor(w.empty)))}}),ye(W.Command.Ar.Form.CurveFitToDirection,{toShape:function(e){var t=e.env;t.pathActionForBeforeSegment=new x.Some(new W.PosDecor(new W.Pos.Coord(new W.Coord.C,w.empty.append(new W.Pos.ConnectObject(new W.Object(t.arrowObjectModifiers,new W.ObjectBox.Curve(w.empty,w.empty.append(new W.ObjectBox.Curve.Object.Connect(t.stemConn.getObject(e))),w.empty.append(new W.ObjectBox.Curve.PosList.Pos(new W.Pos.Coord(new W.Coord.C,w.empty.append(new W.Pos.SwapPAndC(new W.Coord.C)).append(new W.Pos.Plus(new W.Coord.Vector(new W.Vector.Dir(this.outDirection,"3pc"))))))).append(new W.ObjectBox.Curve.PosList.Pos(new W.Pos.Coord(new W.Coord.C,w.empty.append(new W.Pos.SwapPAndC(new W.Coord.C)).append(new W.Pos.Plus(new W.Coord.Vector(new W.Vector.Dir(this.inDirection,"3pc")))))))))))),new W.Decor(w.empty)))}}),ye(W.Command.Ar.Form.CurveWithControlPoints,{toShape:function(e){var t=e.env,r=t.duplicate();r.startCapturePositions();var n=new xe(de.none,r);this.coord.position(n);var a=r.endCapturePositions();a=a.append(r.c);var i=w.empty;a.reverse().foreach(function(e){var r=t.inverseAbsVector(e.x,e.y);i=i.prepend(new W.ObjectBox.Curve.PosList.Pos(new W.Pos.Coord(new W.Coord.Vector(new W.Vector.InCurBase(r.x,r.y)),w.empty)))}),t.pathActionForBeforeSegment=new x.Some(new W.PosDecor(new W.Pos.Coord(new W.Coord.C,w.empty.append(new W.Pos.ConnectObject(new W.Object(t.arrowObjectModifiers,new W.ObjectBox.Curve(w.empty,w.empty.append(new W.ObjectBox.Curve.Object.Connect(t.stemConn.getObject(e))),i))))),new W.Decor(w.empty)))}}),ye(W.Command.Ar.Form.AddShape,{toShape:function(e){e.env.arrowObjectModifiers=w.empty.append(this.shape)}}),ye(W.Command.Ar.Form.AddModifiers,{toShape:function(e){e.env.arrowObjectModifiers=this.modifiers}}),ye(W.Command.Ar.Form.Slide,{toShape:function(e){e.env.segmentSlideEm=new x.Some(Q.measure.length2em(this.slideDimen))}}),ye(W.Command.Ar.Form.LabelAt,{toShape:function(e){e.env.labelsForEverySegment=new x.Some(new W.Command.Path.Labels(w.empty.append(new W.Command.Path.Label.At(new W.Pos.Place(this.anchor),this.it,x.empty))))}}),ye(W.Command.Ar.Form.LabelAbove,{toShape:function(e){var t,r=e.env;t=r.reverseAboveAndBelow?new W.Command.Path.Label.Below(new W.Pos.Place(this.anchor),this.it,x.empty):new W.Command.Path.Label.Above(new W.Pos.Place(this.anchor),this.it,x.empty),r.labelsForEverySegment=new x.Some(new W.Command.Path.Labels(w.empty.append(t)))}}),ye(W.Command.Ar.Form.LabelBelow,{toShape:function(e){var t,r=e.env;t=r.reverseAboveAndBelow?new W.Command.Path.Label.Above(new W.Pos.Place(this.anchor),this.it,x.empty):new W.Command.Path.Label.Below(new W.Pos.Place(this.anchor),this.it,x.empty),r.labelsForEverySegment=new x.Some(new W.Command.Path.Labels(w.empty.append(t)))}}),ye(W.Command.Ar.Form.ReverseAboveAndBelow,{toShape:function(e){e.env.reverseAboveAndBelow=!0}}),ye(W.Command.Ar.Form.Conn.Connchars,{getObject:function(e){var t=e.env,r=new W.ObjectBox.Dir(t.arrowVariant,this.connchars);return new W.Object(t.arrowObjectModifiers,r)}}),ye(W.Command.Ar.Form.Conn.Object,{getObject:function(e){var t=e.env.arrowObjectModifiers.concat(this.object.modifiers);return new W.Object(t,this.object.object)}}),ye(W.Command.Ar.Form.Conn.Dir,{getObject:function(e){var t=e.env,r=this.dir,n=r;return""===r.variant&&""!==t.arrowVariant&&(n=new W.ObjectBox.Dir(t.arrowVariant,r.main)),new W.Object(t.arrowObjectModifiers,n)}}),ye(W.Command.Ar.Form.Tip.Tipchars,{getObject:function(e){var t=e.env,r=new W.ObjectBox.Dir(t.arrowVariant,this.tipchars);return new W.Object(t.arrowObjectModifiers,r)}}),ye(W.Command.Ar.Form.Tip.Object,{getObject:function(e){var t=e.env.arrowObjectModifiers.concat(this.object.modifiers);return new W.Object(t,this.object.object)}}),ye(W.Command.Ar.Form.Tip.Dir,{getObject:function(e){var t=e.env,r=this.dir,n=r;return""===r.variant&&""!==t.arrowVariant&&(n=new W.ObjectBox.Dir(t.arrowVariant,r.main)),new W.Object(t.arrowObjectModifiers,n)}}),ye(W.Command.Path,{toShape:function(e){var t=e.env,r=t.origin,n=t.xBase,a=t.yBase,i=t.p,o=t.c;t.pathActionForBeforeSegment=x.empty,t.pathActionForAfterSegment=x.empty,t.labelsForNextSegmentOnly=x.empty,t.labelsForLastSegmentOnly=x.empty,t.labelsForEverySegment=x.empty,t.segmentSlideEm=x.empty,t.lastTurnDiag=x.empty,this.path.toShape(e),t.c=o,t.p=i,t.origin=r,t.xBase=n,t.yBase=a}}),ye(W.Command.AfterPath,{toShape:function(e){this.path.toShape(e),this.decor.toShape(e)}}),ye(W.Command.Path.Path,{toShape:function(e){this.pathElements.foreach(function(t){t.toShape(e)})}}),ye(W.Command.Path.SetBeforeAction,{toShape:function(e){e.env.pathActionForBeforeSegment=new x.Some(this.posDecor)}}),ye(W.Command.Path.SetAfterAction,{toShape:function(e){e.env.pathActionForAfterSegment=new x.Some(this.posDecor)}}),ye(W.Command.Path.AddLabelNextSegmentOnly,{toShape:function(e){e.env.labelsForNextSegmentOnly=new x.Some(this.labels)}}),ye(W.Command.Path.AddLabelLastSegmentOnly,{toShape:function(e){e.env.labelsForLastSegmentOnly=new x.Some(this.labels)}}),ye(W.Command.Path.AddLabelEverySegment,{toShape:function(e){e.env.labelsForEverySegment=new x.Some(this.labels)}}),ye(W.Command.Path.StraightSegment,{toShape:function(e){var t=e.env;this.segment.setupPositions(e);var r=t.c;t.pathActionForBeforeSegment.foreach(function(t){t.toShape(e)}),t.labelsForNextSegmentOnly.foreach(function(r){r.toShape(e),t.labelsForNextSegmentOnly=x.empty}),t.labelsForEverySegment.foreach(function(t){t.toShape(e)}),t.c=r,t.pathActionForAfterSegment.foreach(function(t){t.toShape(e)}),this.segment.toLabelsShape(e)}}),ye(W.Command.Path.LastSegment,{toShape:function(e){var t=e.env;this.segment.setupPositions(e);var r=t.c;t.pathActionForBeforeSegment.foreach(function(t){t.toShape(e)}),t.labelsForNextSegmentOnly.foreach(function(r){r.toShape(e),t.labelsForNextSegmentOnly=x.empty}),t.labelsForLastSegmentOnly.foreach(function(r){r.toShape(e),t.labelsForNextSegmentOnly=x.empty}),t.labelsForEverySegment.foreach(function(t){t.toShape(e)}),t.c=r,t.pathActionForAfterSegment.foreach(function(t){t.toShape(e)}),this.segment.toLabelsShape(e)}}),ye(W.Command.Path.TurningSegment,{toShape:function(e){var t=e.env,r=t.c;this.segment.pos.toShape(e),t.p=r;var n=this.turn.explicitizedCircle(e),a=this.turn.radius.radius(e);t.lastTurnDiag=new x.Some(n.endDiag);var i=n.startVector(e),o=n.endVector(e),s=t.segmentSlideEm.getOrElse(0);this.segment.slide.dimen.foreach(function(e){s=Q.measure.length2em(e),t.segmentSlideEm=new x.Some(s)}),0!==s&&(t.p=t.p.move(t.p.x-s*i.y,t.p.y+s*i.x),t.c=t.c.move(t.c.x-s*o.y,t.c.y+s*o.x),a="^"===n.orient?Math.max(0,a-s):Math.max(0,a+s));var h,u=t.p.edgePoint(t.p.x+i.x,t.p.y+i.y),c=t.c,m=n.relativeStartPoint(e,a),p=n.relativeEndPoint(e,a),l=n.relativeEndPoint(e,a+("^"===n.orient?s:-s)),d=i.x*o.y-i.y*o.x;if(Math.abs(d)<oe.machinePrecision)h=0;else{var g=c.x-u.x+m.x-p.x,f=c.y-u.y+m.y-p.y;(h=(o.y*g-o.x*f)/d)<0&&(h=0)}var w=u.x-m.x+h*i.x,v=u.y-m.y+h*i.y,S=(n.toDropShape(e,w,v,a),new le.Point(w+l.x,v+l.y));t.c=new le.Point(w+m.x,v+m.y),t.pathActionForBeforeSegment.foreach(function(t){t.toShape(e)}),t.labelsForNextSegmentOnly.foreach(function(r){r.toShape(e),t.labelsForNextSegmentOnly=x.empty}),t.labelsForEverySegment.foreach(function(t){t.toShape(e)}),t.c=S,t.pathActionForAfterSegment.foreach(function(t){t.toShape(e)}),this.segment.toLabelsShape(e)}}),ye(W.Command.Path.Turn.Cir,{explicitizedCircle:function(e){var t,r,n,a=e.env;return t=this.cir.startDiag.isEmpty?a.lastTurnDiag.getOrElse(new W.Diag.R):this.cir.startDiag,r=this.cir.orient,n=this.cir.endDiag.isEmpty?t.turn(r):this.cir.endDiag,new W.ObjectBox.Cir.Cir.Segment(t,r,n)}}),ye(W.ObjectBox.Cir.Cir.Segment,{startVector:function(e){var t=this.startDiag.angle(e);return{x:Math.cos(t),y:Math.sin(t)}},endVector:function(e){var t=this.endDiag.angle(e);return{x:Math.cos(t),y:Math.sin(t)}},relativeStartPointAngle:function(e){return this.startPointDegree(e)/180*Math.PI},relativeStartPoint:function(e,t){var r=this.startPointDegree(e)/180*Math.PI;return{x:t*Math.cos(r),y:t*Math.sin(r)}},relativeEndPoint:function(e,t){var r;return r=this.endPointDegree(e,this.relativeStartPointAngle(e))/180*Math.PI,{x:t*Math.cos(r),y:t*Math.sin(r)}}}),ye(W.Command.Path.Turn.Diag,{explicitizedCircle:function(e){var t,r,n,a=e.env,i=(t=this.diag.isEmpty?a.lastTurnDiag.getOrElse(new W.Diag.R):this.diag).angle(e);return r=(a.c.x-a.p.x)*Math.sin(i)-(a.c.y-a.p.y)*Math.cos(i)<0?"^":"_",n=t.turn(r),new W.ObjectBox.Cir.Cir.Segment(t,r,n)}}),ye(W.Command.Path.TurnRadius.Default,{radius:function(e){return Q.measure.turnradius}}),ye(W.Command.Path.TurnRadius.Dimen,{radius:function(e){return Q.measure.length2em(this.dimen)}}),ye(W.Command.Path.Segment,{setupPositions:function(e){var t=e.env;t.p=t.c,this.pos.toShape(e);var r=t.p,n=t.c,a=n.x-r.x,i=n.y-r.y,o=Math.atan2(i,a)+Math.PI/2,s=t.segmentSlideEm.getOrElse(0);this.slide.dimen.foreach(function(e){s=Q.measure.length2em(e),t.segmentSlideEm=new x.Some(s)}),0!==s&&(r=r.move(r.x+s*Math.cos(o),r.y+s*Math.sin(o)),n=n.move(n.x+s*Math.cos(o),n.y+s*Math.sin(o))),t.p=r,t.c=n},toLabelsShape:function(e){var t=e.env,r=t.c,n=t.p;this.labels.toShape(e),t.c=r,t.p=n}}),ye(W.Command.Path.Labels,{toShape:function(e){this.labels.foreach(function(t){t.toShape(e)})}}),ye(W.Command.Path.Label,{toShape:function(e){var t=e.env,r=t.p,n=t.c,a=this.anchor.toShape(e),i=this.getLabelMargin(e);if(0!==i){var o;o=(S=t.lastCurve).isNone?Math.atan2(n.y-r.y,n.x-r.x)+Math.PI/2:S.angle(a)+Math.PI/2+(i>0?0:Math.PI);n=t.c;var s=new xe(de.none,t);this.it.toDropShape(s);var h=s.shape,u=h.getBoundingBox();if(void 0!==u){var c=u.x-n.x,m=u.y-n.y,p=u.l,l=u.r,d=u.u,x=u.d,g=Math.cos(o),f=Math.sin(o),w=Math.min((c-p)*g+(m-x)*f,(c-p)*g+(m+d)*f,(c+l)*g+(m-x)*f,(c+l)*g+(m+d)*f),v=Math.abs(i)-w;t.c=t.c.move(n.x+v*g,n.y+v*f),e.appendShapeToFront(new de.TranslateShape(v*g,v*f,h))}}else this.it.toDropShape(e);var S=t.lastCurve;this.shouldSliceHole&&S.isDefined&&void 0!==a&&S.sliceHole(t.c,a),this.aliasOption.foreach(function(e){t.savePos(e,new Se.Position(t.c))})}}),ye(W.Command.Path.Label.Above,{getLabelMargin:function(e){return e.env.labelmargin},shouldSliceHole:!1}),ye(W.Command.Path.Label.Below,{getLabelMargin:function(e){return-e.env.labelmargin},shouldSliceHole:!1}),ye(W.Command.Path.Label.At,{getLabelMargin:function(e){return 0},shouldSliceHole:!0}),ye(W.Command.Xymatrix,{toShape:function(e){var t=e.env;if(void 0===t.c)return de.none;var r=t.duplicate(),n=new xe(de.none,r);r.xymatrixPrefix="",r.xymatrixRowSepEm=Q.measure.length2em("2pc"),r.xymatrixColSepEm=Q.measure.length2em("2pc"),r.xymatrixPretendEntryHeight=x.empty,r.xymatrixPretendEntryWidth=x.empty,r.xymatrixFixedRow=!1,r.xymatrixFixedCol=!1,r.xymatrixOrientationAngle=0,r.xymatrixEntryModifiers=w.empty,this.setup.foreach(function(e){e.toShape(n)});var a,i,o=r.xymatrixOrientationAngle,s=0,h=0,u=new Ce(this.rows.map(function(e){h+=1,i=0;var t=new Ce.Row(e.entries.map(function(e){i+=1;var t=r.duplicate();t.origin={x:0,y:0},t.p=t.c=ge.originPosition,t.angle=0,t.lastCurve=ve.none,t.xymatrixRow=h,t.xymatrixCol=i;var n,a,o,s,u=new xe(de.none,t),c=e.toShape(u),m=t.c;if(r.xymatrixPretendEntryHeight.isDefined){var p=r.xymatrixPretendEntryHeight.get;o=p/2,s=p/2}else o=m.u,s=m.d;if(r.xymatrixPretendEntryWidth.isDefined){var l=r.xymatrixPretendEntryWidth.get;n=l/2,a=l/2}else n=m.l,a=m.r;var d=new le.Rect(0,0,{l:n,r:a,u:o,d:s});return new Ce.Entry(t.c,c,e.decor,d)}),o);return s=Math.max(s,i),t}),o);if(0===(a=h))return de.none;u.rows.foreach(function(e){i=0,e.entries.foreach(function(e){i+=1,u.getColumn(i).addEntry(e)})});var c,m,p=r.xymatrixColSepEm,l=[],d=t.c.x;if(l.push(d),r.xymatrixFixedCol){var g=0,f=0;u.columns.foreach(function(e){g=Math.max(g,e.getL()),f=Math.max(f,e.getR())}),u.columns.tail.foreach(function(e){d=d+f+p+g,l.push(d)}),c=g,m=l[l.length-1]+f}else{var v=u.columns.head;u.columns.tail.foreach(function(e){d=d+v.getR()+p+e.getL(),l.push(d),v=e}),c=u.columns.head.getL(),m=d+u.columns.at(s-1).getR()-l[0]}var S,y,C=r.xymatrixRowSepEm,b=[],M=t.c.y;if(b.push(M),r.xymatrixFixedRow){var P=0,B=0;u.rows.foreach(function(e){P=Math.max(P,e.getU()),B=Math.max(B,e.getD())}),u.rows.tail.foreach(function(e){M-=B+C+P,b.push(M)}),S=P,y=b[0]-b[b.length-1]+B}else{var A=u.rows.head;u.rows.tail.foreach(function(e){M-=A.getD()+C+e.getU(),b.push(M),A=e}),S=u.rows.head.getU(),y=b[0]-M+u.rows.at(a-1).getD()}t.c=new le.Rect(t.c.x,t.c.y,{l:c,r:m,u:S,d:y});var L=r.xymatrixPrefix,E=Math.cos(o),O=Math.sin(o),k=0;u.rows.foreach(function(e){var t=0;e.entries.foreach(function(e){var n=l[t],a=b[k],i=n*E-a*O,o=n*O+a*E,s=t+1,h=k+1,u=new Se.Position(e.c.move(i,o));r.savePos(h+","+s,u),r.savePos(L+h+","+s,u),t+=1}),k+=1}),n=new xe(de.none,r);k=0;u.rows.foreach(function(e){var t=0;e.entries.foreach(function(e){var a=l[t],i=b[k],o=a*E-i*O,s=a*O+i*E,h=t+1,u=k+1,c=new de.TranslateShape(o,s,e.objectShape);n.appendShapeToFront(c),r.c=e.c.move(o,s),r.xymatrixRow=u,r.xymatrixCol=h,e.decor.toShape(n),t+=1}),k+=1});var D=n.shape;return e.appendShapeToFront(D),t.savedPosition=r.savedPosition,D}});class Ce{constructor(e,t){this.rows=e,this.columns=w.empty,this.orientation=t}getColumn(e){if(this.columns.length()>=e)return this.columns.at(e-1);var t=new Ce.Column(this.orientation);return this.columns=this.columns.append(t),t}toString(){return"Xymatrix{\n"+this.rows.mkString("\\\\\n")+"\n}"}}function be(e,t,r){const n=[],a=[],i={lastNoSuccess:void 0,whiteSpaceRegex:oe.whiteSpaceRegex,createTextNode:function(t){const r=new u(t,e.stack.env,e.configuration).mml(),i=Q.textObjectIdCounter;return Q.textObjectIdCounter++,n.push(r),a.push(i),r}},o=new P(e.string,e.i,i),s=B.parse(t,o);if(e.i=s.next.offset,s.successful){const t=""+Q.xypicCommandIdCounter;Q.xypicCommandIdCounter++,Q.xypicCommandMap[t]=s.get();const i=JSON.stringify(a);return e.create(r,{"data-cmd-id":t,"data-text-mml-ids":i},n)}{const e=i.lastNoSuccess.next.pos().lineContents();throw d("SyntaxError",i.lastNoSuccess.msg+'. Parse error at or near "'+e+'".')}}Ce.Row=class{constructor(e,t){this.entries=e,this.orientation=t,ce(this,"getU"),ce(this,"getD")}getU(){var e=this.orientation,t=0;return this.entries.foreach(function(r){t=Math.max(t,r.getU(e))}),t}getD(){var e=this.orientation,t=0;return this.entries.foreach(function(r){t=Math.max(t,r.getD(e))}),t}toString(){return this.entries.mkString(" & ")}},Ce.Column=class{constructor(e){this.entries=w.empty,this.orientation=e,ce(this,"getL"),ce(this,"getR")}addEntry(e){this.entries=this.entries.append(e),this.getL.reset,this.getR.reset}getL(){var e=this.orientation,t=0;return this.entries.foreach(function(r){t=Math.max(t,r.getL(e))}),t}getR(){var e=this.orientation,t=0;return this.entries.foreach(function(r){t=Math.max(t,r.getR(e))}),t}toString(){return this.entries.mkString(" \\\\ ")}},Ce.Entry=class{constructor(e,t,r,n){this.c=e,this.objectShape=t,this.decor=r,this.frame=n}getDistanceToEdgePoint(e,t){var r=e.edgePoint(e.x+Math.cos(t),e.y+Math.sin(t)),n=r.x-e.x,a=r.y-e.y;return Math.sqrt(n*n+a*a)}getU(e){return 0===e?this.frame.u:this.getDistanceToEdgePoint(this.frame,e+Math.PI/2)}getD(e){return 0===e?this.frame.d:this.getDistanceToEdgePoint(this.frame,e-Math.PI/2)}getL(e){return 0===e?this.frame.l:this.getDistanceToEdgePoint(this.frame,e+Math.PI)}getR(e){return 0===e?this.frame.r:this.getDistanceToEdgePoint(this.frame,e)}toString(){return this.objectShape.toString()+" "+this.decor}},ye(W.Command.Xymatrix.Setup.Prefix,{toShape:function(e){e.env.xymatrixPrefix=this.prefix}}),ye(W.Command.Xymatrix.Setup.ChangeSpacing.Row,{toShape:function(e){var t=e.env;t.xymatrixRowSepEm=this.addop.applyToDimen(t.xymatrixRowSepEm,Q.measure.length2em(this.dimen))}}),ye(W.Command.Xymatrix.Setup.ChangeSpacing.Column,{toShape:function(e){var t=e.env;t.xymatrixColSepEm=this.addop.applyToDimen(t.xymatrixColSepEm,Q.measure.length2em(this.dimen))}}),ye(W.Command.Xymatrix.Setup.ChangeSpacing.RowAndColumn,{toShape:function(e){var t=e.env,r=this.addop.applyToDimen(t.xymatrixRowSepEm,Q.measure.length2em(this.dimen));t.xymatrixRowSepEm=r,t.xymatrixColSepEm=r}}),ye(W.Command.Xymatrix.Setup.PretendEntrySize.Height,{toShape:function(e){e.env.xymatrixPretendEntryHeight=new x.Some(Q.measure.length2em(this.dimen))}}),ye(W.Command.Xymatrix.Setup.PretendEntrySize.Width,{toShape:function(e){e.env.xymatrixPretendEntryWidth=new x.Some(Q.measure.length2em(this.dimen))}}),ye(W.Command.Xymatrix.Setup.PretendEntrySize.HeightAndWidth,{toShape:function(e){var t=new x.Some(Q.measure.length2em(this.dimen));e.env.xymatrixPretendEntryHeight=t,e.env.xymatrixPretendEntryWidth=t}}),ye(W.Command.Xymatrix.Setup.FixGrid.Row,{toShape:function(e){e.env.xymatrixFixedRow=!0}}),ye(W.Command.Xymatrix.Setup.FixGrid.Column,{toShape:function(e){e.env.xymatrixFixedCol=!0}}),ye(W.Command.Xymatrix.Setup.FixGrid.RowAndColumn,{toShape:function(e){e.env.xymatrixFixedRow=!0,e.env.xymatrixFixedCol=!0}}),ye(W.Command.Xymatrix.Setup.AdjustEntrySize.Margin,{toShape:function(e){var t=e.env;t.objectmargin=this.addop.applyToDimen(t.objectmargin,Q.measure.length2em(this.dimen))}}),ye(W.Command.Xymatrix.Setup.AdjustEntrySize.Width,{toShape:function(e){var t=e.env;t.objectwidth=this.addop.applyToDimen(t.objectwidth,Q.measure.length2em(this.dimen))}}),ye(W.Command.Xymatrix.Setup.AdjustEntrySize.Height,{toShape:function(e){var t=e.env;t.objectheight=this.addop.applyToDimen(t.objectheight,Q.measure.length2em(this.dimen))}}),ye(W.Command.Xymatrix.Setup.AdjustLabelSep,{toShape:function(e){var t=e.env;t.labelmargin=this.addop.applyToDimen(t.labelmargin,Q.measure.length2em(this.dimen))}}),ye(W.Command.Xymatrix.Setup.SetOrientation,{toShape:function(e){e.env.xymatrixOrientationAngle=this.direction.angle(e)}}),ye(W.Command.Xymatrix.Setup.AddModifier,{toShape:function(e){var t=e.env;t.xymatrixEntryModifiers=t.xymatrixEntryModifiers.prepend(this.modifier)}}),ye(W.Command.Xymatrix.Entry.SimpleEntry,{toShape:function(e){var t=e.env,r=Q.measure.em2length(t.objectmargin+t.objectwidth),n=Q.measure.em2length(t.objectmargin+t.objectheight),a=new W.Modifier.AddOp(new W.Modifier.AddOp.GrowTo,new W.Modifier.AddOp.VactorSize(new W.Vector.Abs(r,n))),i=Q.measure.em2length(t.objectmargin),o=new W.Modifier.AddOp(new W.Modifier.AddOp.Grow,new W.Modifier.AddOp.VactorSize(new W.Vector.Abs(i,i))),s=this.modifiers.concat(t.xymatrixEntryModifiers).prepend(a).prepend(o);return new W.Object(s,this.objectbox).toDropShape(e)}}),ye(W.Command.Xymatrix.Entry.EmptyEntry,{toShape:function(e){var t=e.env,r=Q.measure.em2length(t.objectmargin+t.objectwidth),n=Q.measure.em2length(t.objectmargin+t.objectheight),a=new W.Modifier.AddOp(new W.Modifier.AddOp.GrowTo,new W.Modifier.AddOp.VactorSize(new W.Vector.Abs(r,n))),i=Q.measure.em2length(t.objectmargin),o=new W.Modifier.AddOp(new W.Modifier.AddOp.Grow,new W.Modifier.AddOp.VactorSize(new W.Vector.Abs(i,i))),s=t.xymatrixEntryModifiers.prepend(a).prepend(o);return new W.Object(s,new W.ObjectBox.Empty).toDropShape(e)}}),ye(W.Command.Xymatrix.Entry.ObjectEntry,{toShape:function(e){return this.object.toDropShape(e)}}),ye(W.Command.Twocell,{toShape:function(e){var t=e.env;if(void 0===t.c)return de.none;var r=t.duplicate(),n=new xe(de.none,r);r.twocellmodmapobject=t.twocellmodmapobject||new W.Object(w.empty,new W.ObjectBox.Dir("","|")),r.twocellhead=t.twocellhead||new W.Object(w.empty,new W.ObjectBox.Dir("",">")),r.twocelltail=t.twocelltail||new W.Object(w.empty,new W.ObjectBox.Dir("","")),r.twocellarrowobject=t.twocellarrowobject||new W.Object(w.empty,new W.ObjectBox.Dir("","=>")),r.twocellUpperCurveObjectSpacer=t.twocellUpperCurveObjectSpacer,r.twocellUpperCurveObject=t.twocellUpperCurveObject,r.twocellLowerCurveObjectSpacer=t.twocellLowerCurveObjectSpacer,r.twocellLowerCurveObject=t.twocellLowerCurveObject,r.twocellUpperLabel=x.empty,r.twocellLowerLabel=x.empty,r.twocellCurvatureEm=x.empty,r.twocellShouldDrawCurve=!0,r.twocellShouldDrawModMap=!1,this.switches.foreach(function(e){e.setup(n)}),this.twocell.toShape(n,this.arrow),e.appendShapeToFront(n.shape)}}),ye(W.Command.Twocell.Hops2cell,{toShape:function(e,t){var r=e.env,n=r.c,a=r.angle,i=r.c,o=this.targetPosition(e);if(void 0!==i&&void 0!==o){var s=o.x-i.x,h=o.y-i.y;if(0!==s||0!==h){var u=new le.Point(i.x+.5*s,i.y+.5*h),c=Math.atan2(h,s),m=c+Math.PI/2,p=r.twocellCurvatureEm.getOrElse(this.getDefaultCurvature()),l=Math.cos(m),d=Math.sin(m),x=this.getUpperControlPoint(i,o,u,p,l,d),g=this.getLowerControlPoint(i,o,u,p,l,d);if(r.twocellShouldDrawCurve){var f,v;if(v=void 0===(f=r.twocellUpperCurveObjectSpacer)?new W.Object(w.empty,new W.ObjectBox.Dir("","-")):void 0!==r.twocellUpperCurveObject?r.twocellUpperCurveObject.getOrElse(void 0):void 0,this.toUpperCurveShape(e,i,x,o,f,v),r.lastCurve.isDefined){r.angle=c;var S=this.getUpperLabelPosition(i,o,u,p,l,d),y=this.getUpperLabelAngle(m,i,o,u,p,l,d);r.twocellUpperLabel.foreach(function(t){t.toShape(e,S,Math.cos(y),Math.sin(y),c)}),this.hasUpperTips&&t.toUpperTipsShape(e)}if(v=void 0===(f=r.twocellLowerCurveObjectSpacer)?new W.Object(w.empty,new W.ObjectBox.Dir("","-")):void 0!==r.twocellLowerCurveObject?r.twocellLowerCurveObject.getOrElse(void 0):void 0,this.toLowerCurveShape(e,i,g,o,f,v),r.lastCurve.isDefined){r.angle=c;var C=this.getLowerLabelPosition(i,o,u,p,l,d),b=this.getLowerLabelAngle(m,i,o,u,p,l,d);r.twocellLowerLabel.foreach(function(t){t.toShape(e,C,Math.cos(b),Math.sin(b),c)}),this.hasLowerTips&&t.toLowerTipsShape(e)}}r.c=this.getDefaultArrowPoint(i,o,u,p,l,d),r.angle=m+Math.PI;var M=u;t.toArrowShape(e,M),r.c=n,r.angle=a}}},_toCurveShape:function(e,t,r,n,a,i){var o=e.env,s=new fe.QuadBezier(t,r,n),h=s.tOfShavedStart(t),u=s.tOfShavedEnd(n);if(void 0===h||void 0===u||h>=u)o.lastCurve=ve.none;else{var c=s.toShape(e,a,i);o.lastCurve=new ve.QuadBezier(s,h,u,c)}},targetPosition:function(e){var t=e.env,r=t.xymatrixRow,n=t.xymatrixCol;if(void 0===r||void 0===n)throw d("ExecutionError","rows and columns not found for hops ["+this.hops+"]");for(var a=0;a<this.hops.length;a++)switch(this.hops[a]){case"u":r-=1;break;case"d":r+=1;break;case"l":n-=1;break;case"r":n+=1}var i=r+","+n;return e.env.lookupPos(i,'in entry "'+t.xymatrixRow+","+t.xymatrixCol+'": No '+this+" (is "+i+") from here.").position(e)}}),ye(W.Command.Twocell.Twocell,{getUpperControlPoint:function(e,t,r,n,a,i){return new le.Point(r.x+n*a,r.y+n*i)},getLowerControlPoint:function(e,t,r,n,a,i){return new le.Point(r.x-n*a,r.y-n*i)},getUpperLabelPosition:function(e,t,r,n,a,i){return new le.Point(r.x+.5*n*a,r.y+.5*n*i)},getLowerLabelPosition:function(e,t,r,n,a,i){return new le.Point(r.x-.5*n*a,r.y-.5*n*i)},getUpperLabelAngle:function(e,t,r,n,a,i,o){return e+(a<0?Math.PI:0)},getLowerLabelAngle:function(e,t,r,n,a,i,o){return e+(a<0?0:Math.PI)},getDefaultArrowPoint:function(e,t,r,n,a,i){return r},toUpperCurveShape:function(e,t,r,n,a,i){this._toCurveShape(e,t,r,n,a,i)},toLowerCurveShape:function(e,t,r,n,a,i){this._toCurveShape(e,t,r,n,a,i)},getDefaultCurvature:function(){return 3.5*Q.measure.lineElementLength},hasUpperTips:!0,hasLowerTips:!0}),ye(W.Command.Twocell.UpperTwocell,{getUpperControlPoint:function(e,t,r,n,a,i){return new le.Point(r.x+n*a,r.y+n*i)},getLowerControlPoint:function(e,t,r,n,a,i){return r},getUpperLabelPosition:function(e,t,r,n,a,i){return new le.Point(r.x+.5*n*a,r.y+.5*n*i)},getLowerLabelPosition:function(e,t,r,n,a,i){return r},getUpperLabelAngle:function(e,t,r,n,a,i,o){return e+(a<0?Math.PI:0)},getLowerLabelAngle:function(e,t,r,n,a,i,o){return e+(a<0?0:Math.PI)},getDefaultArrowPoint:function(e,t,r,n,a,i){return new le.Point(r.x+.25*n*a,r.y+.25*n*i)},toUpperCurveShape:function(e,t,r,n,a,i){this._toCurveShape(e,t,r,n,a,i)},toLowerCurveShape:function(e,t,r,n,a,i){var o=t.edgePoint(n.x,n.y),s=n.edgePoint(t.x,t.y);o.x!==s.x||o.y!==s.y?e.env.lastCurve=new ve.Line(o,s,t,n,void 0):e.env.lastCurve=ve.none},getDefaultCurvature:function(){return 7*Q.measure.lineElementLength},hasUpperTips:!0,hasLowerTips:!1}),ye(W.Command.Twocell.LowerTwocell,{getUpperControlPoint:function(e,t,r,n,a,i){return r},getLowerControlPoint:function(e,t,r,n,a,i){return new le.Point(r.x+n*a,r.y+n*i)},getUpperLabelPosition:function(e,t,r,n,a,i){return r},getLowerLabelPosition:function(e,t,r,n,a,i){return new le.Point(r.x+.5*n*a,r.y+.5*n*i)},getUpperLabelAngle:function(e,t,r,n,a,i,o){return e+(a<0?0:Math.PI)},getLowerLabelAngle:function(e,t,r,n,a,i,o){return e+(a<0?Math.PI:0)},getDefaultArrowPoint:function(e,t,r,n,a,i){return new le.Point(r.x+.25*n*a,r.y+.25*n*i)},toUpperCurveShape:function(e,t,r,n,a,i){var o=t.edgePoint(n.x,n.y),s=n.edgePoint(t.x,t.y);o.x!==s.x||o.y!==s.y?e.env.lastCurve=new ve.Line(o,s,t,n,void 0):e.env.lastCurve=ve.none},toLowerCurveShape:function(e,t,r,n,a,i){this._toCurveShape(e,t,r,n,a,i)},getDefaultCurvature:function(){return-7*Q.measure.lineElementLength},hasUpperTips:!1,hasLowerTips:!0}),ye(W.Command.Twocell.CompositeMap,{getUpperControlPoint:function(e,t,r,n,a,i){var o=this.getMidBoxSize();return new le.Ellipse(r.x+n*a,r.y+n*i,o,o,o,o)},getLowerControlPoint:function(e,t,r,n,a,i){var o=this.getMidBoxSize();return new le.Ellipse(r.x+n*a,r.y+n*i,o,o,o,o)},getUpperLabelPosition:function(e,t,r,n,a,i){var o=r.x+n*a-t.x,s=r.y+n*i-t.y;Math.sqrt(o*o+s*s);return new le.Point(t.x+.5*o,t.y+.5*s)},getLowerLabelPosition:function(e,t,r,n,a,i){var o=r.x+n*a-e.x,s=r.y+n*i-e.y;Math.sqrt(o*o+s*s);return new le.Point(e.x+.5*o,e.y+.5*s)},getUpperLabelAngle:function(e,t,r,n,a,i,o){var s=r.x-n.x+a*i,h=r.y-n.y+a*o,u=Math.atan2(h,s),c=a<0?Math.PI:0;return u+Math.PI/2+c},getLowerLabelAngle:function(e,t,r,n,a,i,o){var s=n.x+a*i-t.x,h=n.y+a*o-t.y,u=Math.atan2(h,s),c=a<0?Math.PI:0;return u+Math.PI/2+c},getDefaultArrowPoint:function(e,t,r,n,a,i){return r},toUpperCurveShape:function(e,t,r,n,a,i){var o=e.env,s=t,h=r,u=s.edgePoint(h.x,h.y),c=h.edgePoint(s.x,s.y),m=o.p,p=o.c;o.p=s,o.c=h,new fe.Line(u,c).toShape(e,void 0,"-",""),o.p=m,o.c=p},toLowerCurveShape:function(e,t,r,n,a,i){var o=e.env,s=r,h=n,u=s.edgePoint(h.x,h.y),c=h.edgePoint(s.x,s.y),m=o.p,p=o.c;o.p=s,o.c=h,new fe.Line(u,c).toShape(e,void 0,"-",""),o.p=m,o.c=p},getMidBoxSize:function(){return.5*Q.measure.lineElementLength},getDefaultCurvature:function(){return 3.5*Q.measure.lineElementLength},hasUpperTips:!0,hasLowerTips:!0}),ye(W.Command.Twocell.Switch.UpperLabel,{setup:function(e){e.env.twocellUpperLabel=new x.Some(this)},toShape:function(e,t,r,n,a){this.label.toShape(e,t,r,n,a)}}),ye(W.Command.Twocell.Switch.LowerLabel,{setup:function(e){e.env.twocellLowerLabel=new x.Some(this)},toShape:function(e,t,r,n,a){this.label.toShape(e,t,r,n,a)}}),ye(W.Command.Twocell.Switch.SetCurvature,{setup:function(e){var t=e.env;this.nudge.isOmit?t.twocellShouldDrawCurve=!1:t.twocellCurvatureEm=new x.Some(this.nudge.number*Q.measure.lineElementLength)}}),ye(W.Command.Twocell.Switch.DoNotSetCurvedArrows,{setup:function(e){e.env.twocellShouldDrawCurve=!1}}),ye(W.Command.Twocell.Switch.PlaceModMapObject,{setup:function(e){e.env.twocellShouldDrawModMap=!0}}),ye(W.Command.Twocell.Switch.ChangeHeadTailObject,{setup:function(e){var t=e.env;switch(this.what){case"`":t.twocelltail=this.object;break;case"'":t.twocellhead=this.object}}}),ye(W.Command.Twocell.Switch.ChangeCurveObject,{setup:function(e){var t=e.env;switch(this.what){case"":t.twocellUpperCurveObjectSpacer=this.spacer,t.twocellUpperCurveObject=this.maybeObject,t.twocellLowerCurveObjectSpacer=this.spacer,t.twocellLowerCurveObject=this.maybeObject;break;case"^":t.twocellUpperCurveObjectSpacer=this.spacer,t.twocellUpperCurveObject=this.maybeObject;break;case"_":t.twocellLowerCurveObjectSpacer=this.spacer,t.twocellLowerCurveObject=this.maybeObject}}}),ye(W.Command.Twocell.Label,{toShape:function(e,t,r,n,a){var i,o=this.maybeNudge;if(o.isDefined){var s=o.get;if(s.isOmit)return;i=s.number*Q.measure.lineElementLength}else i=this.getDefaultLabelOffset();var h=e.env,u=h.c;h.c=new le.Point(t.x+i*r,t.y+i*n),this.labelObject.toDropShape(e),h.c=u},getDefaultLabelOffset:function(){return Q.measure.lineElementLength}}),ye(W.Command.Twocell.Nudge.Number,{isOmit:!1}),ye(W.Command.Twocell.Nudge.Omit,{isOmit:!0}),ye(W.Command.Twocell.Arrow,{toTipsShape:function(e,t,r){var n=e.env,a=n.lastCurve,i=n.c,o=n.angle,s=t?Math.PI:0,h=a.tOfPlace(!0,!0,t?0:1,0);n.c=a.position(h),n.angle=a.angle(h)+s,n.twocellhead.toDropShape(e);h=a.tOfPlace(!0,!0,t?1:0,0);if(n.c=a.position(h),n.angle=a.angle(h)+s,r?n.twocellhead.toDropShape(e):n.twocelltail.toDropShape(e),n.twocellShouldDrawModMap){h=a.tOfPlace(!1,!1,.5,0);n.c=a.position(h),n.angle=a.angle(h)+s,n.twocellmodmapobject.toDropShape(e)}n.c=i,n.angle=o}}),ye(W.Command.Twocell.Arrow.WithOrientation,{toUpperTipsShape:function(e){switch(this.tok){case"":case"^":case"_":case"=":case"\\omit":case"'":this.toTipsShape(e,!1,!1);break;case"`":this.toTipsShape(e,!0,!1);break;case'"':this.toTipsShape(e,!1,!0)}},toLowerTipsShape:function(e){switch(this.tok){case"":case"^":case"_":case"=":case"\\omit":case"`":this.toTipsShape(e,!1,!1);break;case"'":this.toTipsShape(e,!0,!1);break;case'"':this.toTipsShape(e,!1,!0)}},toArrowShape:function(e,t){var r=e.env,n=r.c;switch(this.tok){case"^":var a=r.angle;r.angle=a+Math.PI,r.twocellarrowobject.toDropShape(e),r.c=new le.Point(n.x+Q.measure.lineElementLength*Math.cos(a-Math.PI/2),n.y+Q.measure.lineElementLength*Math.sin(a-Math.PI/2)),this.labelObject.toDropShape(e),r.angle=a;break;case"":case"_":a=r.angle;r.twocellarrowobject.toDropShape(e),r.c=new le.Point(n.x+Q.measure.lineElementLength*Math.cos(a+Math.PI/2),n.y+Q.measure.lineElementLength*Math.sin(a+Math.PI/2)),this.labelObject.toDropShape(e);break;case"=":a=r.angle;var i=new de.TwocellEqualityArrowheadShape(r.c,r.angle);e.appendShapeToFront(i),r.c=new le.Point(n.x+Q.measure.lineElementLength*Math.cos(a+Math.PI/2),n.y+Q.measure.lineElementLength*Math.sin(a+Math.PI/2)),this.labelObject.toDropShape(e);break;default:this.labelObject.toDropShape(e)}r.c=n}}),ye(W.Command.Twocell.Arrow.WithPosition,{toUpperTipsShape:function(e){this.toTipsShape(e,!1,!1)},toLowerTipsShape:function(e){this.toTipsShape(e,!1,!1)},toArrowShape:function(e,t){var r,n=e.env,a=n.c,i=n.angle,o=this.nudge;if(o.isOmit)r=a;else{var s=o.number*Q.measure.lineElementLength;r=new le.Point(t.x+s*Math.cos(i),t.y+s*Math.sin(i))}n.c=r,n.twocellarrowobject.toDropShape(e),o.isOmit||(n.c=new le.Point(r.x+Q.measure.lineElementLength*Math.cos(i+Math.PI/2),r.y+Q.measure.lineElementLength*Math.sin(i+Math.PI/2)),this.labelObject.toDropShape(e)),n.c=a}}),ye(W.Pos.Xyimport.TeXCommand,{toShape:function(e){var t=e.env;if(void 0===t.c)return de.none;var r=t.duplicate(),n=new xe(de.none,r),a=this.graphics.toDropShape(n),i=this.width,o=this.height;if(0===i||0===o)throw d("ExecutionError","the 'width' and 'height' attributes of the \\xyimport should be non-zero.");var s=r.c,h=s.l+s.r,u=s.u+s.d;if(0===h||0===u)throw d("ExecutionError","the width and height of the graphics to import should be non-zero.");var c=this.xOffset,m=this.yOffset;t.c=s.toRect({u:u/o*(o-m),d:u/o*m,l:h/i*c,r:h/i*(i-c)}),t.setXBase(h/i,0),t.setYBase(0,u/o);var p=s.l-t.c.l,l=s.d-t.c.d;a=new de.TranslateShape(p,l,n.shape);e.appendShapeToFront(a)}}),ye(W.Pos.Xyimport.Graphics,{toShape:function(e){var t=e.env;if(void 0===t.c)return de.none;var r=t.duplicate(),n=new xe(de.none,r),a=this.width,i=this.height;if(0===a||0===i)throw d("ExecutionError","the 'width' and 'height' attributes of the \\xyimport should be non-zero.");var o=this.graphics;if(o.setup(n),!r.includegraphicsWidth.isDefined||!r.includegraphicsHeight.isDefined)throw d("ExecutionError","the 'width' and 'height' attributes of the \\includegraphics are required.");var s=r.includegraphicsWidth.get,h=r.includegraphicsHeight.get;if(0===s||0===h)throw d("ExecutionError","the 'width' and 'height' attributes of the \\includegraphics should be non-zero.");var u=this.xOffset,c=this.yOffset;t.c=r.c.toRect({u:h/i*(i-c),d:h/i*c,l:s/a*u,r:s/a*(a-u)}),t.setXBase(s/a,0),t.setYBase(0,h/i);var m=new de.ImageShape(t.c,o.filepath);e.appendShapeToFront(m)}}),ye(W.Command.Includegraphics,{setup:function(e){var t=e.env;t.includegraphicsWidth=x.empty,t.includegraphicsHeight=x.empty,this.attributeList.foreach(function(t){t.setup(e)})}}),ye(W.Command.Includegraphics.Attr.Width,{setup:function(e){e.env.includegraphicsWidth=new x.Some(Q.measure.length2em(this.dimen))}}),ye(W.Command.Includegraphics.Attr.Height,{setup:function(e){e.env.includegraphicsHeight=new x.Some(Q.measure.length2em(this.dimen))}});const Me={};Me.Macro=i.Macro,Me.xybox=function(e,t,r){const n=be(e,ie.xybox(),W.xypic.prototype.kind);e.Push(n)},Me.xymatrixbox=function(e,t,r){const n=be(e,ie.xymatrixbox(),W.xypic.prototype.kind);e.Push(n)},Me.newdir=function(e,t,r){const n=be(e,ie.newdir(),W.xypic.newdir.prototype.kind);e.Push(n)},Me.xyincludegraphics=function(e,t,r){const n=be(e,ie.includegraphics(),W.xypic.includegraphics.prototype.kind);e.Push(n)},Me.xyEnvironment=function(e,t){const r=be(e,ie.xy(),W.xypic.prototype.kind);return e.Push(t),r};new m("xypic-command",{hole:["Macro","{\\style{visibility:hidden}{x}}"],objectstyle:["Macro","\\textstyle"],labelstyle:["Macro","\\scriptstyle"],twocellstyle:["Macro","\\scriptstyle"],xybox:["xybox","xybox"],xymatrix:["xymatrixbox","xymatrix"],newdir:["newdir","newdir"],includegraphics:["xyincludegraphics","includegraphics"]},Me),new p("xypic-environment",h.environment,{xy:["xyEnvironment",null,!1]},Me);s.create("xypic",{handler:{macro:["xypic-command"],environment:["xypic-environment"]},preprocessors:[({math:e,document:t,data:r})=>{Q.xypicCommandIdCounter=0,Q.xypicCommandMap={},Q.textObjectIdCounter=0,Q.wrapperOfTextObjectMap={}}],nodes:{xypic:function(e,t,r){const n=e.mmlFactory;return new W.xypic(n,t,r)},"xypic-newdir":function(e,t,r){const n=e.mmlFactory;return new W.xypic.newdir(n,t,r)},"xypic-includegraphics":function(e,t,r){const n=e.mmlFactory;return new W.xypic.includegraphics(n,t,r)}}});z.embeddedModifierMap={o:new W.Modifier.Shape.Circle,l:new W.Modifier.Shape.L,r:new W.Modifier.Shape.R,u:new W.Modifier.Shape.U,d:new W.Modifier.Shape.D,c:new W.Modifier.Shape.C,aliceblue:new W.Modifier.Shape.ChangeColor("aliceblue"),antiquewhite:new W.Modifier.Shape.ChangeColor("antiquewhite"),aqua:new W.Modifier.Shape.ChangeColor("aqua"),aquamarine:new W.Modifier.Shape.ChangeColor("aquamarine"),azure:new W.Modifier.Shape.ChangeColor("azure"),beige:new W.Modifier.Shape.ChangeColor("beige"),bisque:new W.Modifier.Shape.ChangeColor("bisque"),black:new W.Modifier.Shape.ChangeColor("black"),blanchedalmond:new W.Modifier.Shape.ChangeColor("blanchedalmond"),blue:new W.Modifier.Shape.ChangeColor("blue"),blueviolet:new W.Modifier.Shape.ChangeColor("blueviolet"),brown:new W.Modifier.Shape.ChangeColor("brown"),burlywood:new W.Modifier.Shape.ChangeColor("burlywood"),cadetblue:new W.Modifier.Shape.ChangeColor("cadetblue"),chartreuse:new W.Modifier.Shape.ChangeColor("chartreuse"),chocolate:new W.Modifier.Shape.ChangeColor("chocolate"),coral:new W.Modifier.Shape.ChangeColor("coral"),cornflowerblue:new W.Modifier.Shape.ChangeColor("cornflowerblue"),cornsilk:new W.Modifier.Shape.ChangeColor("cornsilk"),crimson:new W.Modifier.Shape.ChangeColor("crimson"),cyan:new W.Modifier.Shape.ChangeColor("cyan"),darkblue:new W.Modifier.Shape.ChangeColor("darkblue"),darkcyan:new W.Modifier.Shape.ChangeColor("darkcyan"),darkgoldenrod:new W.Modifier.Shape.ChangeColor("darkgoldenrod"),darkgray:new W.Modifier.Shape.ChangeColor("darkgray"),darkgreen:new W.Modifier.Shape.ChangeColor("darkgreen"),darkgrey:new W.Modifier.Shape.ChangeColor("darkgrey"),darkkhaki:new W.Modifier.Shape.ChangeColor("darkkhaki"),darkmagenta:new W.Modifier.Shape.ChangeColor("darkmagenta"),darkolivegreen:new W.Modifier.Shape.ChangeColor("darkolivegreen"),darkorange:new W.Modifier.Shape.ChangeColor("darkorange"),darkorchid:new W.Modifier.Shape.ChangeColor("darkorchid"),darkred:new W.Modifier.Shape.ChangeColor("darkred"),darksalmon:new W.Modifier.Shape.ChangeColor("darksalmon"),darkseagreen:new W.Modifier.Shape.ChangeColor("darkseagreen"),darkslateblue:new W.Modifier.Shape.ChangeColor("darkslateblue"),darkslategray:new W.Modifier.Shape.ChangeColor("darkslategray"),darkslategrey:new W.Modifier.Shape.ChangeColor("darkslategrey"),darkturquoise:new W.Modifier.Shape.ChangeColor("darkturquoise"),darkviolet:new W.Modifier.Shape.ChangeColor("darkviolet"),deeppink:new W.Modifier.Shape.ChangeColor("deeppink"),deepskyblue:new W.Modifier.Shape.ChangeColor("deepskyblue"),dimgray:new W.Modifier.Shape.ChangeColor("dimgray"),dimgrey:new W.Modifier.Shape.ChangeColor("dimgrey"),dodgerblue:new W.Modifier.Shape.ChangeColor("dodgerblue"),firebrick:new W.Modifier.Shape.ChangeColor("firebrick"),floralwhite:new W.Modifier.Shape.ChangeColor("floralwhite"),forestgreen:new W.Modifier.Shape.ChangeColor("forestgreen"),fuchsia:new W.Modifier.Shape.ChangeColor("fuchsia"),gainsboro:new W.Modifier.Shape.ChangeColor("gainsboro"),ghostwhite:new W.Modifier.Shape.ChangeColor("ghostwhite"),gold:new W.Modifier.Shape.ChangeColor("gold"),goldenrod:new W.Modifier.Shape.ChangeColor("goldenrod"),gray:new W.Modifier.Shape.ChangeColor("gray"),grey:new W.Modifier.Shape.ChangeColor("grey"),green:new W.Modifier.Shape.ChangeColor("green"),greenyellow:new W.Modifier.Shape.ChangeColor("greenyellow"),honeydew:new W.Modifier.Shape.ChangeColor("honeydew"),hotpink:new W.Modifier.Shape.ChangeColor("hotpink"),indianred:new W.Modifier.Shape.ChangeColor("indianred"),indigo:new W.Modifier.Shape.ChangeColor("indigo"),ivory:new W.Modifier.Shape.ChangeColor("ivory"),khaki:new W.Modifier.Shape.ChangeColor("khaki"),lavender:new W.Modifier.Shape.ChangeColor("lavender"),lavenderblush:new W.Modifier.Shape.ChangeColor("lavenderblush"),lawngreen:new W.Modifier.Shape.ChangeColor("lawngreen"),lemonchiffon:new W.Modifier.Shape.ChangeColor("lemonchiffon"),lightblue:new W.Modifier.Shape.ChangeColor("lightblue"),lightcoral:new W.Modifier.Shape.ChangeColor("lightcoral"),lightcyan:new W.Modifier.Shape.ChangeColor("lightcyan"),lightgoldenrodyellow:new W.Modifier.Shape.ChangeColor("lightgoldenrodyellow"),lightgray:new W.Modifier.Shape.ChangeColor("lightgray"),lightgreen:new W.Modifier.Shape.ChangeColor("lightgreen"),lightgrey:new W.Modifier.Shape.ChangeColor("lightgrey"),lightpink:new W.Modifier.Shape.ChangeColor("lightpink"),lightsalmon:new W.Modifier.Shape.ChangeColor("lightsalmon"),lightseagreen:new W.Modifier.Shape.ChangeColor("lightseagreen"),lightskyblue:new W.Modifier.Shape.ChangeColor("lightskyblue"),lightslategray:new W.Modifier.Shape.ChangeColor("lightslategray"),lightslategrey:new W.Modifier.Shape.ChangeColor("lightslategrey"),lightsteelblue:new W.Modifier.Shape.ChangeColor("lightsteelblue"),lightyellow:new W.Modifier.Shape.ChangeColor("lightyellow"),lime:new W.Modifier.Shape.ChangeColor("lime"),limegreen:new W.Modifier.Shape.ChangeColor("limegreen"),linen:new W.Modifier.Shape.ChangeColor("linen"),magenta:new W.Modifier.Shape.ChangeColor("magenta"),maroon:new W.Modifier.Shape.ChangeColor("maroon"),mediumaquamarine:new W.Modifier.Shape.ChangeColor("mediumaquamarine"),mediumblue:new W.Modifier.Shape.ChangeColor("mediumblue"),mediumorchid:new W.Modifier.Shape.ChangeColor("mediumorchid"),mediumpurple:new W.Modifier.Shape.ChangeColor("mediumpurple"),mediumseagreen:new W.Modifier.Shape.ChangeColor("mediumseagreen"),mediumslateblue:new W.Modifier.Shape.ChangeColor("mediumslateblue"),mediumspringgreen:new W.Modifier.Shape.ChangeColor("mediumspringgreen"),mediumturquoise:new W.Modifier.Shape.ChangeColor("mediumturquoise"),mediumvioletred:new W.Modifier.Shape.ChangeColor("mediumvioletred"),midnightblue:new W.Modifier.Shape.ChangeColor("midnightblue"),mintcream:new W.Modifier.Shape.ChangeColor("mintcream"),mistyrose:new W.Modifier.Shape.ChangeColor("mistyrose"),moccasin:new W.Modifier.Shape.ChangeColor("moccasin"),navajowhite:new W.Modifier.Shape.ChangeColor("navajowhite"),navy:new W.Modifier.Shape.ChangeColor("navy"),oldlace:new W.Modifier.Shape.ChangeColor("oldlace"),olive:new W.Modifier.Shape.ChangeColor("olive"),olivedrab:new W.Modifier.Shape.ChangeColor("olivedrab"),orange:new W.Modifier.Shape.ChangeColor("orange"),orangered:new W.Modifier.Shape.ChangeColor("orangered"),orchid:new W.Modifier.Shape.ChangeColor("orchid"),palegoldenrod:new W.Modifier.Shape.ChangeColor("palegoldenrod"),palegreen:new W.Modifier.Shape.ChangeColor("palegreen"),paleturquoise:new W.Modifier.Shape.ChangeColor("paleturquoise"),palevioletred:new W.Modifier.Shape.ChangeColor("palevioletred"),papayawhip:new W.Modifier.Shape.ChangeColor("papayawhip"),peachpuff:new W.Modifier.Shape.ChangeColor("peachpuff"),peru:new W.Modifier.Shape.ChangeColor("peru"),pink:new W.Modifier.Shape.ChangeColor("pink"),plum:new W.Modifier.Shape.ChangeColor("plum"),powderblue:new W.Modifier.Shape.ChangeColor("powderblue"),purple:new W.Modifier.Shape.ChangeColor("purple"),red:new W.Modifier.Shape.ChangeColor("red"),rosybrown:new W.Modifier.Shape.ChangeColor("rosybrown"),royalblue:new W.Modifier.Shape.ChangeColor("royalblue"),saddlebrown:new W.Modifier.Shape.ChangeColor("saddlebrown"),salmon:new W.Modifier.Shape.ChangeColor("salmon"),sandybrown:new W.Modifier.Shape.ChangeColor("sandybrown"),seagreen:new W.Modifier.Shape.ChangeColor("seagreen"),seashell:new W.Modifier.Shape.ChangeColor("seashell"),sienna:new W.Modifier.Shape.ChangeColor("sienna"),silver:new W.Modifier.Shape.ChangeColor("silver"),skyblue:new W.Modifier.Shape.ChangeColor("skyblue"),slateblue:new W.Modifier.Shape.ChangeColor("slateblue"),slategray:new W.Modifier.Shape.ChangeColor("slategray"),slategrey:new W.Modifier.Shape.ChangeColor("slategrey"),snow:new W.Modifier.Shape.ChangeColor("snow"),springgreen:new W.Modifier.Shape.ChangeColor("springgreen"),steelblue:new W.Modifier.Shape.ChangeColor("steelblue"),tan:new W.Modifier.Shape.ChangeColor("tan"),teal:new W.Modifier.Shape.ChangeColor("teal"),thistle:new W.Modifier.Shape.ChangeColor("thistle"),tomato:new W.Modifier.Shape.ChangeColor("tomato"),turquoise:new W.Modifier.Shape.ChangeColor("turquoise"),violet:new W.Modifier.Shape.ChangeColor("violet"),wheat:new W.Modifier.Shape.ChangeColor("wheat"),white:new W.Modifier.Shape.ChangeColor("white"),whitesmoke:new W.Modifier.Shape.ChangeColor("whitesmoke"),yellow:new W.Modifier.Shape.ChangeColor("yellow"),yellowgreen:new W.Modifier.Shape.ChangeColor("yellowgreen")};const Pe=MathJax._.output.chtml.Wrapper,Be=(Pe.FONTSIZE,Pe.ChtmlWrapper),Ae=MathJax._.output.chtml.Wrappers_ts.ChtmlWrappers,Le=MathJax._.util.BBox.BBox,Ee=me;class Oe{static createSvg(e,t,r,n,a,i,o){return new De(e,t,r,n,a,i,o)}}class ke{constructor(e){this.xypicWrapper=e}createElement(e){return this.xypicWrapper.svg(e)}createGroup(e){return new Fe(this,e)}createChangeColorGroup(e){return new Ie(this,e)}createSvgElement(e,t){let r=this.createElement(e);if(t)for(let e in t)if(t.hasOwnProperty(e)){let n=t[e].toString();"xlink:href"===e?this.xypicWrapper.setAttribute(r,e,n,"http://www.w3.org/1999/xlink"):this.xypicWrapper.setAttribute(r,e,n)}return this.appendChild(r),r}appendChild(e){return this.xypicWrapper.adaptor.append(this.drawArea,e),e}transformBuilder(){return new je}}class De extends ke{constructor(e,t,r,n,a,i,o){super(e);let s=this.createElement("svg");if(this.xypicWrapper.setAttribute(s,"xmlns","http://www.w3.org/2000/svg"),this.xypicWrapper.setAttribute(s,"version","1.1"),o)for(let e in o)o.hasOwnProperty(e)&&this.xypicWrapper.setAttribute(s,e,o[e].toString());s.style&&(s.style.width=Q.measure.Em(n),s.style.height=Q.measure.Em(t+r));o={fill:"none",stroke:i,"stroke-linecap":"round","stroke-width":Q.measure.em2px(a)};for(var h in this.drawArea=this.createElement("g"),o)o.hasOwnProperty(h)&&this.xypicWrapper.setAttribute(this.drawArea,h,o[h].toString());this.xypicWrapper.append(s,this.drawArea),this.svg=s,this.boundingBox=void 0,this.color=i}setHeight(e){this.xypicWrapper.setStyle(this.svg,"height",Q.measure.Em(e))}setWidth(e){this.xypicWrapper.setStyle(this.svg,"width",Q.measure.Em(e))}setAttribute(e,t){this.xypicWrapper.setAttribute(this.svg,e,t.toString())}extendBoundingBox(e){this.boundingBox=le.combineRect(this.boundingBox,e)}getOrigin(){return{x:0,y:0}}getCurrentColor(){return this.color}}class je{constructor(e){this.transform=e||w.empty}translate(e,t){return new je(this.transform.append(new Te(e,t)))}rotateDegree(e){return new je(this.transform.append(new Re(e/180*Math.PI)))}rotateRadian(e){return new je(this.transform.append(new Re(e)))}toString(){var e="";return this.transform.foreach(function(t){e+=t.toTranslateForm()}),e}apply(e,t){var r={x:e,y:t};return this.transform.foreach(function(e){r=e.apply(r.x,r.y)}),r}}class Te{constructor(e,t){this.dx=e,this.dy=t}apply(e,t){return{x:e-this.dx,y:t+this.dy}}toTranslateForm(){return"translate("+Q.measure.em2px(this.dx)+","+Q.measure.em2px(-this.dy)+") "}}class Re{constructor(e){this.radian=e}apply(e,t){var r=Math.cos(this.radian),n=Math.sin(this.radian);return{x:r*e+n*t,y:-n*e+r*t}}toTranslateForm(){return"rotate("+Ee(-180*this.radian/Math.PI)+") "}}class Fe extends ke{constructor(e,t){super(e.xypicWrapper),this.parent=e,this.drawArea=e.createSvgElement("g",void 0===t?{}:{transform:t.toString()});var r=e.getOrigin();this.origin=void 0===t?r:t.apply(r.x,r.y),ce(this,"getCurrentColor")}remove(){this.xypicWrapper.remove(this.drawArea)}extendBoundingBox(e){this.parent.extendBoundingBox(e)}getOrigin(){return this.origin}getCurrentColor(){return this.parent.getCurrentColor()}}class Ie extends ke{constructor(e,t){super(e.xypicWrapper),this.parent=e,this.drawArea=e.createSvgElement("g",{stroke:t}),this.color=t,ce(this,"getOrigin")}remove(){this.xypicWrapper.remove(this.drawArea)}extendBoundingBox(e){this.parent.extendBoundingBox(e)}getOrigin(){return this.parent.getOrigin()}getCurrentColor(){return this.color}}const ze=me;function Qe(e,t){class r extends e{constructor(e,t,r=null){super(e,t,r);const n=Q.wrapperOfTextObjectMap,a=t.textMmls,i=this.childNodes,o=a.length;for(let e=0;e<o;e++){n[a[e].xypicTextObjectId]=i[e]}this._textObjects=[]}getElement(){return this.chtml}appendTextObject(e){this._textObjects.push(e)}getChildWrapper(e){const t=e.xypicTextObjectId;if(null==t)throw d("IllegalStateError","BUG");const r=Q.wrapperOfTextObjectMap[t];if(null==r)throw d("IllegalStateError","unknown textObjectId:"+t);return r}toCHTML(e){const t=Q.svgForDebug,r=Q.svgForTestLayout;this._textObjects=[],this.setupMeasure(this),this._toCHTML(e),Q.svgForDebug=t,Q.svgForTestLayout=r}setupMeasure(e){const t=me,r=e.length2em("1em"),n=parseFloat(e.px(100).replace("px",""))/100,a=e.font.params.axis_height,i=e.length2em("0.15em"),o=function(t){return Math.round(parseFloat(e.px(100*t).replace("px","")))/100};Q.measure={length2em:function(r){return t(e.length2em(r))},oneem:r,em2length:function(e){return t(e/r)+"em"},Em:function(t){return e.em(t)},em:n,em2px:o,axis_height:a,strokeWidth:e.length2em("0.04em"),thickness:i,jot:e.length2em("3pt"),objectmargin:e.length2em("3pt"),objectwidth:e.length2em("0pt"),objectheight:e.length2em("0pt"),labelmargin:e.length2em("2.5pt"),turnradius:e.length2em("10pt"),lineElementLength:e.length2em("5pt"),axisHeightLength:a*e.length2em("10pt"),dottedDasharray:r+" "+o(i)}}append(e,t){this.adaptor.append(e,t)}remove(e){this.adaptor.remove(e)}svg(e,t={},r=[]){return this.adaptor.node(e,t,r,"http://www.w3.org/2000/svg")}setAttribute(e,t,r,n){return this.adaptor.setAttribute(e,t,r,n)}setStyle(e,t,r){this.adaptor.setStyle(e,t,r)}drawTextObject(e,t,r){const n=Q.measure.length2em("0.2em"),a=t.xypicWrapper,i=a.getChildWrapper(e.math),o=i.adaptor,s=i.getBBox(),h=s.scale,u=(s.h+n)*h,c=(s.d+n)*h,m=(s.w+2*n)*h,p=(u+c)/2,l=m/2,d=e.c;if(e.originalBBox={H:u,D:c,W:m},!r){const r=i.html("mjx-xypic-object");o.append(a.getElement(),r),o.setStyle(r,"color",t.getCurrentColor()),i.toCHTML([r]);const s=t.getOrigin();o.setAttribute(r,"data-x",d.x-l-s.x+n*h),o.setAttribute(r,"data-y",-d.y+(u-c)/2-s.y),o.setAttribute(r,"data-xypic-id",e.math.xypicTextObjectId),a.appendTextObject(r)}return d.toRect({u:p,d:p,l,r:l})}}class n extends r{constructor(e,t,r=null){super(e,t,r),this.shape=null}computeBBox(e,t=!1){e.empty();const r=this.node.cmd;if(r){const t=this.length2em("0.2em");if(null==this.shape){const e=Q.svgForDebug,t=Q.svgForTestLayout;this._textObjects=[],this.setupMeasure(this);this.adaptor;const n=Q.measure.strokeWidth,a=1,i=0,o=1,s=Q.measure.em2px,h="black",u=Oe.createSvg(this,a,i,o,n,h,{viewBox:[0,-s(a+i),s(o),s(a+i)].join(" "),role:"img",focusable:!1,overflow:"visible"});Q.svgForDebug=u,Q.svgForTestLayout=u;const c=new ge,m=new xe(de.none,c);r.toShape(m);const p=m.shape;this.shape=p,Q.svgForDebug=e,Q.svgForTestLayout=t}let n=this.shape.getBoundingBox();void 0!==n&&(n=new le.Rect(0,0,{l:Math.max(0,-(n.x-n.l)),r:Math.max(0,n.x+n.r),u:Math.max(0,n.y+n.u),d:Math.max(0,-(n.y-n.d))}),e.updateFrom(new Le({w:n.l+n.r+2*t,h:n.u+2*t,d:n.d})))}}get kind(){return W.xypic.prototype.kind}static get styles(){return{"mjx-xypic path":{"stroke-width":"inherit"},".MathJax mjx-xypic path":{"stroke-width":"inherit"},"mjx-xypic-object":{"text-align":"center",position:"absolute"},"mjx-xypic":{position:"relative"}}}_toCHTML(e){const t=this.standardChtmlNodes(e)[0];this.chtml=t;const r=this.adaptor,n=this.length2em("0.2em"),a=Q.measure.strokeWidth,i=1,o=0,s=1,h=Q.measure.em2px,u=Oe.createSvg(this,i,o,s,a,"black",{viewBox:[0,-h(i+o),h(s),h(i+o)].join(" "),role:"img",focusable:!1,overflow:"visible"});Q.svgForDebug=u,Q.svgForTestLayout=u,r.append(t,u.svg);const c=this.node.cmd;if(c){if(null==this.shape){const e=new ge,t=new xe(de.none,e);c.toShape(t);const r=t.shape;this.shape=r}const e=this.shape;e.draw(u);let a=e.getBoundingBox();if(void 0!==a){a=new le.Rect(0,0,{l:Math.max(0,-(a.x-a.l)),r:Math.max(0,a.x+a.r),u:Math.max(0,a.y+a.u),d:Math.max(0,-(a.y-a.d))});const e=a.x-a.l-n,i=-a.y-a.u-n,o=a.l+a.r+2*n,s=a.u+a.d+2*n;u.setWidth(o),u.setHeight(s),u.setAttribute("viewBox",[h(e),h(i),h(o),h(s)].join(" ")),r.setStyle(t,"vertical-align",ze(-a.d-n+Q.measure.axis_height)+"em");for(let t of this._textObjects){const i=parseFloat(r.getAttribute(t,"data-x")),o=parseFloat(r.getAttribute(t,"data-y"));r.setStyle(t,"left",ze(i-e)+"em"),r.setStyle(t,"top",ze(o+a.y-a.d-.5*n)+"em")}}else r.remove(u.svg)}else r.remove(u.svg)}}t[n.prototype.kind]=n;class a extends r{constructor(e,t,r=null){super(e,t,r)}get kind(){return W.xypic.newdir.prototype.kind}computeBBox(e,t=!1){let r=this.node.cmd;Q.repositories.dirRepository.put(r.dirMain,r.compositeObject)}_toCHTML(e){let t=this.node.cmd;Q.repositories.dirRepository.put(t.dirMain,t.compositeObject)}}t[a.prototype.kind]=a;class i extends r{constructor(e,t,r=null){super(e,t,r),this._setupGraphics(),this.computeBBox(this.bbox),this.bboxComputed=!0}get kind(){return W.xypic.includegraphics.prototype.kind}_setupGraphics(){this.setupMeasure(this);const e=new ge,t=new xe(de.none,e),r=this.node.cmd;if(r.setup(t),!e.includegraphicsWidth.isDefined||!e.includegraphicsHeight.isDefined)throw d("ExecutionError","the 'width' and 'height' attributes of the \\includegraphics are required.");const n=e.includegraphicsWidth.get,a=e.includegraphicsHeight.get;this.imageWidth=this.length2em(n),this.imageHeight=this.length2em(a),this.filepath=r.filepath}computeBBox(e,t=!1){e.empty(),e.updateFrom(new Le({w:this.imageWidth,h:this.imageHeight,d:0}))}_toCHTML(e){const t=this.standardChtmlNodes(e)[0];this.chtml=t,this.adaptor.setStyle(t,"position","relative"),this.adaptor.setStyle(t,"vertical-align","0em");const r=this.html("img");this.adaptor.setAttribute(r,"src",this.filepath),this.adaptor.setStyle(r,"width",ze(this.imageWidth)+"em"),this.adaptor.setStyle(r,"height",ze(this.imageHeight)+"em"),this.adaptor.append(t,r)}}t[i.prototype.kind]=i}void 0!==Be&&Qe(Be,Ae);const We=MathJax._.output.svg.Wrapper.SvgWrapper,Ne=MathJax._.output.svg.Wrappers_ts.SvgWrappers,_e=me;function Ue(e,t){class r extends e{constructor(e,t,r=null){super(e,t,r);const n=Q.wrapperOfTextObjectMap,a=t.textMmls,i=this.childNodes,o=a.length;for(let e=0;e<o;e++){n[a[e].xypicTextObjectId]=i[e]}this._textObjects=[]}getElement(){return this.svgNode}appendTextObject(e){this._textObjects.push(e)}getChildWrapper(e){const t=e.xypicTextObjectId;if(null==t)throw d("IllegalStateError","BUG");const r=Q.wrapperOfTextObjectMap[t];if(null==r)throw d("IllegalStateError","unknown textObjectId:"+t);return r}toSVG(e){const t=Q.svgForDebug,r=Q.svgForTestLayout;this._textObjects=[],this.setupMeasure(this),this._toSVG(e),Q.svgForDebug=t,Q.svgForTestLayout=r}setupMeasure(e){const t=me,r=e.length2em("1em"),n=parseFloat(e.px(100).replace("px",""))/100,a=e.font.params.axis_height,i=e.length2em("0.15em"),o=function(t){return Math.round(parseFloat(e.px(100*t).replace("px","")))/100};Q.measure={length2em:function(r){return t(e.length2em(r))},oneem:r,em2length:function(e){return t(e/r)+"em"},Em:function(t){return e.em(t)},em:n,em2px:o,axis_height:a,strokeWidth:e.length2em("0.04em"),thickness:i,jot:e.length2em("3pt"),objectmargin:e.length2em("3pt"),objectwidth:e.length2em("0pt"),objectheight:e.length2em("0pt"),labelmargin:e.length2em("2.5pt"),turnradius:e.length2em("10pt"),lineElementLength:e.length2em("5pt"),axisHeightLength:a*e.length2em("10pt"),dottedDasharray:r+" "+o(i)}}append(e,t){this.adaptor.append(e,t)}remove(e){this.adaptor.remove(e)}svg(e,t={},r=[]){return this.adaptor.node(e,t,r,"http://www.w3.org/2000/svg")}setAttribute(e,t,r,n){return this.adaptor.setAttribute(e,t,r,n)}setStyle(e,t,r){this.adaptor.setStyle(e,t,r)}drawTextObject(e,t,r){const n=Q.measure.length2em("0.2em"),a=t.xypicWrapper,i=a.getChildWrapper(e.math),o=i.adaptor,s=i.getBBox(),h=s.scale,u=(s.h+n)*h,c=(s.d+n)*h,m=(s.w+2*n)*h,p=(u+c)/2,l=m/2,d=e.c;if(e.originalBBox={H:u,D:c,W:m},!r){const r=i.svg("g");o.append(a.getElement(),r),o.setAttribute(r,"stroke",t.getCurrentColor()),o.setAttribute(r,"fill",t.getCurrentColor()),i.toSVG([r]);const s=t.getOrigin();o.setAttribute(r,"data-x",d.x-l-s.x+n*h),o.setAttribute(r,"data-y",-d.y+(u-c)/2-s.y),o.setAttribute(r,"data-xypic-id",e.math.xypicTextObjectId),a.appendTextObject(r)}return d.toRect({u:p,d:p,l,r:l})}}class n extends r{constructor(e,t,r=null){super(e,t,r),this.shape=null}computeBBox(e,t=!1){e.empty();const r=this.node.cmd;if(r){const t=this.length2em("0.2em");if(null==this.shape){const e=Q.svgForDebug,t=Q.svgForTestLayout;this._textObjects=[],this.setupMeasure(this);this.adaptor;const n=Q.measure.strokeWidth,a=1,i=0,o=1,s=Q.measure.em2px,h="black",u=Oe.createSvg(this,a,i,o,n,h,{viewBox:[0,-s(a+i),s(o),s(a+i)].join(" "),role:"img",focusable:!1,overflow:"visible"});Q.svgForDebug=u,Q.svgForTestLayout=u;const c=new ge,m=new xe(de.none,c);r.toShape(m);const p=m.shape;this.shape=p,Q.svgForDebug=e,Q.svgForTestLayout=t}let n=this.shape.getBoundingBox();void 0!==n&&(n=new le.Rect(0,0,{l:Math.max(0,-(n.x-n.l)),r:Math.max(0,n.x+n.r),u:Math.max(0,n.y+n.u),d:Math.max(0,-(n.y-n.d))}),e.updateFrom(new Le({w:n.l+n.r+2*t,h:n.u+2*t,d:n.d})))}}get kind(){return W.xypic.prototype.kind}static get styles(){return{'g[data-mml-node="xypic"] path':{"stroke-width":"inherit"},'.MathJax g[data-mml-node="xypic"] path':{"stroke-width":"inherit"}}}_toSVG(e){const t=this.standardSvgNodes(e)[0];this.svgNode=t;const r=this.adaptor,n=this.length2em("0.2em"),a=Q.measure.strokeWidth,i=1,o=0,s=1,h=Q.measure.em2px,u=Oe.createSvg(this,i,o,s,a,"black",{viewBox:[0,-h(i+o),h(s),h(i+o)].join(" "),role:"img",focusable:!1,overflow:"visible"});Q.svgForDebug=u,Q.svgForTestLayout=u,r.append(t,u.drawArea);const c=this.node.cmd;if(c){if(null==this.shape){const e=new ge,t=new xe(de.none,e);c.toShape(t);const r=t.shape;this.shape=r}const e=this.shape;e.draw(u);let t=e.getBoundingBox();if(void 0!==t){t=new le.Rect(0,0,{l:Math.max(0,-(t.x-t.l)),r:Math.max(0,t.x+t.r),u:Math.max(0,t.y+t.u),d:Math.max(0,-(t.y-t.d))});const e=t.x-t.l-n,a=-t.y-t.u-n,i=t.l+t.r+2*n,o=t.u+t.d+2*n;u.setWidth(i),u.setHeight(o),u.setAttribute("viewBox",[h(e),h(a),h(i),h(o)].join(" "));const s=this.fixed(1)/h(1);r.setAttribute(u.drawArea,"transform","translate("+this.fixed(-e)+","+this.fixed(t.y+Q.measure.axis_height)+") scale("+s+", "+-s+")");for(let n of this._textObjects){const a=parseFloat(r.getAttribute(n,"data-x"))-e,i=-parseFloat(r.getAttribute(n,"data-y"))+t.y+Q.measure.axis_height;this.place(a,i,n)}}else r.remove(u.drawArea)}else r.remove(u.drawArea)}}t[n.prototype.kind]=n;class a extends r{constructor(e,t,r=null){super(e,t,r)}get kind(){return W.xypic.newdir.prototype.kind}computeBBox(e,t=!1){let r=this.node.cmd;Q.repositories.dirRepository.put(r.dirMain,r.compositeObject)}_toSVG(e){let t=this.node.cmd;Q.repositories.dirRepository.put(t.dirMain,t.compositeObject)}}t[a.prototype.kind]=a;class i extends r{constructor(e,t,r=null){super(e,t,r),this._setupGraphics(),this.computeBBox(this.bbox),this.bboxComputed=!0}get kind(){return W.xypic.includegraphics.prototype.kind}_setupGraphics(){this.setupMeasure(this);const e=new ge,t=new xe(de.none,e),r=this.node.cmd;if(r.setup(t),!e.includegraphicsWidth.isDefined||!e.includegraphicsHeight.isDefined)throw d("ExecutionError","the 'width' and 'height' attributes of the \\includegraphics are required.");const n=e.includegraphicsWidth.get,a=e.includegraphicsHeight.get;this.imageWidth=this.length2em(n),this.imageHeight=this.length2em(a),this.filepath=r.filepath}computeBBox(e,t=!1){e.empty(),e.updateFrom(new Le({w:this.imageWidth,h:this.imageHeight,d:0}))}_toSVG(e){const t=this.standardSvgNodes(e)[0];this.svgNode=t;const r=this.fixed(1),n=this.svg("image",{x:"0",y:"0",preserveAspectRatio:"none",width:_e(this.imageWidth),height:_e(this.imageHeight),transform:"scale("+r+","+-r+") translate(0,"+_e(-this.imageHeight)+")"});this.adaptor.setAttribute(n,"xlink:href",this.filepath,"http://www.w3.org/1999/xlink"),this.adaptor.append(t,n)}}t[i.prototype.kind]=i}void 0!==We&&Ue(We,Ne);const{Loader:Ge}=MathJax._.components.loader;Ge&&(Ge.checkVersion("[xypic]","4.1.0","tex-extension"),MathJax._.output.chtml.Wrapper.ChtmlWrapper||Ge.ready("output/chtml").then(()=>{const e=MathJax._.output.chtml;Qe(e.Wrapper.ChtmlWrapper,e.Wrappers_ts.ChtmlWrappers)}).catch(e=>console.log("Caught",e)),MathJax._.output.svg.Wrapper.SvgWrapper||Ge.ready("output/svg").then(()=>{const e=MathJax._.output.svg;Ue(e.Wrapper.SvgWrapper,e.Wrappers_ts.SvgWrappers)}).catch(e=>console.log("Caught",e)))})();